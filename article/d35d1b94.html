<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="涂寐"><title>爬虫之异步相关 | 涂寐&#39;s Blogs</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/fontawesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/regular.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/solid.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!1,init_open:!0},style:{primary_color:"#0066cc",logo:"https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico",favicon:"https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico",avatar:"https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico",font_size:"18px",font_family:"STKaiti, STSong, STHeiti",hover:{shadow:!0,scale:!0},first_screen:{enable:!0,header_transparent:!0,background_img:"/images/bg.svg",description:"现在的你不努力||未来的你·该有多狼狈",font_color:null,hitokoto:!1},scroll:{progress_bar:!0,percent:!0}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"mac"},highlight_theme:"default"},side_tools:{},pjax:{enable:!0},lazyload:{enable:!0},comment:{enable:!0,use:"valine",valine:{appid:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appkey:"C0Wy6Sfq0qVag0nm59fc1D12",placeholder:"道友，请留步！请留言~"},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null},twikoo:{env_id:null,region:null,version:"1.6.7"},waline:{server_url:null,reaction:!1,version:2}},post:{author_label:{enable:!0,auto:!0,custom_label_list:["涂寐"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"center",copyright_info:!0},version:"3.5.2"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"}</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico"> </a><a class="logo-title" href="/">涂寐&#39;s Blogs</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/tags">标签</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/links">友链</a></li><li class="menu-item"><a href="/about">关于</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li><li class="drawer-menu-item flex-center"><a href="/tags">标签</a></li><li class="drawer-menu-item flex-center"><a href="/categories">分类</a></li><li class="drawer-menu-item flex-center"><a href="/links">友链</a></li><li class="drawer-menu-item flex-center"><a href="/about">关于</a></li></ul></div><div class="window-mask"></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JiZItHVhLKBShkL0",ck:"JiZItHVhLKBShkL0"})</script></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">爬虫之异步相关</span></div><div class="article-header"><div class="avatar"><img src="https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico"></div><div class="info"><div class="author"><span class="name">涂寐</span> <span class="author-label">Lv4</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2022-01-26 00:00:42</span> <span class="mobile">2022-01-26 00:00</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2022-02-24 21:47:06</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/python/">Python</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/crawler/">爬虫</a>&nbsp;</li></ul></span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>实验代码不想按分类处理，单独作为一个模块，其中笔记较多，对着代码更好理解</p></blockquote><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><ul><li>在爬虫中使用异步实现高性能的数据爬取操作</li></ul><h2 id="异步方式"><a href="#异步方式" class="headerlink" title="异步方式"></a>异步方式</h2><ol><li>多线程|多进程</li></ol><ul><li>优点：为阻塞操作单独开启线程|进程，实现异步</li><li>劣势：不能无限制开启多线程|多进程</li></ul><ol start="2"><li>线程池|进程池</li></ol><ul><li>优点：降低系统对进程|进程创建销毁的频率，进而降低系统内存开销</li><li>劣势：池中线程数|进程数有限</li></ul><ol start="3"><li>单线程 + 异步协程</li></ol><ul><li>even_loop：事件循环对象。其中可写入待循环方法（协程对象）。</li><li>coroutine：协程对象。使用 async 关键字定义方法，该方法被调用时返回一个协程对象，而不是调用后立即执行；协程对象被事件循环调用。</li><li>task：任务对象。对协程对象再次封装，内含任务各状态。</li><li>future：将执行或未执行的任务，与 task 无本质差别。</li><li>async：定义一个协程。</li><li>await：用来挂起阻塞方法的执行。</li></ul><h2 id="selenium-模块使用"><a href="#selenium-模块使用" class="headerlink" title="selenium 模块使用"></a>selenium 模块使用</h2><ol><li>selenium 模块和爬虫间关联？</li></ol><ul><li>便捷获取网站中动态数据</li><li>编写模拟登录</li></ul><ol start="2"><li>什么是 selenium 模块？</li></ol><ul><li>基于浏览器自动化的一个 python 模块</li></ul><ol start="3"><li>selenium 模块使用步骤</li></ol><ul><li>环境安装：pip install selenium</li><li>浏览器驱动程序下载<ul><li>Google 驱动地址举例：<a class="link" target="_blank" rel="noopener" href="http://npm.taobao.org/mirrors/chromedriver">http://npm.taobao.org/mirrors/chromedriver<i class="fas fa-external-link-alt"></i></a></li><li>驱动程序版本需与浏览器版本（96.0.4664.93）尽量一致（大版本）</li></ul></li><li>实例化浏览器对象<ul><li>from selenium import webdriver</li><li>from selenium.webdriver.chrome.service import Service</li><li>service &#x3D; Service(executable_path&#x3D;’.&#x2F;chromedriver.exe’)</li><li>driver &#x3D; webdriver.Chrome(service&#x3D;service)</li></ul></li><li>编写基于浏览器自动化的操作代码<ul><li>发起请求：get(URL))</li><li>标签定位：find_element() 结合 By 类</li><li>标签交互：send_keys(‘xxx’)</li><li>执行 js 脚本：excute_script(‘js代码’)</li><li>界面回退：back()</li><li>界面前进：forward()</li><li>关闭浏览器：quit()</li></ul></li><li>selenium 模块处理 iframe<ul><li>待定位标签位于 iframe 标签中，使用 switch_to.frame() 方法改变定位作用域</li><li>动作链，需导入：from selenium.webdriver import ActionChains<ul><li>长按点击动作：click_and_hold(draggable_id)</li><li>拖动操作：move_by_offset(x, y)</li><li>立即执行操作：perform()</li><li>释放动作链：release()</li></ul></li></ul></li><li>options 类相关方法<ul><li>binary_location：设置 Chrome 二进制文件位置</li><li>add_argument：添加启动参数</li><li>add_extension，add_encoded_extension：添加扩展应用</li><li>add_experimental_option：添加实验性质的设置参数</li><li>debugger_address：设置调试器地址</li></ul></li></ul><h2 id="代码实例"><a href="#代码实例" class="headerlink" title="代码实例"></a>代码实例</h2><blockquote><p>以下部分为代码实例讲解部分，内含单条语句注释说明</p></blockquote><h3 id="同步爬虫测试"><a href="#同步爬虫测试" class="headerlink" title="同步爬虫测试"></a>同步爬虫测试</h3><blockquote><p>首先，感受一下同步爬虫</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步爬虫测试</span></span><br><span class="line"><span class="comment"># 由于阻塞操作，同步爬虫仅在执行完一个请求后才能开始执行另一个请求</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36 Edg/96.0.1054.62&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">&#x27;https://downsc.chinaz.net/Files/DownLoad/jianli/202112/jianli16623.rar&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://downsc.chinaz.net/Files/DownLoad/jianli/202112/jianli16611.rar&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://downsc.chinaz.net/Files/DownLoad/jianli/202112/jianli16615.rar&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RequestGet</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_content</span>(<span class="params">self, url</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;正在爬取：&#x27;</span> + url)</span><br><span class="line">        <span class="comment"># get() 方法为阻塞方法，当执行完当前操作才能执行其他操作</span></span><br><span class="line">        response = requests.get(url=url, headers=headers)</span><br><span class="line">        <span class="comment"># 根据响应码执行下步操作，若为 200，则返回二进制数据</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.content</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_content</span>(<span class="params">self, content</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;数据长度：&#x27;</span>, <span class="built_in">len</span>(content))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    requestGet = RequestGet()</span><br><span class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">        content = requestGet.get_content(url)</span><br><span class="line">        requestGet.parse_content(content)</span><br></pre></td></tr></table></figure><h3 id="线程池的基本使用"><a href="#线程池的基本使用" class="headerlink" title="线程池的基本使用"></a>线程池的基本使用</h3><blockquote><p>主要进行同步爬虫、单线程串行、线程池的使用效果</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># 导入线程池模块需要的类</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_page</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 模拟单线程串行方式操作</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在下载&quot;</span> + <span class="built_in">str</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;下载成功&#x27;</span> + <span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name_list = [<span class="string">&#x27;xiaozi&#x27;</span>, <span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;bb&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>]</span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 模拟单线程串行方式操作</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># for i in range(len(name_list)):</span></span><br><span class="line"><span class="comment">#     get_page(name_list[i])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 模拟线程池方式操作</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 实例化线程池对象</span></span><br><span class="line">pool = Pool(<span class="number">4</span>)</span><br><span class="line"><span class="comment"># 列表元素传入 get_page() 中处理</span></span><br><span class="line">pool.<span class="built_in">map</span>(get_page, name_list)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># # 此处为比对同步爬虫</span></span><br><span class="line"><span class="comment"># for a in name_list:</span></span><br><span class="line"><span class="comment">#     get_page(a)</span></span><br><span class="line"></span><br><span class="line">end_time = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;%d second&#x27;</span> %(end_time - start_time))</span><br></pre></td></tr></table></figure><h3 id="线程池爬取梨视频"><a href="#线程池爬取梨视频" class="headerlink" title="线程池爬取梨视频"></a>线程池爬取梨视频</h3><blockquote><p>梨视频网站现在通过 ajax 实时加载视频，且改变了 ajax 响应包的视频 URL，具体看下面的代码<br>再bb一句，下载量大时对比线程池耗时效果更明显</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 爬取梨视频的生活频道视频</span></span><br><span class="line"><span class="comment"># 注意：进程池处理的式阻塞且耗时的操作</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Video</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36 Edg/96.0.1054.62&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 空列表，存储所有的视频名和视屏链接</span></span><br><span class="line">    urls = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">video_url</span>(<span class="params">self</span>):</span><br><span class="line">        url = <span class="string">&#x27;https://www.pearvideo.com/category_130&#x27;</span></span><br><span class="line">        page_text = requests.get(url=url, headers=self.headers).text</span><br><span class="line">        tree = etree.HTML(page_text)</span><br><span class="line">        <span class="comment"># 找到聚集点</span></span><br><span class="line">        li_list = tree.xpath(<span class="string">&#x27;//ul[@id=&quot;categoryList&quot;]/li&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">            <span class="comment"># 精确查找每一个符合值，并进行拼接成详情页完整URL</span></span><br><span class="line">            <span class="comment"># https://www.pearvideo.com/video_1749618</span></span><br><span class="line">            detail_url = <span class="string">&#x27;https://www.pearvideo.com/&#x27;</span> + li.xpath(<span class="string">&#x27;./div/a/@href&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            name = li.xpath(<span class="string">&#x27;./div/a/div[2]/text()&#x27;</span>)[<span class="number">0</span>] + <span class="string">&#x27;.mp4&#x27;</span></span><br><span class="line">            <span class="comment"># 去除某些符号</span></span><br><span class="line">            <span class="comment"># name = li.xpath(&#x27;./div/a/div[2]/text()&#x27;)[0].replace(&#x27; | &#x27;, &#x27;&#x27;).replace(&#x27;·&#x27;, &#x27;&#x27;).replace(&#x27;，&#x27;, &#x27;&#x27;).replace(&#x27;、&#x27;, &#x27;&#x27;)</span></span><br><span class="line">            <span class="comment"># 输出文件名，及其URL</span></span><br><span class="line">            <span class="built_in">print</span>(name + <span class="string">&quot; --&gt; &quot;</span> + detail_url)</span><br><span class="line">            <span class="comment"># 当直接点击网页上的某个视频，将在新页面打开并播放</span></span><br><span class="line">            <span class="comment"># 若复制 URL 后打开，则需要点击后播放，判断：原页面增加跳转并播放的点击事件</span></span><br><span class="line">            <span class="comment"># 比较发现，视频的真实地址通过 AJAX 动态加载，如下：</span></span><br><span class="line">            <span class="comment"># &#123;&#x27;resultCode&#x27;: &#x27;1&#x27;, &#x27;resultMsg&#x27;: &#x27;success&#x27;, &#x27;reqId&#x27;: &#x27;bfd8d987-4766-45f7-944c-36669facb5bc&#x27;, &#x27;systemTime&#x27;: &#x27;1642779887007&#x27;, &#x27;videoInfo&#x27;: &#123;&#x27;playSta&#x27;: &#x27;1&#x27;, &#x27;video_image&#x27;: &#x27;https://image1.pearvideo.com/cont/20220112/14494912-124035-1.png&#x27;, &#x27;videos&#x27;: &#123;&#x27;hdUrl&#x27;: &#x27;&#x27;, &#x27;hdflvUrl&#x27;: &#x27;&#x27;, &#x27;sdUrl&#x27;: &#x27;&#x27;, &#x27;sdflvUrl&#x27;: &#x27;&#x27;, &#x27;srcUrl&#x27;: &#x27;https://video.pearvideo.com/mp4/third/20220112/1642779887007-14494912-124007-hd.mp4&#x27;&#125;&#125;&#125;</span></span><br><span class="line">            <span class="comment"># detail_page_text = requests.session().get(detail_url, headers=headers).text</span></span><br><span class="line">            <span class="comment"># 尝试直接拿 ajax 的请求链接访问，文章已下线</span></span><br><span class="line">            <span class="comment"># 对比请求包不同，请求头中少了 Referer 参数，用于标识该请求的链接来源</span></span><br><span class="line">            <span class="comment"># 尝试过先访问详情页，保持 cookie 下再访问 ajax 页面，无效</span></span><br><span class="line">            <span class="comment"># 拿到视频详情页id</span></span><br><span class="line">            ex = <span class="string">&#x27;video_(.*)&#x27;</span></span><br><span class="line">            video_id = re.findall(ex, detail_url)[<span class="number">0</span>]</span><br><span class="line">            <span class="comment"># print(detail_url)</span></span><br><span class="line">            <span class="comment"># print(vedio_id)</span></span><br><span class="line">            <span class="comment"># 对视频详情页 ajax 发起请求</span></span><br><span class="line">            ajax_url = <span class="string">&#x27;https://www.pearvideo.com/videoStatus.jsp?contId=&#123;false_id&#125;&amp;mrd=0.6923628803380188&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                false_id=video_id)</span><br><span class="line">            <span class="comment"># print(ajax_url)</span></span><br><span class="line">            headers = &#123;</span><br><span class="line">                <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36 Edg/96.0.1054.62&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;Referer&#x27;</span>: detail_url</span><br><span class="line">            &#125;</span><br><span class="line">            ajax_page_json = requests.get(url=ajax_url, headers=headers).json()</span><br><span class="line">            <span class="comment"># print(ajax_page_json)</span></span><br><span class="line">            <span class="comment"># 编写正则表达式</span></span><br><span class="line">            <span class="comment"># ea = &quot;&#x27;, &#x27;srcUrl&#x27;: &#x27;(.*?)&#x27;&#125;&#125;&#125;&quot;</span></span><br><span class="line">            <span class="comment"># 最后发现： ajax 的响应数据中得到的链接有些需要替换，自行对照，如下：</span></span><br><span class="line">            <span class="comment"># 可访问：https://video.pearvideo.com/mp4/third/20220120/cont-1750332-15498275-092138-hd.mp4</span></span><br><span class="line">            <span class="comment"># ajax： https://video.pearvideo.com/mp4/third/20220120/1642775491037-15498275-092138-hd.mp4</span></span><br><span class="line">            <span class="comment"># 修改正则，实现视频url的拼接</span></span><br><span class="line">            ea = <span class="string">&quot;&#x27;, &#x27;srcUrl&#x27;: &#x27;.*?(-.*?)&#x27;&#125;&#125;&#125;&quot;</span></span><br><span class="line">            eb = <span class="string">&quot;, &#x27;srcUrl&#x27;: &#x27;(.*/)&quot;</span></span><br><span class="line">            <span class="comment"># 此处需要使用 str() 方法将 ajax_page_json 对象强转为字符串</span></span><br><span class="line">            video_url_a = re.findall(ea, <span class="built_in">str</span>(ajax_page_json))[<span class="number">0</span>]</span><br><span class="line">            video_url_b = re.findall(eb, <span class="built_in">str</span>(ajax_page_json))[<span class="number">0</span>]</span><br><span class="line">            video_url = video_url_b + <span class="string">&#x27;cont-&#x27;</span> + video_id + video_url_a</span><br><span class="line">            <span class="comment"># print(video_url_a)</span></span><br><span class="line">            <span class="comment"># print(video_url_b)</span></span><br><span class="line">            <span class="built_in">print</span>(video_url)</span><br><span class="line">            <span class="comment"># 获取到数据写入字典进行存储</span></span><br><span class="line">            video_dict = &#123;</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: name,</span><br><span class="line">                <span class="string">&#x27;url&#x27;</span>: video_url</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># 列表嵌套字典，每个视频名和视频链接作为一个字典写入列表 urls</span></span><br><span class="line">            urls.append(video_dict)</span><br><span class="line">        <span class="keyword">return</span> urls</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">video_data</span>(<span class="params">self, <span class="built_in">dict</span></span>):</span><br><span class="line">        url = <span class="built_in">dict</span>[<span class="string">&#x27;url&#x27;</span>]</span><br><span class="line">        <span class="comment"># print(url)</span></span><br><span class="line">        time.sleep(<span class="number">19</span>)</span><br><span class="line">        data = requests.get(url=url, headers=self.headers).content</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">dict</span>[<span class="string">&#x27;name&#x27;</span>] + <span class="string">&#x27;下载中……&#x27;</span>)</span><br><span class="line">        <span class="comment"># 持久化存储</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./梨视频/&#x27;</span> + <span class="built_in">dict</span>[<span class="string">&#x27;name&#x27;</span>], <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            fp.write(data)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">dict</span>[<span class="string">&#x27;name&#x27;</span>] + <span class="string">&#x27;下载完成！！！&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    video = Video()</span><br><span class="line">    urls = []</span><br><span class="line">    urls = video.video_url()</span><br><span class="line">    <span class="comment"># print(urls)</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="comment"># 通过进程池对视频数据进行请求</span></span><br><span class="line">    pool = Pool(<span class="number">4</span>)</span><br><span class="line">    pool.<span class="built_in">map</span>(video.video_data, urls)</span><br><span class="line">    <span class="comment"># 同步爬虫比较</span></span><br><span class="line">    <span class="comment"># for url in urls:</span></span><br><span class="line">    <span class="comment">#     video.video_data(url)</span></span><br><span class="line">    end = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;全部下载完成……&#x27;</span>)</span><br><span class="line">    <span class="comment"># 上面加了个延时，直观点</span></span><br><span class="line">    <span class="built_in">print</span>(end - start)</span><br></pre></td></tr></table></figure><h3 id="单任务协程"><a href="#单任务协程" class="headerlink" title="单任务协程"></a>单任务协程</h3><blockquote><p>要理解难的，肯定先理解其下较为简单的，别说了，看源码</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 协程单任务基本使用</span></span><br><span class="line"><span class="comment"># 使用 async 关键字声明为异步函数</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;正在请求的url为：&#x27;</span> + url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;请求成功：&#x27;</span> + url)</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用协程，返回一个协程对象</span></span><br><span class="line">c = request(<span class="string">&#x27;0xtlu.me&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># # 创建一个事件循环对象</span></span><br><span class="line"><span class="comment"># loop = asyncio.get_event_loop()</span></span><br><span class="line"><span class="comment"># # 将协程对象注册到 loop 中，再启动 loop</span></span><br><span class="line"><span class="comment"># loop.run_until_complete(c)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># task 的使用</span></span><br><span class="line"><span class="comment"># loop = asyncio.get_event_loop()</span></span><br><span class="line"><span class="comment"># # 基于 loop 创建 task 对象</span></span><br><span class="line"><span class="comment"># task = loop.create_task(c)</span></span><br><span class="line"><span class="comment"># 打印 task 对象状态</span></span><br><span class="line"><span class="comment"># # print(task)</span></span><br><span class="line"><span class="comment"># # 注册协程对象并启动 loop</span></span><br><span class="line"><span class="comment"># loop.run_until_complete(task)</span></span><br><span class="line"><span class="comment"># # 再次打印 task 对象状态</span></span><br><span class="line"><span class="comment"># print(task)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># future 的使用</span></span><br><span class="line"><span class="comment"># loop = asyncio.get_event_loop()</span></span><br><span class="line"><span class="comment"># task = asyncio.ensure_future(c)</span></span><br><span class="line"><span class="comment"># print(task)</span></span><br><span class="line"><span class="comment"># loop.run_until_complete(task)</span></span><br><span class="line"><span class="comment"># print(task)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定回调</span></span><br><span class="line"><span class="comment"># 回调函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">callback_func</span>(<span class="params">task</span>):</span><br><span class="line">    <span class="comment"># result() 返回入伍对象中封装的协程对象对应函数（request()）的返回值</span></span><br><span class="line">    <span class="built_in">print</span>(task.result())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建事件对象</span></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="comment"># 创建任务对象</span></span><br><span class="line">task = asyncio.ensure_future(c)</span><br><span class="line"><span class="comment"># 使用回调函数（add_done_callback）绑定任务对象（task）</span></span><br><span class="line">task.add_done_callback(callback_func)</span><br><span class="line"><span class="comment"># 运行任务对象</span></span><br><span class="line">loop.run_until_complete(task)</span><br></pre></td></tr></table></figure><h3 id="多任务协程"><a href="#多任务协程" class="headerlink" title="多任务协程"></a>多任务协程</h3><blockquote><p>单任务学完了，看多任务呗</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 协程多任务使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;正在下载&#x27;</span> + url)</span><br><span class="line">    <span class="comment"># 异步协程中出现同步模块相关代码（time.sleep(2)），则无法异步</span></span><br><span class="line">    <span class="comment"># time.sleep(2)</span></span><br><span class="line">    <span class="comment"># 当asyncio 中遇到阻塞操作必需手动挂起（使用 await 关键字）</span></span><br><span class="line">    <span class="comment"># await 用来用来声明程序的挂起</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;下载完毕&#x27;</span> + url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urls = [<span class="string">&#x27;www.baidu.com&#x27;</span>, <span class="string">&#x27;0xtlu.me&#x27;</span>, <span class="string">&#x27;www.google.com&#x27;</span>, <span class="string">&#x27;www.sogou.com&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存放任务列表</span></span><br><span class="line">tasks = []</span><br><span class="line"><span class="comment"># 开始事件</span></span><br><span class="line">start = time.time()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    c = request(url)</span><br><span class="line">    task = asyncio.ensure_future(c)</span><br><span class="line">    tasks.append(task)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="comment"># 人物列表封装到 wait 中</span></span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(time.time() - start)</span><br></pre></td></tr></table></figure><h3 id="多任务协程实验"><a href="#多任务协程实验" class="headerlink" title="多任务协程实验"></a>多任务协程实验</h3><blockquote><p>这是一个难过的例子，有同步模块，看不到多任务异步协程效果</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多任务异步协程实现</span></span><br><span class="line"><span class="comment"># 由于含同步模块代码，未实现</span></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">urls = [<span class="string">&#x27;https://0xtlu.me/article/c2461216.html&#x27;</span>, <span class="string">&#x27;https://0xtlu.me/article/82b683e3.html&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://0xtlu.me/article/c86c0afc.html&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_page</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;正在下载&#x27;</span> + url)</span><br><span class="line">    <span class="comment"># requests.get 为基于同步请求的模块，但现在需要的是给予异步的网络请求模块进行指定 url 的请求发送，即 aiohttp</span></span><br><span class="line">    response = requests.get(url=url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;下载完毕&#x27;</span> + response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tasks = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    c = get_page(url)</span><br><span class="line">    task = asyncio.ensure_future(c)</span><br><span class="line">    tasks.append(task)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;耗时：&#x27;</span> + <span class="built_in">str</span>(end - start))</span><br></pre></td></tr></table></figure><h3 id="aiohttp实现多任务异步协程"><a href="#aiohttp实现多任务异步协程" class="headerlink" title="aiohttp实现多任务异步协程"></a>aiohttp实现多任务异步协程</h3><blockquote><p>上个题目的解决方案：通过 aiohttp 模块解决同步模块 requests，让异步协程正确运行</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># aiohttp实现多任务异步协程</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 环境安装</span></span><br><span class="line"><span class="comment"># pip install aiohttp</span></span><br><span class="line"><span class="comment"># 需要使用 aiohttp 模块的 ClientSession 对象</span></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">urls = [<span class="string">&#x27;https://0xtlu.me/article/c2461216.html&#x27;</span>, <span class="string">&#x27;https://0xtlu.me/article/82b683e3.html&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://0xtlu.me/article/c86c0afc.html&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_page</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;正在下载&#x27;</span> + url)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="comment"># aiohttp 可以使用操作</span></span><br><span class="line">        <span class="comment"># get() 或 post()</span></span><br><span class="line">        <span class="comment"># headers,params/data,proxy=&#x27;http://ip:port/&#x27;</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> <span class="keyword">await</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="comment"># text() 方法返回字符串形式的响应数据</span></span><br><span class="line">            <span class="comment"># read() 方法返回二进制形式的响应数据</span></span><br><span class="line">            <span class="comment"># json() 方法返回 json 对象的响应数据</span></span><br><span class="line">            <span class="comment"># 注：获取响应数据前需要使用 await 关键字手动挂起</span></span><br><span class="line">            page_text = <span class="keyword">await</span> response.text()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;下载完毕&#x27;</span> + page_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tasks = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    c = get_page(url)</span><br><span class="line">    task = asyncio.ensure_future(c)</span><br><span class="line">    tasks.append(task)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;耗时：&#x27;</span> + <span class="built_in">str</span>(end - start))</span><br></pre></td></tr></table></figure><h3 id="selenium模块基本使用"><a href="#selenium模块基本使用" class="headerlink" title="selenium模块基本使用"></a>selenium模块基本使用</h3><blockquote><p>之前看到过谷歌自动化的效果，现在使用 selenium 模块发现原来是这个家伙</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># 爬取药监局企业名称</span></span><br><span class="line"><span class="comment"># http://scxk.nmpa.gov.cn:81/xk/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化一个浏览器对象（传入浏览器的驱动程序）</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 老方法</span></span><br><span class="line"><span class="comment"># 能运行，但由于版本更新时，executable_path 方法被重构到 Service 函数中而引起弃用警告</span></span><br><span class="line"><span class="comment"># DeprecationWarning: executable_path has been deprecated, please pass in a Service object</span></span><br><span class="line"><span class="comment"># driver = webdriver.Chrome(executable_path=&#x27;./chromedriver.exe&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 新方法</span></span><br><span class="line">service = Service(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line">driver = webdriver.Chrome(service=service)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 指定　URL　发起搜索请求</span></span><br><span class="line">driver.get(<span class="string">&#x27;http://scxk.nmpa.gov.cn:81/xk/&#x27;</span>)</span><br><span class="line"><span class="comment"># 打印网页标题</span></span><br><span class="line"><span class="comment"># print(driver.title)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 通过 page_source 方法获取网页源码</span></span><br><span class="line">page_text = driver.page_source</span><br><span class="line"><span class="comment"># print(page_text)</span></span><br><span class="line"><span class="comment"># 对网页源码进行数据解析</span></span><br><span class="line">tree = etree.HTML(page_text)</span><br><span class="line">li_list = tree.xpath(<span class="string">&#x27;//ul[@id=&quot;gzlist&quot;]/li&#x27;</span>)</span><br><span class="line"><span class="comment"># print(li_list)</span></span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">    name = li.xpath(<span class="string">&#x27;./dl/@title&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 暂停6s后关闭浏览器</span></span><br><span class="line">sleep(<span class="number">6</span>)</span><br><span class="line">driver.close()</span><br></pre></td></tr></table></figure><h3 id="selenium模块其他使用"><a href="#selenium模块其他使用" class="headerlink" title="selenium模块其他使用"></a>selenium模块其他使用</h3><blockquote><p>上一个标题是 selenium 模块的基本使用，现在看下它的元素定位、数据交互、前进后退等功能</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"></span><br><span class="line">service = Service(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line">driver = webdriver.Chrome(service=service)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">&#x27;https://www.taobao.com/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进行标签定位</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 不推荐使用 find——element_by_id() 方法</span></span><br><span class="line"><span class="comment"># q_id = driver.find_element_by_id(&#x27;q&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 通过 By 类定位页面上 id 为 &#x27;q&#x27; 的元素</span></span><br><span class="line"><span class="comment"># By是 selenium 中内置的一个 class ，在该 class 中有各种方法来定位元素</span></span><br><span class="line">q_id = driver.find_element(By.ID, <span class="string">&#x27;q&#x27;</span>)</span><br><span class="line"><span class="comment"># print(q_id)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 搜索框写入数据实现交互</span></span><br><span class="line">q_id.send_keys(<span class="string">&#x27;iphone&#x27;</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 实现点击搜索按钮的效果</span></span><br><span class="line"><span class="comment"># 获取按钮元素</span></span><br><span class="line">button = driver.find_element(By.CSS_SELECTOR, <span class="string">&#x27;.btn-search&#x27;</span>)</span><br><span class="line"><span class="comment"># 实现点击事件，由于没登陆不给搜，直接添砖登录界面</span></span><br><span class="line">button.click()</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 执行一组 js 脚本</span></span><br><span class="line"><span class="comment"># 使界面滚动到最底部</span></span><br><span class="line">driver.execute_script(<span class="string">&#x27;window.scrollTo(0,document.body.scrollHeight)&#x27;</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 实现回退效果：回到上一标签页</span></span><br><span class="line"><span class="comment"># 先访问下自己的博客</span></span><br><span class="line">driver.get(<span class="string">&#x27;https://0xtlu.github.io&#x27;</span>)</span><br><span class="line"><span class="comment"># 延时2s后回退淘宝登录界面</span></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.back()</span><br><span class="line"><span class="comment"># 继续延时2s后前进博客首页</span></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">driver.forward()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">sleep(<span class="number">6</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure><h3 id="selenium模块-iframe-动作链"><a href="#selenium模块-iframe-动作链" class="headerlink" title="selenium模块__iframe__动作链"></a>selenium模块__iframe__动作链</h3><blockquote><p>登陆界面一般都是存在验证的，通常是通过 iframe 标签实现<br>当切换到 iframe 标签作用域时，需要实现一系列的动作——动作链的使用</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 利用菜鸟教程的练习模块完成拖动效果的代码实现</span></span><br><span class="line"><span class="comment"># https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable</span></span><br><span class="line"><span class="comment"># 运行感受，这是搜索引擎问题还是什么，界面加载不出来|未连接到互联网</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">service = Service(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line">driver = webdriver.Chrome(service=service)</span><br><span class="line">driver.get(<span class="string">&#x27;https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存在 iframe 标签，则定位其内部标签需先改变浏览器定位标签的作用域，使用如下方法</span></span><br><span class="line"><span class="comment"># 即，通过 switch_to.frame() 方法将当前定位的主题切换为 iframe 表单的内嵌页面中</span></span><br><span class="line"><span class="comment"># 主要为，通过 id、name、element (定位的某个元素)、索引来指定切换到的某个 iframe 表单</span></span><br><span class="line">driver.switch_to.frame(<span class="string">&#x27;iframeResult&#x27;</span>)</span><br><span class="line"><span class="comment"># 再通过 id 获取 iframe 表单内部待拖动的 div 标签</span></span><br><span class="line">draggable_id = driver.find_element(By.ID, <span class="string">&#x27;draggable&#x27;</span>)</span><br><span class="line"><span class="comment"># print(draggable_id)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 动作链</span></span><br><span class="line"><span class="comment"># 要求：点击-拖动-放开点击</span></span><br><span class="line"><span class="comment"># 当调用 ActionChains 的方法时，不会立即执行</span></span><br><span class="line"><span class="comment"># 而是将所有的操作按顺序存放到队列中，当调用 perform() 方法时，根据队列依次执行</span></span><br><span class="line"><span class="comment"># 实例化行为事件类 ActionChains，实现键盘鼠标的各个操作</span></span><br><span class="line">action = ActionChains(driver)</span><br><span class="line"><span class="comment"># 实现鼠标左键长按标签事件</span></span><br><span class="line">action.click_and_hold(draggable_id)</span><br><span class="line"><span class="comment"># 移动偏移</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="comment"># 调用 perform() 方法立即执行动作链</span></span><br><span class="line">    <span class="comment"># move_by_offset(x, y) 方法参数解析：x（水平方向），y（垂直方向）</span></span><br><span class="line">    action.move_by_offset(<span class="number">50</span>, <span class="number">0</span>).perform()</span><br><span class="line">    sleep(<span class="number">0.3</span>)</span><br><span class="line"><span class="comment"># 释放动作链（松开左键）</span></span><br><span class="line">action.release().perform()</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 释放 action</span></span><br><span class="line">action.reset_actions()</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure><h3 id="未实现登录QQ空间"><a href="#未实现登录QQ空间" class="headerlink" title="未实现登录QQ空间"></a>未实现登录QQ空间</h3><blockquote><p>登录界面没有改变，但滑块与缺口间位置对齐比较麻烦，暂时不想理解<br>对了，这里可以学到动作链的使用</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录QQ空间</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">service = Service(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line">driver = webdriver.Chrome(service=service)</span><br><span class="line">driver.get(<span class="string">&#x27;https://qzone.qq.com/&#x27;</span>)</span><br><span class="line"><span class="comment"># iframe 标签中再定位</span></span><br><span class="line">driver.switch_to.frame(<span class="string">&#x27;login_frame&#x27;</span>)</span><br><span class="line">a_tag = driver.find_element(By.ID, <span class="string">&#x27;switcher_plogin&#x27;</span>)</span><br><span class="line"><span class="comment"># 鼠标点击事件</span></span><br><span class="line">a_tag.click()</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 账密定位</span></span><br><span class="line">username = driver.find_element(By.ID, <span class="string">&#x27;u&#x27;</span>)</span><br><span class="line">password = driver.find_element(By.ID, <span class="string">&#x27;p&#x27;</span>)</span><br><span class="line"><span class="comment"># 清空原数据</span></span><br><span class="line">username.clear()</span><br><span class="line">password.clear()</span><br><span class="line"><span class="comment"># 账密写入</span></span><br><span class="line">username.send_keys(<span class="string">&#x27;yourUser&#x27;</span>)</span><br><span class="line">password.send_keys(<span class="string">&#x27;yourPasswd!&#x27;</span>)</span><br><span class="line"><span class="comment"># 点击登录事件</span></span><br><span class="line">login = driver.find_element(By.ID, <span class="string">&#x27;login_button&#x27;</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">seli = login.click()</span><br><span class="line"><span class="built_in">print</span>(seli)</span><br><span class="line">sleep(<span class="number">6</span>)</span><br><span class="line"><span class="comment"># 自动化多了，提示：由于你的帐号存在异常，需要进行手机验证，请使用QQ手机版扫码进行登录。</span></span><br><span class="line"><span class="comment"># 滑块验证</span></span><br><span class="line"><span class="comment"># 切换定位作用域</span></span><br><span class="line">driver.switch_to.frame(<span class="string">&#x27;tcaptcha_iframe&#x27;</span>)</span><br><span class="line"><span class="comment"># 找到滑块</span></span><br><span class="line">slideBlock_id = driver.find_element(By.ID, <span class="string">&#x27;slideBlock&#x27;</span>)</span><br><span class="line"><span class="comment"># 实例化行为事件</span></span><br><span class="line">action = ActionChains(driver)</span><br><span class="line"><span class="comment"># 点击且长按的动作链</span></span><br><span class="line">action.click_and_hold(slideBlock_id)</span><br><span class="line"><span class="comment"># x 坐标值来源，浏览器控制台观察，拖动滑块时 img 标签的 style 属性中的 left 会改变，看重合时数值减去初始值即可</span></span><br><span class="line">action.move_by_offset(<span class="number">183</span>, <span class="number">0</span>).perform()</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 说一下问题，缺口位置不同导致滑块移动距离差异</span></span><br><span class="line"><span class="comment"># 另一种方法，先安装下面两个模块</span></span><br><span class="line"><span class="comment"># pip install opencv-python</span></span><br><span class="line"><span class="comment"># pip install np</span></span><br><span class="line"><span class="comment"># 看了看，步骤有点……不想复制，有兴趣自己了解吧</span></span><br><span class="line"><span class="comment"># https://www.cnblogs.com/yxh-zixishi/p/14514493.html</span></span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">action.release().perform()</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">36</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure><h3 id="无可视化界面与规避反反爬"><a href="#无可视化界面与规避反反爬" class="headerlink" title="无可视化界面与规避反反爬"></a>无可视化界面与规避反反爬</h3><blockquote><p>主要通过设置 chrome 的启动参数实现无可视化界面（无头浏览器）<br>反反爬机制主要为屏蔽自动化的某些特征，如自动化控制提示、禁止启用 blink 功能和嵌入js等等</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实现无可视化界面和规避检测</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ChromeOptions</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># 无可视化界面（无头浏览器）</span></span><br><span class="line"><span class="comment"># options 是一个方便控制 chrome 启动时属性的类</span></span><br><span class="line"><span class="comment"># 实例化 options 类</span></span><br><span class="line">option = Options()</span><br><span class="line"><span class="comment"># 设置启动参数</span></span><br><span class="line"><span class="comment"># 设置非可视化界面，非可视化 linux 中需设置非可视化才能正常运行</span></span><br><span class="line">option.add_argument(<span class="string">&#x27;--headless&#x27;</span>)</span><br><span class="line"><span class="comment"># 根据谷歌文档说明，该语句用于规避bug</span></span><br><span class="line">option.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line"><span class="comment"># 添加 UA (需要为 chrome 浏览器的 UA )</span></span><br><span class="line">option.add_argument(</span><br><span class="line">    <span class="string">&#x27;user-agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.99 Safari/537.36&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启开发者模式</span></span><br><span class="line"><span class="comment"># 实现规避检测</span></span><br><span class="line"><span class="comment"># 屏蔽自动化受控提示和开发者提示</span></span><br><span class="line">option.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>, <span class="string">&#x27;load-extension&#x27;</span>])</span><br><span class="line"></span><br><span class="line">service = Service(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line"><span class="comment"># DeprecationWarning: use options instead of chrome_options</span></span><br><span class="line"><span class="comment"># chrome_options 已弃用</span></span><br><span class="line"><span class="comment"># driver = webdriver.Chrome(service=service, chrome_options=option)</span></span><br><span class="line"><span class="comment"># 改用 options</span></span><br><span class="line"><span class="comment"># driver = webdriver.Chrome(service=service, options=option)</span></span><br><span class="line"><span class="comment"># 添加规避</span></span><br><span class="line">driver = webdriver.Chrome(service=service, options=option)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">&#x27;https://www.baidu.com/&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(driver.page_source)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">6</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure><h3 id="登录12306"><a href="#登录12306" class="headerlink" title="登录12306"></a>登录12306</h3><blockquote><p>哒哒，这就是看规避效果的时候了。没有进行无可视化界面处理哦</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 12306</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.service <span class="keyword">import</span> Service</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"></span><br><span class="line">option = Options()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 屏蔽 webdriver 使用特征，绕过特征验证</span></span><br><span class="line"><span class="comment"># 也可以通过向页面嵌入 js 代码规避检测，使用到再说</span></span><br><span class="line"><span class="comment"># 屏蔽自动化受控提示和开发者提示</span></span><br><span class="line">option.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>, <span class="string">&#x27;load-extension&#x27;</span>])</span><br><span class="line"><span class="comment"># 禁止启用 blink 运行时的功能</span></span><br><span class="line">option.add_argument(<span class="string">&#x27;--disable-blink-features=AutomationControlled&#x27;</span>)</span><br><span class="line"><span class="comment"># 禁用自动扩展（插件）</span></span><br><span class="line">option.add_experimental_option(<span class="string">&#x27;useAutomationExtension&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 屏蔽&#x27;保存密码&#x27;提示框</span></span><br><span class="line">prefs = &#123;&#125;</span><br><span class="line">prefs[<span class="string">&quot;credentials_enable_service&quot;</span>] = <span class="literal">False</span></span><br><span class="line">prefs[<span class="string">&quot;profile.password_manager_enabled&quot;</span>] = <span class="literal">False</span></span><br><span class="line">option.add_experimental_option(<span class="string">&quot;prefs&quot;</span>, prefs)</span><br><span class="line">service = Service(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line">driver = webdriver.Chrome(service=service, options=option)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌入 js 代码进行规避</span></span><br><span class="line"><span class="comment"># chrome 高版本后该规避不知道还行不行（用不出来），这里不做肯定</span></span><br><span class="line"><span class="comment"># with open(&#x27;./js.js&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     js = f.read()</span></span><br><span class="line"><span class="comment"># driver.execute_cdp_cmd(&quot;Page.addScriptToEvaluateOnNewDocument&quot;, &#123;</span></span><br><span class="line"><span class="comment">#   &quot;source&quot;: js</span></span><br><span class="line"><span class="comment"># &#125;))</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 利用 Chrome 开发工具协议，正确从 selenium 启动的 Chrome 浏览器中隐藏 window.navigator.webdriver 关键字</span></span><br><span class="line"><span class="comment"># 单步测试可以使用</span></span><br><span class="line"><span class="comment"># 对比了下，应该是我的 js 文件中没写相关的语句导致无法实现规避效果</span></span><br><span class="line">driver.execute_cdp_cmd(<span class="string">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span>, &#123;</span><br><span class="line">    <span class="string">&quot;source&quot;</span>: <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                    Object.defineProperty(navigator, &#x27;webdriver&#x27;, &#123;</span></span><br><span class="line"><span class="string">                      get: () =&gt; undefined</span></span><br><span class="line"><span class="string">                    &#125;)</span></span><br><span class="line"><span class="string">                  &quot;&quot;&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">driver.get(<span class="string">&#x27;https://kyfw.12306.cn/otn/resources/login.html&#x27;</span>)</span><br><span class="line">username = driver.find_element(By.ID, <span class="string">&#x27;J-userName&#x27;</span>)</span><br><span class="line">password = driver.find_element(By.ID, <span class="string">&#x27;J-password&#x27;</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">username.clear()</span><br><span class="line">password.clear()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">username.send_keys(<span class="string">&#x27;yourUser&#x27;</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">password.send_keys(<span class="string">&#x27;yourPasswd&#x27;</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">login = driver.find_element(By.ID, <span class="string">&#x27;J-login&#x27;</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">login.click()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">slide = driver.find_element(By.ID, <span class="string">&#x27;nc_1_n1z&#x27;</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(slide)</span><br><span class="line">action = ActionChains(driver)</span><br><span class="line">action.click_and_hold(slide)</span><br><span class="line"><span class="comment"># 直接滑到尽头，这个比较简单</span></span><br><span class="line"></span><br><span class="line">action.move_by_offset(<span class="number">300</span>, <span class="number">0</span>).perform()</span><br><span class="line">action.release().perform()</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># action.click_and_hold(slide)</span></span><br><span class="line"><span class="comment"># for i in range(5):</span></span><br><span class="line"><span class="comment">#     sleep(1)</span></span><br><span class="line"><span class="comment">#     action.move_by_offset(60, 0).perform()</span></span><br><span class="line"><span class="comment"># sleep(1)</span></span><br><span class="line"><span class="comment"># action.release().perform()</span></span><br><span class="line"><span class="comment"># 拖动完成后报错：</span></span><br><span class="line"><span class="comment"># 哎呀，出错了，点击刷新再来一次(error:EQaZmr)</span></span><br><span class="line"><span class="comment"># 感觉像机器验证</span></span><br><span class="line"><span class="comment"># 确认了 webdriver 必作为反爬虫特征处理，so 不给你登</span></span><br><span class="line">sleep(<span class="number">10</span>)</span><br><span class="line"><span class="comment"># 休眠一下，拿到当前页面源码</span></span><br><span class="line"><span class="built_in">print</span>(driver.page_source)</span><br><span class="line">action.reset_actions()</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><blockquote><p>写完了，写过一遍了，懂了吗？没有<br>为什么做笔记，方便之后的回顾呀</p></blockquote></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul class="copyright-info-content"><li><span class="type">本文标题</span>：<span class="content">爬虫之异步相关</span></li><li><span class="type">本文作者</span>：<span class="content">涂寐</span></li><li><span class="type">创建时间</span>：<span class="content">2022-01-26 00:00:42</span></li><li class="post-link"><span class="type">本文链接</span>：<span class="content">article/d35d1b94.html</span></li><li><span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span></li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/crawler/">#爬虫</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/article/7b5c4c0f.html"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">FinalShell高级版离线激活</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/article/39c9e418.html"><span class="title flex-center"><span class="post-nav-title-item">pikachu_全通关笔记_含源码解析</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;评论</div><div class="valine-container"><script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="vcomments"></div><script data-pjax>function loadValine(){function e(e){switch(e){case"en":return"Author";case"zh-CN":return"博主";default:return"Master"}}new Valine({el:"#vcomments",appId:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appKey:"C0Wy6Sfq0qVag0nm59fc1D12",meta:["nick","mail","link"],avatar:"wavatar",enableQQ:!0,placeholder:"道友，请留步！请留言~",lang:"zh-CN".toLowerCase()});const a=setInterval(()=>{const n=document.querySelectorAll("#vcomments .vcards .vcard");if(n.length>0){let t="涂寐";if(t)for(let a of n){const n=a.querySelector(".vhead .vnick"),l=n.innerHTML;l===t&&(n.innerHTML=`${l} <span class="author">${e(KEEP.hexo_config.language)}</span>`)}clearInterval(a)}else clearInterval(a)},2e3)}{const e=setTimeout(()=>{loadValine(),clearTimeout(e)},1e3)}</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E7%9A%84"><span class="nav-number">2.</span> <span class="nav-text">目的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E6%96%B9%E5%BC%8F"><span class="nav-number">3.</span> <span class="nav-text">异步方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#selenium-%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8"><span class="nav-number">4.</span> <span class="nav-text">selenium 模块使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E4%BE%8B"><span class="nav-number">5.</span> <span class="nav-text">代码实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E7%88%AC%E8%99%AB%E6%B5%8B%E8%AF%95"><span class="nav-number">5.1.</span> <span class="nav-text">同步爬虫测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">5.2.</span> <span class="nav-text">线程池的基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%88%AC%E5%8F%96%E6%A2%A8%E8%A7%86%E9%A2%91"><span class="nav-number">5.3.</span> <span class="nav-text">线程池爬取梨视频</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E4%BB%BB%E5%8A%A1%E5%8D%8F%E7%A8%8B"><span class="nav-number">5.4.</span> <span class="nav-text">单任务协程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%8D%8F%E7%A8%8B"><span class="nav-number">5.5.</span> <span class="nav-text">多任务协程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%8D%8F%E7%A8%8B%E5%AE%9E%E9%AA%8C"><span class="nav-number">5.6.</span> <span class="nav-text">多任务协程实验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aiohttp%E5%AE%9E%E7%8E%B0%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%BC%82%E6%AD%A5%E5%8D%8F%E7%A8%8B"><span class="nav-number">5.7.</span> <span class="nav-text">aiohttp实现多任务异步协程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selenium%E6%A8%A1%E5%9D%97%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">5.8.</span> <span class="nav-text">selenium模块基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selenium%E6%A8%A1%E5%9D%97%E5%85%B6%E4%BB%96%E4%BD%BF%E7%94%A8"><span class="nav-number">5.9.</span> <span class="nav-text">selenium模块其他使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selenium%E6%A8%A1%E5%9D%97-iframe-%E5%8A%A8%E4%BD%9C%E9%93%BE"><span class="nav-number">5.10.</span> <span class="nav-text">selenium模块__iframe__动作链</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AA%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95QQ%E7%A9%BA%E9%97%B4"><span class="nav-number">5.11.</span> <span class="nav-text">未实现登录QQ空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E4%B8%8E%E8%A7%84%E9%81%BF%E5%8F%8D%E5%8F%8D%E7%88%AC"><span class="nav-number">5.12.</span> <span class="nav-text">无可视化界面与规避反反爬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BB%E5%BD%9512306"><span class="nav-number">5.13.</span> <span class="nav-text">登录12306</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">6.</span> <span class="nav-text">后记</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2021</span> - 2022 &nbsp;<i class="fas fa-heart icon-animate" style="color:red"></i> &nbsp;<a href="/">涂寐</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.5.2</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/lazyload.js"></script><div class="post-scripts pjax"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/post-helper.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/toc.js"></script></div><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/pjax.min.js"></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.refresh()})})</script></body></html>